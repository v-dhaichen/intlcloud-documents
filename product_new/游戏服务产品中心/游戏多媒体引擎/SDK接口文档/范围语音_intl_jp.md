## 概要

Tencent Cloud Gaming Multimedia Engine SDKをご利用いただき、ありがとうございます。開発者がTencent Cloud Gaming Multimedia Engine製品のAPIに対するデバッグ・アクセスを行いやすいように、ここで、GMEレンジボイスのアクセス技術ドキュメントを説明させていただきます。


GMEレンジボイスは大逃殺類ゲーム向けに開発されたカスタマイズ製品です。一般のチーム音声ルームと違っているのコア機能は下記の通りです。

#### 1、大逃殺類ゲームに特有の「チームのみ」又は「全員」の音声モードを提供します。

#### 2、範囲判断能力により、同じ音声ルームでは、多数のユーザーが同時にマイクをオンで音声通話を行うことをサポートしています。



## 基本概念

### 1、入室した時に指定したTeamID != 0の場合、レンジボイスルームモードになります。

### 2、レンジボイスルームに参加した時に、2種類の音声モードを選択することが可能です。

| 音声モード | パラメータの名称               | 機能                                        |
| -------- | ---------------------- | -------------------------------------------- |
| 全員   | RANGE_AUDIO_MODE_WORLD | 設定してから、一定範囲の近くにいる人たちは当該プレイヤーの発言が聞こえるようになります|
| チームのみ   | RANGE_AUDIO_MODE_TEAM  | チームメンバーのみが聞こえます                               |

### 3、異なる音声モードでは、具体的なボイスの到達可能状況は下記の通りです。

  #### 仮にAプレイヤーの状態を「全員」とすると、対応するBプレイヤーは異なる音声モードでの到達可能状況は下記の通りです。

  |同じチームであるかどうか   |範囲以内にあるかどうか   |音声モード   |AはBの声が聞こえるかどうか   |BはAの声が聞こえるかどうか  |
|-----------------   |------------   |------------   |--------------------------    |--------------------------   |
|同じチームである       |はい           |MODE_WORLD     |AはBの声が聞こえています     |BはAの声が聞こえています      |
|同じチームである       |はい           |MODE_TEAM     |AはBの声が聞こえています     |BはAの声が聞こえています      |
|同じチームである       |いいえ           |MODE_WORLD     |AはBの声が聞こえています     |BはAの声が聞こえています      |
|同じチームである       |いいえ           |MODE_TEAM     |AはBの声が聞こえています     |BはAの声が聞こえています      |
|同じチームでない       |はい           |MODE_WORLD     |AはBの声が聞こえています     |BはAの声が聞こえています      |
|同じチームでない		|はい			|MODE_TEAM	|AはBの声が聞こえていない	|BはAの声が聞こえていない	|
|同じチームでない		|いいえ		 	|MODE_WORLD	|AはBの声が聞こえていない	|BはAの声が聞こえていない	|
|同じチームでない		|いいえ			|MODE_TEAM	|AはBの声が聞こえていない	|BはAの声が聞こえていない	|

  #### 仮にAプレイヤーの状態を「チームのみ」とすると、対応するBプレイヤーは異なる音声モードでの到達可能状況は下記の通りです。

  |同じチームであるかどうか|範囲以内であるかどうか|音声状態|AはBの声が聞こえるかどうか|B はAの声が聞こえるかどうか|
|-----------------   |------------   |------------   |--------------------------    |--------------------------   |
|同じチームである|はい |MODE_WORLD|AはBの声が聞こえています|BはAの声が聞こえています|
|同じチームである|はい |MODE_TEAM|AはBの声が聞こえています|BはAの声が聞こえています|
|同じチームである|いいえ |MODE_WORLD|AはBの声が聞こえています|BはAの声が聞こえています|
|同じチームである|いいえ |MODE_TEAM|AはBの声が聞こえています|BはAの声が聞こえています|
|同じチームでない		|はい		 	|MODE_WORLD	|AはBの声が聞こえていない	|BはAの声が聞こえていない	|
|同じチームでない		|はい			|MODE_TEAM	|AはBの声が聞こえていない	|BはAの声が聞こえていない	|
|同じチームでない		|いいえ		 	|MODE_WORLD	|AはBの声が聞こえていない	|BはAの声が聞こえていない	|
|同じチームでない		|いいえ			|MODE_TEAM	|AはBの声が聞こえていない	|BはAの声が聞こえていない	|


### 4、音声距離範囲に対する補充：
  - 音声距離範囲以内にあるかどうかは、同じチームメンバーの相互通話を影響しません。
  - 音声受信距離範囲の設定はAPI：UpdateAudioRecvRangeをご参照ください
  - レンジボイスルームにおける音声モードのリアルタイムの切り替えに対応していますが、ルームにおけるTeamIDの変更に対応していません、TeamIDは入室する前に指定する必要があります。




## 利用手順

一般的なチーム音声ルームとは違い、レンジボイス機能を使用する場合、 EnterRoomの前に、下記の二つのAPIを呼び出す必要があります。

### 1、TeamIDの設定

- この方法によりチームナンバーを設定するには、 EnterRoomの前に呼び出さなければなりません、そうしない場合は、エラーコード AV_ERR_ROOM_NOT_EXITED(1202)を戻します

- 退室する時に、当該パラメータが自動的に0にリセットされないため、当該ボイスモードを呼び出すことを決めたら、毎回はEnterRoomの前にこの方法を呼び出しTeamIDを設定してください

####  関数のプロトタイプ
```
ITMGContext SetRangeAudioTeamID(int teamID)
```

|パラメータ     | タイプ         |意味|
| ------------- |:-------------:|-------------                    |
| teamID|int    | チームナンバーであり、レンジボイスの利用中に上りオーディオ/下りオーディオを制御することに使われている。 TeamID が0の場合は、通話モードは一般チームボイスで、デフォルトは０である。   |
### 2、AudioModeの設定

- この方法で音声モードを変更する場合、入室する前にも、入室する後にも呼び出すことが可能です。

- 入室する前にこの方法を呼び出した場合は、当該方法は次回の入室をも影響します。

- 入室した後にこの方法を呼び出した場合は、直接に現在ユーザーの音声モードを変更します。

- 退室する時に、このパラメータは自動的に MODE_WORLDにリセットされないため、この方法を呼び出すことを決めたら、毎回はEnterRoomの前にこの方法を呼び出し、audioModeを設定してください


関数のプロトタイプ

  
```
ITMGRoom int SetRangeAudioMode(RANGE_AUDIO_MODE rangeAudioMode)
```

|パラメータ     | タイプ         |意味|
| ------------- |:-------------:|-------------|
| rangeAudioMode    |int     |0(MODE_WORLD) は「全員」、1(MODE_TEAM) は「チームのみ」を示しています|


### 3、音声受信距離範囲の設定

- この方法で設定された音声受信範囲（距離はゲームエンジンによって異なる）は、正常に入室した後に呼び出すことが可能です。
  
- この方法はUpdateSelfPositionと連携し音源位置を更新することに使われています

####  関数のプロトタイプ 

```
ITMGRoom int UpdateAudioRecvRange(int range)
```

|パラメータ     | タイプ         |意味|
| ------------- |-------------|-------------|
| range    |int         | オーディオ受信可能の最大範囲|

####  サンプルコード  

```
ITMGContext.GetInstance().GetRoom().UpdateAudioRecvRange(300);
```

### 4、音源位置の更新

- この関数は音源位置情報の更新に使われ、正常に入室した後に利用することが可能です。

- 当該製品の形態では、位置情報のみが必要であり、音声の方向を指定する必要がありません。

- 音源と聴衆の距離を判定する際に、音源の SelfPostion、聴衆の SelfPostion と AudioRecvRange を利用し連携判定します。


####  関数のプロトタイプ

```
public abstract int UpdateSelfPosition(int position[3], float axisForward[3], float axisRight[3], float axisUp[3])
```

|パラメータ     | タイプ         |意味|
| ------------- |-------------|-------------|
| position   |int[]|自分が世界座標系において座標である。順序は前、右、上である|
| axisForward   |float[]  |本製品では考慮する必要がありません|
| axisRight    |float[]  |本製品では考慮する必要がありません|
| axisUp    |float[]  |本製品では考慮する必要がありません|
