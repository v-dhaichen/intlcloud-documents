## 개요

Tencent Cloud GME(GME) SDK를 이용해주셔서 감사합니다. 개발자가 Tencent Cloud GME 제품 API를 디버깅하고 액세스하는 편의성을 위해 GME 범위 음성 액세스 기술 파일을 소개드립니다. 


GME 범위 음성은 서바이벌 장르의 게임을 위해 맞춤제작한 제품입니다. 다음 성능은 일반적인 팀의 음성 방성능과 구분됩니다:

#### 1. 서바이벌 장르의 게임에 특화된 ‘팀 전용’ 혹은 ‘전체 유저’ 음성 모드를 제공합니다

#### 2. 범위 판단 능력을 기반으로 같은 음성 방에서 다량 유저가 동시에 마이크를 오픈하여 음성통화할 수 있습니다.



## 기본 콘셉트

### 1. 방에 들어갈 때 TeamID != 0을 지정할 경우, 범위 음성 방 모드가 적용됩니다;

### 2. 범위 음성 방에 들어갈 경우, 2종 음성모드를 선택할 수 있습니다:

| 음성 모드 | 파라미터 명칭               | 기능                           |
| -------- | ---------------------- | -------------------------------------------- |
| 전체 유저   | RANGE_AUDIO_MODE_WORLD | 설정 시 유저 근처 일정한 범위내 기타 유저들은 모두 이 유저의 말을 들을 수 있습니다 |
| 팀 전용   | RANGE_AUDIO_MODE_TEAM  | 팀원만 들을 수 있습니다                               |

### 3. 음성모드별로 사운드 달성 상황은 다음과 같습니다:  

  #### A유저의 상태가 “전체 유저”일 경우, B유저가 다른 음성모드에서 사운드 달성 상황: 

|같은 팀 여부   |범위내 여부   |음성모드   |A는 B의 목소리를 들을 수 있는가   |B는 A의 목소리를 들을 수 있는가   |
|-----------------   |------------   |------------   |--------------------------    |--------------------------   |
|같은 팀       |예           |MODE_WORLD     |A는 B의 목소리를 들을 수 있음     |B는 A의 목소리를 들을 수 있음      |
|같은 팀       |예           |MODE_TEAM      |A는 B의 목소리를 들을 수 있음     |B는 A의 목소리를 들을 수 있음      |
|같은 팀       |아니요        |MODE_WORLD     |A는 B의 목소리를 들을 수 있음     |B는 A의 목소리를 들을 수 있음      |
|같은 팀       |아니오        |MODE_TEAM      |A는 B의 목소리를 들을 수 있음     |B는 A의 목소리를 들을 수 있음      |
|다른 팀       |예           |MODE_WORLD     |A는 B의 목소리를 들을 수 있음     |B는 A의 목소리를 들을 수 있음      |
|다른 팀       |예           |MODE_TEAM      |A는 B의 목소리를 들을 수 없음     |B는 A의 목소리를 들을 수 없음      |
|다른 팀       |아니오        |MODE_WORLD     |A는 B의 목소리를 들을 수 없음     |B는 A의 목소리를 들을 수 없음      |
|다른 팀       |아니오        |MODE_TEAM      |A는 B의 목소리를 들을 수 없음     |B는 A의 목소리를 들을 수 없음      |

  #### A유저의 상태가 “팀 전용”일 경우, B유저가 다른 음성모드에서 사운드 달성 상황:

| 같은 팀 여부 | 범위내 여부 | 음성모드   | A는 B의 목소리를 들을 수 있는가 | B는 A의 목소리를 들을 수 있는가 |
| ------------ | ----------- | ---------- | ------------------------------- | ------------------------------- |
| 같은 팀      | 예          | MODE_WORLD | A는 B의 목소리를 들을 수 있음   | B는 A의 목소리를 들을 수 있음   |
| 같은 팀      | 예          | MODE_TEAM  | A는 B의 목소리를 들을 수 있음   | B는 A의 목소리를 들을 수 있음   |
| 같은 팀      | 아니오      | MODE_WORLD | A는 B의 목소리를 들을 수 있음   | B는 A의 목소리를 들을 수 있음   |
| 같은 팀      | 아니오      | MODE_TEAM  | A는 B의 목소리를 들을 수 있음   | B는 A의 목소리를 들을 수 있음   |
| 다른 팀      | 예          | MODE_WORLD | A는 B의 목소리를 들을 수 없음   | B는 A의 목소리를 들을 수 없음   |
| 다른 팀      | 예          | MODE_TEAM  | A는 B의 목소리를 들을 수 없음   | B는 A의 목소리를 들을 수 없음   |
| 다른 팀      | 아니오      | MODE_WORLD | A는 B의 목소리를 들을 수 없음   | B는 A의 목소리를 들을 수 없음   |
| 다른 팀      | 아니오      | MODE_TEAM  | A는 B의 목소리를 들을 수 없음   | B는 A의 목소리를 들을 수 없음   |




### 4. 음성 거리 범위 보충:
  - 음성 거리 범위에 있는지, 같은 팀 멤버끼리 통화하는데 영향을 미치지 않습니다.
  - 수신 음성 거리 설정은 API：UpdateAudioRecvRange를 참조하십시오
  - 범위 음성 방에서 실시간 음성모드를 변경할 수 있습니다. 방에서 TeamID를 변경할 수 없으며, TeamID는 반드시 방에 들어가기 전에 지정해야 합니다.




## 사용 프로세스

일반적인 팀 음성 방과 달리, 범위 음성 성능을 사용 시 EnterRoom 전에 다음 2종 API를 호출해야 합니다:

### 1. TeamID 설정

- 이 방법을 통해 팀 번호를 설정합니다. 반드시 EnterRoom 전에 호출해야 하며, 그러지 않을 경우 직접 에러코드 AV_ERR_ROOM_NOT_EXITED(1202)를 리턴합니다.

- 방에서 나갈 때 이 파라미터는 스스로 0으로 리셋하지 않으므로, 이 음성모드를 호출 시, 매번 EnterRoom 전에 이 방법을 호출하여 TeamID를 설정하십시오

#### 함수 프로토타입
```
ITMGContext SetRangeAudioTeamID(int teamID)
```

|파라미터     | 타입         |의미|
| ------------- |:-------------:|-------------                    |
| teamID|int    | 팀 번호, 범위 음성에서 업/다운스트리밍 가청주파수 제어 맞춤용입니다. TeamID가 0일 경우, 통화모드는 일반 팀 음성이며, 기본값은 0입니다.|

### 2. AudioMode 설정

- 이 방법을 통해 음성모드를 변경합니다. 방에 들어가기 전에 호출하거나 방에 들어간 후에 호출할 수 있습니다.

- 방에 들어가기 전에 이 방법을 호출하면, 다음 방에 들어갈 때 영향을 미칩니다.

- 방에 들어간 후 이 방법을 호출하면 기존 유저의 음성모드를 변경합니다. 

- 방에서 나갈 때 이 파라미터는 스스로 MODE_WORLD로 리셋하지 않으므로, 이 방법을 호출 시 매번 EnterRoom 전에 이 방법을 호출하여 audioMode를 설정해야 합니다.


함수 프로토타입


```
ITMGRoom int SetRangeAudioMode(RANGE_AUDIO_MODE rangeAudioMode)
```

|파라미터    | 타입         |의미|
| ------------- |:-------------:|-------------|
| rangeAudioMode    |int     |0(MODE_WORLD) “전체 유저”를 대표합니다. 1(MODE_TEAM) 은 “팀 전용”을 의미합니다|


### 3. 수신 음성 거리 범위 설정 

- 이 방법을 통해 수신하는 음성 범위(거리는 게임 엔진을 기준으로 합니다)를 설정합니다. 오직 방에 들어가야 호출할 수 있습니다.
  
- 이 방법은 반드시 UpdateSelfPosition과 음원 방위 업데이트를 공동으로 사용해야 합니다.

#### 함수 프로토타입 

```
ITMGRoom int UpdateAudioRecvRange(int range)
```

|파라미터    | 타입         |의미|
| ------------- |-------------|-------------|
| range    |int         | 가청주파수를 수락 가능한 최대 범위|

#### 예시 코드  

```
ITMGContext.GetInstance().GetRoom().UpdateAudioRecvRange(300);
```

### 4. 음원 방위 업데이트

- 이 함수는 음원 위치 메시지를 업데이트합니다. 오직 방에 들어가야 호출할 수 있습니다.

- 이 제품의 형태에서 위치만 필요하며, 사운드 방향을 지정하지 않습니다.

- 음원과 청중간 거리를 판정 시에 음원의 SelfPostion, 청중의 SelfPostion과 청중의 AudioRecvRange를 적용하여 연합하여 판정합니다.


#### 함수 프로토타입

```
public abstract int UpdateSelfPosition(int position[3], float axisForward[3], float axisRight[3], float axisUp[3])
```

|파라미터     | 타입         |의미|
| ------------- |-------------|-------------|
| position   |int[]|월드 좌표계 속 나의 좌표, 순서는 앞, 우, 위|
| axisForward   |float[]  |이 제품에서 주목할 필요 없음|
| axisRight    |float[]  |이 제품에서 주목할 필요 없음|
| axisUp    |float[]  |이 제품에서 주목할 필요 없음|
