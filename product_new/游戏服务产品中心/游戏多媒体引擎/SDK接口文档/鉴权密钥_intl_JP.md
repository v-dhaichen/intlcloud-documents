開発者がTencent Cloud Gaming Multimedia Engineのデバッグやアクセスを行いやすいように、すべてのプラットフォームに適用する認証キーの技術ドキュメントについて説明させていただきます。


## 音声キーのバッグクラウドデプロイ
Tencent Cloud Gaming Multimedia Engineは、リアルタイム音声とオフライン音声の認証に使われる認証キーを提供しています。このドキュメンテーションはバックグラウンドデプロイソリューションです。
認証に使用されるサインの作成プロセスは、**平文**、**キー**と**アルゴリズム**に関わっています。

### 平文
平文は、下記フィールドのネットワークバイトオーダーの組み合わせです。

|フィールドの説明    | タイプ/長さ| 値の定義/備考|
| ---------------- |-------------------|--------------|
| cVer|unsigned char/1|バージョン番号、入力値：1|
| wOpenIDLen|unsigned short/2|ユーザーアカウントの長さ|
| strOpenID|wOpenIDLen|ユーザーアカウントのID文字|
| dwSdkAppid|unsigned short/4|開発者のSDKappid|
| dwReserved1|unsigned int/4|入力値：0|
| dwExpTime|unsigned int/4|期限切れの時刻（現在時間+有効期間[単位：秒。300秒をお薦めします]）|
| dwReserved2|unsigned int/4|入力値：-1 又は 0xFFFFFFFF|
| dwReserved1|unsigned int/4|入力値：0|
| wRoomIDLen|unsigned short/2|ユーザーは入室するルームのIDの長さである。オフライン音声サービスの場合は、0を入力してください|
| strRoomID|wRoomIDLen|ユーザーは入室するルームの番号の文字|

### キー
Tencent Cloud GMEコンソールで関連する権限キーを取得します。
![](https://main.qcloudimg.com/raw/5f360cf9f725960c08db4de4f06068da.png)

### アルゴリズム
TEA対称暗号化アルゴリズムです。
全体としては、初期にはクライアントにデプロイし、後期にはゲームAppのバックグラウンドにデプロイすることをお薦めします。

|ソリューション     | メリット        | デメリット|
| ------------- |-------------|-------------| 
| バックグラウンドデプロイ    |安全性が高い|バックグラウンドでの開発と結合テストが必要|
| クライアントデプロイ     |迅速にアクセスする|安全性が低い|

#### バックグラウンドデプロイの使い方
バックグラウンドで暗号化の文字列を生成してから、クライアントにデリバーします。クライアントは下記ケースに適用されています。API:EnterRoomを呼び出し入室する時に、暗号化した文字列を入室パラメータのauthBufferフィールドに発送します。




### 暗号化アルゴリズムに関する詳細状況
- キー：APPIDは認証キーのmd5値に対応し、長さが16バイトである
- 暗号化アルゴリズム：TEA暗号化
- 暗号化ベース及びその例：添付ファイル [authbuffer.zip](https://main.qcloudimg.com/raw/c8be793e20c85114499f52e0f8c29190.zip)

>コンソールでキー変更をした後に、有効になるまでには15分～1時間かかりますので、頻繁に変更しないことをお薦めします。



#### 暗号化の方法	
- 暗号文における数字をネットワークバイトオーダー（ビッグエンディアン）に変換します。
- 暗号文を文字列に組み合わせます。
- tea暗号化で文字列を暗号化し、symmetry_encrypt関数の出力する文字列が権限暗号化文字列です。

>バイナリーの文字列を16進数に変換する必要がありません。


