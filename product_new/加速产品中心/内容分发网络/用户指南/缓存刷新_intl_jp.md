## 機能の説明
Content Delivery Network（CDN）は基本的なキャッシュ構成機能を提供しています。サービスタイプやディレクトリ、具体的なURL等各種のルールにより、キャッシュ期限切れ期間を設定することにより、定期的にノードのキャッシュリソースをクリアし、オリジンサーバーが最新のリソースを再度プルしキャッシュする目的を果たします。

このほかには、CDNはキャッシュ更新機能を提供しています。URL又はディレクトリを一括指定して更新操作を行うことができます。
- URLを更新する：CDNのすべてのノードにおける対応するリソースのキャッシュを削除します。
- ディレクトリを更新する：【変更リソースの更新】モードを選択します。ユーザーがマッチングしたディレクトリにおけるリソースにアクセス時に、オリジンプルし、Last-Modifyリソースの情報を取得します。現在のキャッシュリソースと一致している場合は、直接にキャッシュしているリソースを戻します。不一致である場合は、オリジンプルを行い、リソースをプルしてからキャッシュしなおします。【すべてのリソースを更新する】を選択する時に、ユーザーがマッチングしたディレクトリにおけるリソースにアクセス場合は、直接に新しいリソースをプルしユーザーに戻し、新しいリソースを再度キャッシュします。

更新は成功した後に、ノードにおける対応するリソースは有効なキャッシュがありません。ユーザーが再度アクセスする時に、ノードがオリジンサーバーに戻り必要なリソースをプルし、ノードに再度キャッシュします。そのため、大量の更新タスクをサブミットすることにより、比較的に多くのキャッシュがクリアされるため、オリジンプルリクエストが激増し、オリジンサーバーに大きな負荷がかかってしまいます。

## ユースケース
### 新しいリソースのリリース
オリジンサーバーで新しいリソースで同名の旧ソースを上書きする後、ネットワーク全体におけるユーザーがノードのキャッシュに影響され旧いリソースにアクセスしてしまうことを避けるために、対応するリソースのURL / ディレクトリをサブミットし更新を行い、ネットワーク全体のキャッシュをクリアすることにより、ネットワーク全体におけるユーザーは直接に最新のリソースにアクセスすることが可能となります。

### 違法リソースの整理
サーバーにおける違法リソース（例えばエロチック関連、麻薬関連、ギャンブル関連）が見つかった場合は、オリジンサーバーのリソースを削除してから、ノードにおけるキャッシュリソースはまたアクセスされることが可能であるため、ネットワーク環境を守るために、URL更新によりキャッシュのリソースを削除することにより、タイムリーなクリアを確保することが可能です。

## 操作ガイド
### 利用方法
1.  [CDN コンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のディレクトリの【キャッシュ更新】をクリックし、ページに入ってから必要に応じ【URL 更新】又は【ディレクトリ更新】をサブミットできます。
![](https://main.qcloudimg.com/raw/5e86a9b882255155dbdfcbb8afbe2eff.jpg)
![](https://main.qcloudimg.com/raw/f132ce7a7b23a8d1e1d4019a8aee8f12.jpg)
2. 【操作記録】モジュールでは、期間や検索条件、タイプを指定し、サブミットされていた更新操作に対し状態を確認することができます：
![](https://main.qcloudimg.com/raw/23e7bbf27b30f84ca275810866cecf77.jpg)
>?コンソールは最大で10000件の操作記録を一括で戻すことが可能であり、完全なexcel形式のファイルでエクスポートされることを対応しています。更新タスクが多い場合は、分割してからクエリー及びエクスポートを行ってください。

### 注意事項
#### URLの更新：
- アカウントごとに1日当りのURL更新は10000件までです。毎回サブミットできるURL更新は1000件までです。
- 更新タスクをサブミットする際に、`http:/`又は `https://`プロトコルマークをつける必要があります。
- `http://*.test.com/` フォーマットのURL更新を対応していません。汎用ドメイン名をインポートし加速サービスを行っても、更新する際に対応するサブドメイン名をサブミットする必要があります。
- 更新をサブミットする際に、URLにおけるドメイン名は加速サービスを導入する必要があります。そうしないと、サブミットの失敗を引き起こすことがあります。
- パスに中国語の入っているURLの更新を対応していません。

#### ディレクトリの更新：
- アカウントごとに1日当りのディレクトリ更新は100件までです。毎回サブミットできるディレクトリ更新は20件までです。
- 更新タスクをサブミットする際に、`http://`或`https://`プロトコルマークをつける必要があります。
- `http://*.test.com/`フォーマットのディレクトリの更新を対応していません。汎用ドメイン名をインポートし加速サービスを行っても、更新する際に対応するサブドメイン名をサブミットする必要があります。
- 更新をサブミットする際に、URLにおけるドメイン名は加速サービスを導入する必要があります。そうしないと、サブミットの失敗を引き起こすことがあります。
- パスに中国語の入っているURLディレクトリ更新を対応していません。

#### サブユーザーの権限設定：
- ディレクトリ更新、URL更新、更新記録クエリーは現在は導入されていた最新の権限システムです。リソース（ドメイン名）に関する権限構成を対応しています。
- アサイン方法は [権限構成](https://intl.cloud.tencent.com/document/product/228/12722) ドキュメンテーションの説明を照会できます。

## 利用事例
### ディレクトリ更新-変更リソースを更新する
加速ドメイン名がpurge-test-1251991073.file.myqcloud.comであり、オリジンサーバーがTencent CloudのCloud Object Storage（COS）です。オリジンサーバーのリソースが下記の通りです。
1. それぞれリソース1.txt と2.txtのアクセスリクエストを提出し、X-Cache-Lookup: Hit From Distank3 及び Server: NWS_SPMid により命中されたノードを判定することができます。ノードより直接にリソースを戻します。
![](https://main.qcloudimg.com/raw/8e5e1d55743f83340b6801942011a951.jpg)
![](https://main.qcloudimg.com/raw/dc50a49f1177c0a671c0f10f874b0a0b.jpg)
2. オリジンサーバーで同名ファイルの1.txtを差し替え、ファイル修正時間が変更されます。2.txtはそのままにします。
3. この際に、再度リクエストを出します。キャッシュはまだ期限切れになっていないため、リソース1.txtへのアクセスがやはり旧い内容のままです。
![](https://main.qcloudimg.com/raw/f08fcfe681ff6684ef9ebf96d7a7b5ab.jpg)
4. ディレクトリ更新をサブミットし、【変更リソースを更新する】を選択し、更新の完了を待ちます。
5. 更新した後に、1.txt Last-Modifiedは変更があったため、オリジンプルをリクエストします。ファイル2.txtは変更がなかったため、即時にディレクトリ更新をサブミットし、ノードに命中され戻されます。
![](https://main.qcloudimg.com/raw/d1e83b5357fc878d6f1df56f0f1cd84b.jpg)
![](https://main.qcloudimg.com/raw/29e68b2f6207731a689e9c11ee1bf849.jpg)

