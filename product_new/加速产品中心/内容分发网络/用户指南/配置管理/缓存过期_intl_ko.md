## 캐시 만료 설정은 무엇입니까?
- 캐시 만료 설정은 CDN 캐시 노드가 서비스 콘텐츠를 캐시할 때, 한 세트의 기간 만료 규칙을 설정하는 것을 가리킵니다. CDN 노드에 캐시된 사용자 리소스에는 "기간 만료" 문제가 있습니다.
 - 리소스가 만료되지 않은 상태인 경우, 사용자가 노드에 도달하도록 요청한 후, 노드는 리소스를 사용자에게 직접 반환하여 획득 속도를 향상합니다.
 - 리소스가 만료 상태(설정된 유효 시간을 초과)인 경우, 사용자 요청이 노드에 의해 원본 서버로 전송되고, 새롭게 내용을 얻고 노드로 캐시된 후 사용자에게 리턴됩니다.
- Tencent Cloud CDN은 각 차원의 콘텐츠 캐시 시간 설정, 사용자 정의 우선순위 조정, 캐시 상속 정책(고급 캐시 설정), 404 상태 코드 캐시 만료 시간 설정 및 HTTP Response header 캐시 정책 설정을 지원합니다. 캐시 시간을 올바르게 설정하면, 히트율을 높이고 반환율을 줄이며 대역폭을 절약할 수 있습니다.

## 콘텐츠 캐시
### 구성 안내
1. [CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인하고 왼쪽 메뉴의 [도메인 관리]를 클릭하여 편집할 도메인의 오른쪽의 [관리]를 클릭합니다.
2. [캐시 설정]을 클릭하면 **캐시 만료 설정** 모듈을 볼 수 있습니다.
3. 도메인 이름에 액세스하면 기본 구성은 다음과 같습니다.
  - 외부 원본 도메인 이름 액세스: 모든 파일의 캐시 만료 시간 기본값은 30일이지만 동적 파일(예 .php .jsp .asp .aspx) 의 기본값은 0으로 이러한 동적 파일은 요청을 받으면 직접 원본 가져오기를 진행합니다.
 - COS 원본 도메인 이름 액세스: 모든 파일의 캐시 만료 시간 기본값은 30일입니다.
 - 기본적으로 고급 캐시 만료 설정이 비활성화되어 있습니다.

### 수정 구성
[캐시 설정 추가]를 클릭하여 캐시 설정을 추가할 수 있습니다. 서비스 요구사항에 따라 기본 설정에 캐시 시간 설정을 추가할 수 있습니다. CDN은 다음과 같은 방식으로 캐시 만료 시간 설정을 지원합니다.
 - **파일 유형에 따른 캐시 만료 시간 설정 **
아래와 같이 파일 유형 접미사를 입력하고 유형에 따라 캐시 시간을 설정할 수 있습니다.
캐시 시간을 설정할 때, 여러 항목을 기재할 수 있습니다. 각 항목은 `;`로 구분되며 내용은 대소 문자를 구분하며 `.png`와 같이 `.`로 시작하는 파일 확장명이어야 합니다. 새로고침 시간이 0으로 설정되면, 캐시 되지 않고 모든 요청이 사용자 원본 서버로 전달됩니다. 캐시 시간 설정은 최대 365일을 초과할 수 없습니다.
 - **파일 폴더에 따른 캐시 만료 시간 설정**
다음과 같이 폴더 경로를 채우고 폴더를 기준으로 캐시 시간을 설정할 수 있습니다.
캐시 시간을 설정할 때, 여러 항목을 기재할 수 있습니다. 각 항목 은;;`로 구분되며 내용은 대소 문자를 구분하며 `/`로 시작하는 폴더여야 합니다. 새로고침 시간이 0으로 설정되면, 캐시 되지 않고 모든 요청이 사용자 원본 서버 전달됩니다. 캐시 시간 설정은 최대 365일을 초과할 수 없습니다.
 - **전체 경로 파일에 따른 캐시 만료 시간 설정**
다음과 같이 특정 파일의 캐시 시간을 설정할 수 있습니다.
캐시 시간을 설정할 때, 여러 항목을 기재할 수 있습니다. 각 항목은 `;`로 구분되며 내용은 대소 문자를 구분합니다. `*`는 `/test/abc/*. jpg`와 같은 특정 유형의 파일과 일치합니다.
-  **홈페이지에 따른 캐시 만료 시간 설정 **
홈페이지를 지정하여 다음과 같이 캐시 시간을 설정할 수 있습니다.

### 우선순위
1. 여러 캐시 정책이 설정되면 정책 간에 중복이 발생할 수 있습니다.
>구성 항목 목록의 가장 아래가 가장 위보다 우선 순위가 높습니다.

 도메인 이름이 다음과 같이 구성되었을 경우
 - 모든 파일 30일
 - .php .jsp .aspx 0초
 - .jpg .png .gif 300초
 - /test/*.jpg 400초
 - /test/abc.jpg 200초

2. 도메인 이름은 www.test.com이고, 리소스는 www.test.com/test/abc.jpg일 경우에는 매칭하는 방법은 다음과 같습니다.
 - 첫 번째 모든 파일과 매칭, 도달 시 캐시 시간 30일
 - 두 번째 파일 매칭, 미도달
 - 세 번째 파일 매칭, 도달 시 캐시 시간 300초
 - 네 번째 파일 매칭, 도달 시 캐시 시간 400초
 - 다섯 번째 파일 매칭, 도달 시 캐시 시간 200초

따라서 최종 캐시 시간은 200초이며, 마지막 매칭이 유효합니다.

3. [우선순위조정]를 클릭하여 캐시 설정을 추가합니다. 서비스 요구사항에 따라 추가된 캐시 만기 설정 순서를 사용자 정의 조정 할 수 있습니다.
4. 오른쪽 위 및 아래 화살표를 사용하여 캐시 만료 시간 설정 순서를 조정하고 [저장]을 클릭하여 조정을 완료합니다.

### 캐시 상속
사용자가 특정 서비스 리소스를 요청하면, 원본 서버에 해당하는 Response HTTP Header에 Cache - Control 필드가 있으며, 기본 정책은 다음과 같습니다.
- Cache - Control 필드를 max - age로 설정하면, 해당 리소스의 캐시 시간은 max - age 지정 시간을 따르지 않고 설정된 캐시 시간을 기준으로 합니다.
- Cache- Control 필드를 no - cache 나 no - store로 설정하면, 이때 CDN 노드가 이 리소스를 캐시하지 않습니다.
- Cache - Control 필드가 없는 경우, CDN은 기본적으로 `Cache - Control: max - age = 600 `접두사를 추가합니다.

### 고급 캐시 설정
1. 캐시 만료 설정 모듈에서 ** 고급 캐시 만료 설정 *을 찾아 * 클릭하여 활성화합니다.
2. 고급 캐시 만료 설정 스위치가 활성화 후, 사용자가 원본 서버에 리소스를 요청할 때, Response HTTP Header에 Cache - Control 필드가 있습니다. 이 때  값이 `max - age = xxxx`일 때, 노드는 해당 리소스의 캐시 시간이 매칭된 만료 시간과 max - age 중 제일 최솟값을 사용합니다.
  - 사용자 원본 서버 구성`/index.html`의 max - age는 200초이고, CDN이 매칭한 캐시 시간 600초, 파일 실제 만료 시간은 200초입니다.
 - 사용자 원본 서버 구성`/index.html`의 max - age는 800초, CDN에 해당하는 캐시 시간은 600초, 실제 파일 만료 시간은 600초입니다.

## 헤더 캐시
리소스가 노드의 캐시에 도달하면, CDN은 원본 서버 헤더에서 다음을 캐시하여 사용자에게 리턴합니다.
- Access - Control - Allow - Origin
- Timing - Allow - Origin
- Content - Disposition
- Accept - Ranges 

[도메인 관리]의 [캐시 설정] 모듈로 이동하여 [캐시 소스 모든 헤드] 기능을 수동으로 활성화하면, CDN이 모든 원본 서버를 캐시하여 헤더 정보를 리턴합니다.


## 상태 코드 캐시
1. 노드가 원본 서버 리소스 요청 시 위의 캐시 정책 외에  상태 코드에 따라 다음과 같은 기본 캐시 정책도 시행합니다.
 - 2XX: 일반 캐시 정책을 따릅니다.
 - 3XX: 기본값이 캐시되지 않습니다.
 - 4XX: 404캐시 10s, 다른 기본값은 캐시되지 않습니다.
 - 5XX: 기본값이 캐시되지 않습니다.
2. [캐시 설정] 중 [상태 코드 캐시] 모듈에서 404캐시 시간을 조정할 수 있습니다.

404 상태 코드 캐시 시간은 0-3,600초로 조정할 수 있습니다.
>파일에 해당하는 캐시 만료 시간이 0이고, 404가 생성된 후에도 지속해서 캐시 원칙을 따르고 직접 통과합니다.

