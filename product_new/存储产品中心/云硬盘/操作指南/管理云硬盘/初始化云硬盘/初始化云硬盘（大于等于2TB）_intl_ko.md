## 작업 시나리오
본 문서는 2TB 이상의 CBS(Cloud Block Storage) 용량을 예시로 하여 CBS의 초기화 시나리오의 가이드 라인을 제공합니다. CBS 초기화 시나리오에 대한 자세한 내용은 [초기화 시나리오 소개](https://intl.cloud.tencent.com/document/product/362/31596)를 참조하십시오.
MBR이 지원하는 최대 디스크 크기는 2TB이므로 용량이 2TB보다 큰 디스크 파티션의 경우, GPT 파티션 형식을 사용하십시오. Linux 운영 체제의 경우, 디스크 파티션 형식이 GPT를 사용할 때, fdisk 파티션 도구를 사용할 수 없고 parted 도구를 사용해야 합니다.

## 전제 조건
>- 데이터 디스크를 포맷하면 모든 데이터가 지워집니다. 데이터 디스크에 데이터가 없거나 중요한 데이터가 백업되었는지 확인하십시오.
>- 만일의 상황을 대비하여 포맷하기 전에 CVM이 외부 서비스를 중단했는지 확인하십시오.
>
>CVM에 [CBS 마운트](/doc/product/362/5745)를 진행하십시오.

## 작업 순서
<span id="2TBWindows2012"></span>
### CBS 초기화(Windows)
>?본 문서는 Windows Server 2012 운영 체제를 예시로 합니다. 다른 운영 체제의 포맷 작업은 다를 수 있으니 본 문서는 참조용으로만 사용하십시오.

1. [Windows CVM에 로그인](https://intl.cloud.tencent.com/document/product/213/5435)
2. CVM 데스크탑에서 <img src="https://main.qcloudimg.com/raw/0a02193a82217974f650bbcaf4e1ed2d.png" style="margin:0;"> 클릭하여 [서버 관리 페이지]로 이동하십시오.
3. 왼쪽의 사이드바에서 [파일과 스토리지 서비스]를 클릭하십시오.
4. 왼쪽의 사이드에서 [볼륨] > [디스크]를 선택하십시오.

>새 디스크가 오프라인 상태인 경우(위 이미지와 참조), [5단계](#online)를 수행한 다음 [6단계](#initialize)를 수행하여 초기화를 진행합니다. 그렇지 않은 경우 [6단계](#initialize)를 직접 수행하여 초기화를 진행합니다.

<span id="online"></span>
5. 오른쪽 창에 디스크 리스트가 나타나면, 1이 있는 라인을 마우스 우클릭한 다음 메뉴 리스트에서 [온라인]을 선택하십시오. 연결하면 1은 [오프라인]상태에서 [온라인]으로 변경됩니다.

<span id="initialize"></span>
6. 1이 있는 라인을 마우스 우클릭하고 메뉴 리스트에서 [초기화]를 선택하십시오.
 
7. 인터페이스 지시에 따라 [네]를 클릭하십시오.
 
8. 초기화 후 1이 [알 수 없음]파티션에서 [GPT]로 변경되고, 1이 있는 행을 마우스 우클릭한 다음 메뉴 리스트에서 [단순 볼륨 생성]을 선택하십시오.
 
9. [볼륨 가이드 생성] 팝업창 나타나면 인터페이스 지시에 따라 [다음 단계]를 클릭하십시오.
 
10. 서버와 디스크를 선택하고 [다음 단계]를 클릭하십시오.

11. 볼륨의 기본 값이 최댓값이며, 실제 상황에 따라 볼륨 크기를 지정하십시오. [다음 단계]를 클릭하십시오.
 
12. 디스크 드라이버 번호를 할당하고 [다음 단계]를 클릭하십시오.
 
13. [다음 설정에 따라 볼륨 포맷]을 선택하고 실제 상황에 따라 파라미터를 설정하여 새 파티션을 포맷 하십시오. [다음 단계]를 클릭하여 파티션 생성을 완료하십시오.

14. 정보에 오류가 없는지를 확인 후 [생성]을 클릭하십시오.

15. 시스템이 새 볼륨 작업을 완료할 때까지 잠시 기다린 후 [닫기]를 클릭하십시오.
 초기화가 완료되면 [해당 PC] 인터페이스에서 새 디스크를 확인하십시오.


<span id="2TBLinux"></span>
### CBS 초기화(Linux)

실제 사용 시나리오에 따라 초기화 방법을 선택하십시오.
- 전체 하드 디스크가 별도의 파티션으로 표시되는 경우(즉, vdb1 및 vdb2와 같은 여러 논리적 장치 디스크가 없는 경우), 파티션을 사용하지 않고 직접 [로우 디바이스에 파일 시스템 구축](# CreateFileSystemOnBareDevice)하는 것을 권장합니다.
- 전체 하드 디스크를 여러 개의 논리 파티션으로 표시해야 하는 경우(즉, 여러 개의 논리적 장치 디스크가 있는 경우), 파티션 작업을 진행하기 전에 [파티션에서 파일 시스템 구축](# CreateFileSystemOnPartition)을 해야 합니다.

<span id="CreateFileSystemOnBareDevice"></span>
#### 로우 디바이스에 파일 시스템 구축

1. [Linux CVM에 로그인](https://intl.cloud.tencent.com/document/product/213/5436)
2. root 사용자로 다음 명령어를 실행하여 디스크 이름을 확인하십시오.
 ```
fdisk -l
 ```
 에코 정보는 다음 이미지와 유사합니다. 현재 CVM에 디스크가 2개 있으며, “/dev/vda” 는 시스템 디스크, “/dev/vdb” 은 새로 추가된 데이터 디스크입니다.
 ![](https://main.qcloudimg.com/raw/aad842b12fec3ca583790bff609c9fb7.png)
3. 다음 명령어를 실행하여 "/dev/vdb"로우 디바이스에 대한 파일 시스템 형식을 직접 생성하십시오.
```
mkfs -t <파일 시스템 형식>/dev/vdb
```
파일 시스템마다 다른 파티션 크기를 지원하므로 실제 요구에 따라 파일 시스템을 선택하십시오. 파일 시스템을 'EXT4’로 설치한 경우를 예시로 합니다.
```
mkfs -t ext4 /dev/vdb
```
> 포맷 시 일정 시간이 소모되므로 시스템 실행 상태를 확인하고 종료하지 마십시오.
4. 다음 명령어를 실행하여 새로운 마운트 포인트를 생성하십시오.
```
mkdir <마운트 포인트>
```
새로운 마운트 포인트가 `/data`인 경우를 예시로 합니다.
```
mkdir /data
```
5. 다음 명령어를 실행하여 새 파티션을 새로운 마운트 포인트에 마운트하십시오.
```
mount /dev/vdb <마운트 포인트>
```
새로운 마운트 포인트가 `/data`인 경우를 예시로 합니다.
```
mount /dev/vdb /data
```
6. 다음 명령어를 실행하여 마운트 결과를 확인하십시오.
```
df -TH
```
>자동 부팅 마운트 디스크를 설정할 필요가 없다면 다음 단계를 건너 뜁니다.
7. 마운트 방식을 확인하고 해당 정보를 얻습니다.
엘라스틱 CBS의 소프트 링크, 파일 시스템의 UUID(Universally Unique Identifier) 또는 장치 이름을 사용하여 디스크를 자동으로 마운트하도록 선택할 수 있습니다. 관련 지시 사항 및 정보는 다음과 같습니다.
<table>
 <tr>
     <th>마운트 방식</th>
		 <th>장단점</th>
		 <th>정보 획득 방식</th>
 </tr>
 <tr>
     <td nowrap="nowrap">엘라스틱 CBS의 소프트 링크를 사용합니다.<b>(권장)</b></td>
		 <td><b>장점</b>: 엘라스틱 CBS의 소프트 링크는 모두 고정적이고 유일하여 언마운트에 따라 마운트되거나, 포맷에 따라 변하지 않습니다.</br><b> 단점:</b>오직 엘라스틱 CBS만 소프트 링크가 있기 때문에 소프트 링크와 포맷 작업을 감지할 수 없습니다.</td>
		 <td nowrap="nowrap">다음 명령어를 실행하여 엘라스틱 CBS의 소프트 링크를 확인하십시오.</br><pre>ls -l /dev/disk/by-id</pre></td>
 </tr>
 <tr>
     <td nowrap="nowrap">파일 시스템의 UUID 사용</td>
		 <td>파일 시스템의 UUID 변화에 따라 자동 마운트 설치가 유효하지 않을 수 있습니다.</br>예를 들어, 새로운 파일 시스템을 포맷하면 파일 시스템의 UUID가 변경됩니다.</td>
		 <td nowrap="nowrap">다음 명령어를 실행하여 파일 시스템의 UUID를 찾으십시오.</br><pre>blkid /dev/vdb</pre></td>
 </tr>
 <tr>
     <td nowrap="nowrap">장치 이름 사용</td>
		 <td>장치 이름이 변경되어 자동 마운트 설정이 유효하지 않을 수 있습니다.</br>예를 들어, 데이터가 마이그레이션되면 CVM의 엘라스틱 CBS가 언마운트된 후 다시 마운트됩니다 운영 체제가 파일 시스템을 다시 식별하면 이름이 변경될 수 있습니다.</td>
		 <td nowrap="nowrap">다음 명령어를 실행하여 장치 이름을 찾으십시오.</br><pre>fdisk -l</pre></td>
	</tr>
</table>
8. 다음 명령어를 실행하여 `/etc/fstab` 파일을 백업하십시오. /home 디렉터리에 백업하는 것을 예시로 합니다.
```
cp -r /etc/fstab /home
```
9. 다음 명령어를 실행하여 VI 편집기를 사용하여 `/etc/fstab` 파일을 엽니다.
```
vi /etc/fstab
```
10. **i**를 눌러 편집 모드로 진입합니다.
11. 커서를 파일 끝으로 이동하여 **Enter**를 누르고 다음 내용을 추가하십시오.
```
<장치 정보> <마운트 포인트> <파일 시스템 형식> <파일 시스템 설치 옵션> <파일 시스템 덤프 빈도> <시작 시 파일 시스템 순서 검사>
```
 - **(권장)** 엘라스틱 CBS의 소프트 링크를 사용하여 자동 마운트하는 경우를 예시로 하고 앞의 예시와 더불어 다음을 추가하십시오.
```
/dev/disk/by-id/virtio-disk-drkhklpe /data ext4 defaults 0 0
```
 - 디스크 파티션의 UUID를 사용하여 자동 마운트를 예시로 하고 앞의 예시와 더불어 다음을 추가하십시오.
```
UUID=d489ca1c-5057-4536-81cb-ceb2847f9954 /data  ext4 defaults     0   0
```
 - 장치 이름을 사용하여 자동 마운트를 예시로 하고 전문의 예시와 더불어 다음을 추가하십시오.
```
/dev/vdb /data   ext4 defaults     0   0
```
12. **Esc**를 누르고 **: wq**를 입력한 다음 **Enter**를 누르십시오.
설정을 저장하고 편집기를 종료하십시오.
13. 다음 명령어를 실행하여 `/etc/fstab` 파일이 성공적으로 작성되었는지 확인하십시오.
```
mount -a 
```
실행이 통과되면 파일이 성공적으로 입력된 것을 의미합니다. 새로 생성된 파일 시스템은 운영 체제가 부팅될 때 자동으로 마운트됩니다.

<span id="CreateFileSystemOnPartition"></span>
#### 파티션에 파일 시스템 구축

>?본 문서는 CentOS 7.5 운영 체제에서 파티션 parted 분할 도구를 사용하여 데이터 디스크 `/dev/vdc`를 기본 파티션으로 설정합니다. 파티션 포맷은 기본적으로 GPT로 설정되고, 파일 시스템은 EXT4 포맷으로 설정되며 '/data/newpart2'에 마운트되고, 부팅 시 자동 마운트되는 경우를 예로 들었습니다. 다른 운영 체제의 포맷 작업은 다를 수 있으니, 본 문서는 참조용으로 사용하십시오.

1. [Linux CVM에 로그인](https://intl.cloud.tencent.com/document/product/213/5436)
2. root 사용자로 다음 명령어를 실행하여 디스크 이름을 확인하십시오.
 ```
lsblk
 ```
에코 정보는 다음 이미지와 유사합니다. 현재 CVM에 디스크 2개가 있으며 "/dev/vda"는 시스템 디스크,  "/dev/vdc"는 새 데이터 디스크입니다.
	![](https://main.qcloudimg.com/raw/72a7a48c59c13a44958a6b1aa0407ac2.png)
3. 다음 명령어를 실행하여 parted 파티션 도구에 진입해 새로 추가된 데이터 디스크 파티션 조작을 시작하십시오.
```
parted <새로운 데이터 디스크>
```
새로 마운트된 데이터 디스크가 `/dev/vdc`인 경우를 예시로 합니다.
```
parted /dev/vdc
```
에코 정보는 다음과 유사합니다.
![](https://main.qcloudimg.com/raw/0b2c9164f9fec125a72dee8861b7327d.png)
4. `p`를 입력하고 Enter를 눌러 현재 디스크 파티션 형식을 보십시오.
 에코 정보는 다음과 유사합니다.
 ![](https://main.qcloudimg.com/raw/af906521dd6a7f3b948cfad42745aaba.png)
 [Partition Table: unknown]은 디스크 파티션 형식 알 수 없음을 의미합니다.
5. 다음 명령어를 실행하여 디스크 파티션 형식을 설정하십시오.
```
mklabel <디스크 파티션 방식>
```
디스크 용량이 2TB 이상인 경우 GPT 파티션 모드만 사용할 수 있습니다.
```
mklabel gpt
```
6. `p`를 입력하고 Enter를 눌러 디스크 파티션 형식이 성공적으로 설정되었는지 확인하십시오.
 에코 정보는 다음과 유사합니다.
	![](https://main.qcloudimg.com/raw/3dfec9aba75cd3cb6dcfb06729f5ff26.png)
 [Partition Table: gpt]는 디스크 파티션 형식이 GPT임을 의미합니다.
7. `unit s`를 입력하고 Enter를 눌러 디스크의 측정 단위를 실린더로 설정하십시오.
8. 전체 디스크에 대한 파티션을 생성할 경우를 예시로 하며 `mkpart opt 2048s 100 %`를 입력하고 Enter를 누르십시오.
 2048s는 디스크의 초기 용량을 나타내며, 100 %는 디스크 컷오프 용량을 나타냅니다. 서비스 요구사항에 따라 디스크 파티션 수량 및 용량을 설정할 수 있습니다.
9. `p`를 입력하고 Enter를 눌러 새로운 파티션의 자세한 정보를 확인하십시오.
    에코 정보는 다음과 유사합니다.
 ![](https://main.qcloudimg.com/raw/ee406e75c689f48d59e863adc768aa36.png)
 새로운 파티션`/dev/vdc1`의 자세한 정보를 의미합니다.
10. `q`를 입력하고 Enter를 눌러 parted 파티션 도구을 종료하십시오.
11. 다음 명령어를 실행하여 디스크 이름을 확인하십시오.
 ```
lsblk
 ```
에코 정보는 다음 이미지와 유사하며, 이 시점에서 새로운 파티션 "/dev/vdc1"을 확인할 수 있습니다.
![](https://main.qcloudimg.com/raw/f95f599f11f88b8bcb89d4f02bb41292.png)
12. 다음 명령어를 실행하여 새로운 파티션 파일 시스템을 시스템에 필요한 형식으로 설정하십시오.
```
mkfs -t <파일 시스템 형식> /dev/vdc1
```
파일 시스템마다 다른 파티션 크기를 지원하므로 실제 요구에 따라 파일 시스템을 선택하십시오. 파일 시스템을 'EXT4’로 설치한 경우를 예시로 합니다.
```
mkfs -t ext4 /dev/vdc1
```
 에코 정보는 다음과 유사합니다.
 ![](https://main.qcloudimg.com/raw/3cd6bbd019dd9bdc85ad4ed11ba64f0b.png)
 포맷 시 일정 시간이 소모되므로 시스템 실행 상태를 확인하고 종료하지 마십시오.
13. 다음 명령어를 실행하여 새로운 마운트 포인트를 생성하십시오.
```
mkdir <마운트 포인트>
```
새로운 마운트 포인트가 ‘/data/newpart2’인 경우를 예시로 합니다.
```
mkdir /data/newpart2
```
14. 다음 명령어를 실행하여 새 파티션을 새로운 마운트 포인트에 마운트하십시오.
```
mount /dev/vdc1 <마운트 포인트>
```
새로운 마운트 포인트가 ‘/data/newpart2’인 경우를 예시로 합니다.
```
mount /dev/vdc1 /data/newpart2
```
15. 다음 명령어를 실행하여 마운트 결과를 확인하십시오.
```
df -TH
```
 에코 정보는 다음과 유사합니다.
 ![](https://main.qcloudimg.com/raw/774c2d9ff266634c4836df6456b9dd4d.png)
 새로운 파티션`/dev/vdc1`이 `/data/newpart2`에 마운트 완료하였음을 의미합니다.

>자동 부팅 마운트 디스크를 설정할 필요가 없다면 다음 단계를 건너 뜁니다.
>
16. 마운트 방식을 확인하고 해당 정보를 획득합니다.
 엘라스틱 CBS의 소프트 링크, 파일 시스템의 UUID(Universally Unique Identifier) 또는 장치 이름을 사용하여 디스크를 자동으로 마운트하도록 선택할 수 있습니다. 관련 지시 사항 및 정보는 다음과 같습니다.
 <table>
     <tr>
         <th>마운트 방식</th>  
         <th>장단점</th>  
         <th>정보 획득 방식</th>  
     </tr>
	   <tr>      
         <td nowrap="nowrap">엘라스틱 CBS의 소프트 링크를 사용합니다.￼￼￼<b>(권장)</b></td>   
	       <td><b>장점</b>: 엘라스틱 CBS의 소프트 링크는 모두 고정적이고 유일하여 언마운트에 따라 마운트되거나, 포맷에 따라 변하지 않습니다.<br><b>단점</b>: 오직 엘라스틱 CBS만 소프트 링크가 있기 때문에 소프트 링크와 포맷 작업을 감지할 수 없습니다.</td>
	       <td nowrap="nowrap">다음 명령어를 실행하여 엘라스틱 CBS의 소프트 링크를 확인하십시오.</br><pre>ls -l /dev/disk/by-id</pre></td>
     </tr> 
	   <tr>      
         <td nowrap="nowrap">파일 시스템의 UUID 사용</td>   
	       <td>파일 시스템의 UUID 변화에 따라 자동 마운트 설치가 유효하지 않을 수 있습니다.</br>예를 들어, 새로운 파일 시스템을 포맷하면 파일 시스템의 UUID가 변경됩니다.</td>
	       <td nowrap="nowrap">다음 명령어를 실행하여 파일 시스템의 UUID를 확인하십시오.</br><pre> blkid /dev/vdc1</pre></td>
     </tr> 
	   <tr>      
         <td nowrap="nowrap">장치 이름 사용</td>   
	       <td>장치 이름이 변경되어 자동 마운트 설정이 유효하지 않을 수 있습니다.</br>예를 들어, 데이터가 마이그레이션되면 CVM의 엘라스틱 CBS가 언마운트된 후 다시 마운트됩니다 운영 체제가 파일 시스템을 다시 식별하면 이름이 변경될 수 있습니다.</td>
	       <td>다음 명령어를 실행하여 장치 이름을 확인하십시오.</br><pre>fdisk -l</pre></td>
     </tr> 
</table>
17. 다음 명령어를 실행하여  `/etc/fstab` 파일을 백업하십시오. /home 디렉터리에 백업하는 것을 예시로 합니다.
```
cp -r /etc/fstab /home
```
18. 다음 명령어를 실행하여 VI 편집기를 사용하여 `/etc/fstab` 파일을 엽니다.
 ```
vi /etc/fstab
 ```
19. **i**를 눌러 편집 모드에 진입합니다. 
20. 커서를 파일 끝으로 이동하여 **Enter**를 누르고, 다음 내용을 추가하십시오.
 ```
<장치 정보> <마운트 포인트> <파일 시스템 형식> <파일 시스템 설치 옵션> <파일 시스템 덤프 빈도> <시작 시 파일 시스템 순서 검사>
 ```
 - **(권장)** 엘라스틱 CBS의 소프트 링크를 사용하여 자동 마운트하는 경우를 예시로 하고 앞의 예시와 더불어 다음을 추가하십시오.
 ```
/dev/disk/by-id/virtio-disk-bm42ztpm-part1 /data/newpart2   ext4 defaults     0   2
 ```
 - 디스크 파티션의 UUID를 사용하여 자동 마운트를 예시로 하고 앞의 예시와 더불어 다음을 추가하십시오.
```
UUID=fc3f42cc-2093-49c7-b4fd-c616ba6165f4 /data/newpart2   ext4 defaults     0   2
```
 - 장치 이름을 사용하여 자동 마운트를 예시로 하고 전문의 예시와 더불어 다음을 추가하십시오.
```
/dev/vdc1 /data/newpart2   ext4 defaults     0   2
```
20. **Esc**를 누르고 **: wq**를 입력한 다음 **Enter**를 누르십시오.
 설정을 저장하고 편집기를 종료하십시오.
21. 다음 명령어를 실행하여 `/etc/fstab` 파일이 성공적으로 생성되었는지 확인하십시오.
```
 mount -a 
```
실행이 통과되면 파일이 성공적으로 입력된 것을 의미합니다. 새로 생성된 파일 시스템은 운영 체제가 부팅될 때 자동으로 마운트됩니다.

## 관련 작업
[CBS 초기화(2TB미만)](https://intl.cloud.tencent.com/document/product/362/6734)

