## ユースケース
このドキュメントはCBSの容量が2TB以上の場合を例として、CBSの初期化操作を説明します。ディスクの初期化処理の詳細については、 [初期化処理の紹介](https://intl.cloud.tencent.com/document/product/362/31596)をご参照ください。
MBRは最大2TBのディスク容量をサポートしているため、2TB以上のディスクパーティション処理を行う場合、GPT パーティション形式を利用してください。Linux OS には、ディスクのパーティション形式はGPTを選択する時、fdisk パーティションツールが使えなくなるため、partedツールを使用してください。

## 前提条件
>
>- データディスクをフォーマットすると、すべてのデータがクリアされます。 データディスクにデータを保存しないか、重要なデータがバックアップされているかを確認してください。
>- サービス異常を回避するために、フォーマットを実行する前に、CVMが外部へのサービスを停止したことを確認してください。
>
CVMに[CBSをマウント](https://intl.cloud.tencent.com/document/product/362/32401)しました。

## 操作手順
<span id="2TBWindows2012"></span>
### CBSの初期化（Windows）
>このドキュメントは Windows Server 2012 OS を例として、OS によってフォーマット操作が異なる場合があり、このドキュメントはあくまで参考です。

1. [Windows CVMにログインします](https://intl.cloud.tencent.com/document/product/213/5435)。
2. CVMのデスクトップで、<img src="https://main.qcloudimg.com/raw/0a02193a82217974f650bbcaf4e1ed2d.png"  style="margin:0;">をクリックして、【サーバーマネージャー】画面にアクセスします。
3. 左側のナビゲーションツリーで、【ファイルとストレージサービス】をクリックします。
4. 左側のナビゲーションツリーで、【ボリューム】>【ディスク】を選択します。

> 新規ディスクがオフライン状態である場合（上図に示すように）、まず [ステップ5](#online) を実行して、オンラインになった後 [ステップ6](#initialize) を実行して、初期化を行います。それ以外の場合は [ステップ6](#initialize) を直接実行して、初期化を行います。

<span id="online"></span>
5. 右側のペインに表示されたディスクリストで、1がある行を右クリックし、メニューリストで【オンライン】を選択し、オンライン処理を行います。オンラインになった後、1が【オフライン】状態から【オンライン】に変換されました。
 
<span id="initialize"></span>
6. 1の行を右クリックし、メニューリストで【初期化】を選択します。
7. インターフェースプロンプトに従って、【はい】をクリックします。
8. 初期化した後、1が【不明】パーティションから【GPT】に変更され、1がある行を右クリックし、メニューリストで【シンプルボリュームの新規作成】を選択します。
9.【ボリューム新規作成のガイド】ダイアログボックスで、インターフェースプロンプトに従って、【次へ】をクリックしてください。
10. サーバーとディスクを選択し、【次へ】をクリックします。
11. 実際の状況に応じてボリュームサイズを指定し、デフォルトは最大値であり、【次へ】をクリックします。
12. ドライバー番号をアサインし、【次へ】をクリックします。
13. 【下記の設定手順に従ってこのボリュームをフォーマットする】を選択し、実際の状況に応じて、パラメータを設定し、新しいパーティションをフォーマットして、【次へ】をクリックして、パーティションの作成を完成させます。
14. 情報が正しいかを確認した後、【作成】をクリックします。
15. システムが新規ボリュームを作成するまでしばらく待ってから【閉じる】をクリックします。
 初期化が成功した後、【このコンピューター】インターフェースに入って新しいディスクを確認できます。

<span id="2TBLinux"></span>
### CBSの初期化（Linux）

実際のユースケースに応じて、初期化方法を選択してください：
- ハードディスク全体が一つ独立したパーティションを表示している場合（つまり、vdb1やvdb2などの複数の論理ディスクがない場合）、パーティションを使用しないで直接[ベアデバイスにファイルシステムを構築](#CreateFileSystemOnBareDevice)することをお勧めします。
- ディスク全体が複数の論理パーティションを表示している場合、（つまり、複数の論理ディスクが存在する場合）、まずパーティション操作を実行し、次に[パーティションにファイルシステムの構築](#CreateFileSystemOnPartition)処理を行います。

<span id="CreateFileSystemOnBareDevice"></span>
#### ベアデバイスにファイルシステムを構築する

1. [ Linux CVMにログインします](https://intl.cloud.tencent.com/document/product/213/5436)。
2. rootユーザーとして以下のコマンドを実行して、ディスクの名称を確認します。
 ```
fdisk -l
```
 返却情報が下図に示すように、該当CVMでは2つのディスクがあり、「/dev/vda」はシステムディスクであり、「/dev/vdb」は新規データディスクです。
 ![](https://main.qcloudimg.com/raw/aad842b12fec3ca583790bff609c9fb7.png)
3. 以下のコマンドを実行して、「/dev/vdb」というベアデバイスにファイルシステムフォーマットを直接作成します。
```
mkfs -t <ファイルシステムフォーマット> /dev/vdb
```
異なるファイルシステムは異なるサイズのパーティションをサポートしているため、実際の要求に応じて、ファイルシステムを合理的に選択します。ファイルシステム`EXT4` を例として、次を実行する：
```
mkfs -t ext4 /dev/vdb
```
> フォーマットを実行している時、しばらく待つ必要があります。システムの実行状態を確認し、終了しないでください。
4. 以下のコマンドを実行し、新しいマウントポイントを作成します。
```
mkdir <マウントポイント>
```
新しいマウントポイント `/data` の作成を例として、次を実行する：
```
mkdir /data
```
 5. 以下のコマンドを実行して、新規パーティションを新しく作成したマウントポイントにマウントします。 
```
mount /dev/vdb <マウントポイント>
```
新しいマウントポイント `/data` の作成を例として、次を実行する：
```
mount /dev/vdb /data
```
6. 以下のコマンドを実行し、マウント結果を確認します。
```
df -TH
```
> スタートアップする時、ディスクが自動的にマウントされるように設定する必要がない場合は、次の手順をスキップしてください。
7. マウントの方法を確認し、関連する情報を取得します。
業務の要求に応じて、Elastic CBS のソフトリンク、ファイルシステム UUID（universally unique identifier）あるいはデバイスの名称を使用して、ディスクを自動的にマウントし、関連する説明と情報の取得方法は以下の通り：
<table>
 <tr>
     <th>マウンの方法</th>
		 <th>メリットとデメリット</th>
		 <th>情報の取得方法</th>
 </tr>
 <tr>
     <td nowrap="nowrap">Elastic CBSのソフトリンクを使用する<b>（おすすめ）</b></td>
		 <td><b>メリット</b>：各Elastic CBS のソフトリンクは固定されて唯一であり、マウント、アンマウントやパーティションのフォーマットなどの操作によって変更されません。</br><b>デメリット</b>：Elastic CBS のみソフトリンクがあります。パーティションのフォーマット操作を感知できません。</td>
		 <td nowrap="nowrap">以下のコマンドを実行して、Elastic CBS のソフトリンクを確認します。</br><pre>ls -l /dev/disk/by-id</pre></td>
 </tr>
 <tr>
     <td nowrap="nowrap">ファイルシステムのUUIDを使用する</td>
		 <td>ファイルシステムUUIDの変更により、自動マウントの設定が無効になっている可能性があります。</br>例えば、ファイルシステムを再フォーマットすると、ファイルシステムのUUID が変更されます。</td>
		 <td nowrap="nowrap">以下のコマンドを実行して、ファイルシステム UUIDを確認します。</br><pre>blkid /dev/vdb</pre></td>
 </tr>
 <tr>
     <td nowrap="nowrap">デバイスの名称を使用する</td>
		 <td>デバイス名称の変更により、自動マウント設定が無効になっている可能性があります。</br>例えば、データマイグレーションを実行する場合、CVMのElastic CBSをアンマウントして再度マウントすると、OSはファイルシステムを再度認識する時に名称が変更される可能性があります。</td>
		 <td nowrap="nowrap">以下のコマンドを実行して、デバイスの名称を確認します。</br><pre>fdisk -l</pre></td>
	</tr>
</table>
8. 以下のコマンドを実行して、 `/etc/fstab` ファイルをバックアップします。 /home ディレクトリの配下にバックアップすることを例として、次を実行する：
```
cp -r /etc/fstab /home
```
9. 以下のコマンドを実行して、VIエディタを利用して`/etc/fstab` ファイルを開きます。
```
vi /etc/fstab
```
10. **i** を押して、編集モードに入ります。
11. カーソルをファイルの最後に移動し、**Enter**を押して、以下の内容を追加します。
```
<デバイス情報> <マウントポイント> <ファイルシステムのフォーマット> <ファイルシステムのインストールオプション> <ファイルシステムのダンプ頻度> <起動する時のファイルシステムのチェック手順>
```
 - **（おすすめ）**Elastic CBS のソフトリンクを使用して、自動的にマウントすることを例として、前文の例に合わせて、以下の内容を追加します：
```
/dev/disk/by-id/virtio-disk-drkhklpe /data ext4 defaults 0 0
```
 - ディスクパーティションの UUID を使用する自動マウントを例として、前文の例に合わせて、以下の内容を追加します：
```
UUID=d489ca1c-5057-4536-81cb-ceb2847f9954 /data  ext4 defaults     0   0
```
 - デバイスの名称を使用する自動マウントを例として、前文の例に合わせて、以下の内容を追加します：
```
/dev/vdb /data   ext4 defaults     0   0
```
12. **Esc**を押し、**:wq**を入力し、**Enter**を押してください。
設定を保存して、エディターを終了します。 
13. 以下のコマンドを実行して、**/etc/fstab** ファイルへの書き込みは成功したかどうかを確認します。
```
mount -a 
```
操作が成功すると、ファイルは正常に書き込まれ、新規作成したファイルシステムは OS が起動する時に自動的にマウントします。

<span id="CreateFileSystemOnPartition"></span>
#### パーティションにファイルシステムを構築する

> この操作は CentOS 7.5 OSでpartedパーティションツールを使用して、データディスク `/dev/vdc`をプライマリパーティションに設定し、パーティションの形式はデフォルトでGPTに設定され、ファイルシステムのフォーマットはEXT4に設定し、`/data/newpart2`の配下にマウントして、スタートアップする時に自動マウントを設定することを例として説明します。各OSのフォーマット操作が異なるため、このドキュメントはあくまで参考です。

1. [ Linux CVMにログインする](https://intl.cloud.tencent.com/document/product/213/5436)
2. rootユーザーとして以下のコマンドを実行して、ディスクの名称を確認します。
 ```
lsblk
```
返却情報が下図に示すように、該当CVMでは2つのディスクがあり、「/dev/vda」はシステムディスクであり 、「/dev/vdb」は新規データディスクです。
	![](https://main.qcloudimg.com/raw/72a7a48c59c13a44958a6b1aa0407ac2.png)
 3. 以下のコマンドを実行して、 parted パーティションツールにアクセスし、新規データディスクにパーティション操作を実行します。 
```
parted <新規データディスク>
```
新しくマウントされたデータディスク`/dev/vdc`を例として、次を実行する：
```
parted /dev/vdc
```
返却情報は下図に示すように：
![](https://main.qcloudimg.com/raw/0b2c9164f9fec125a72dee8861b7327d.png)
4. `p`を入力し、**Enter**を押し、現在のディスクのパーティション形式を確認します。
 返却情報は下図に示すように：
 ![](https://main.qcloudimg.com/raw/af906521dd6a7f3b948cfad42745aaba.png)
 【Partition Table: unknown】はディスクのパーティション形式が不明であることを示します。
5. 以下のコマンドを実行して、ディスクのパーティション形式を設定します。
```
mklabel <ディスクのパーティション方法>
```
ディスクの容量は2TBを超える時、GPTパーティション方式しか使用できません：
```
mklabel gpt
```
6. `p`を入力し、**Enter**を押し、ディスクのパーティション形式の設定が成功したかどうかを確認します。
 返却情報は下図に示すように：
	![](https://main.qcloudimg.com/raw/3dfec9aba75cd3cb6dcfb06729f5ff26.png)
 【Partition Table: gpt】はディスクのパーティション形式がGPTであることを示します。
7. `unit s`を入力し、Enterを押し、ディスクの測定単位をセクターに設定します。
8. ディスク全体を一つのパーティションに作成することを例として、`mkpart opt 2048s 100%`を入力し、Enterを押します。
 2048sはディスクの開始容量であり、100％はディスクの終了容量です。ここはあくまで参考であり、業務の要求に応じて、ディスクパーティションの数および容量を計画してください。
9. `p`を入力し、**Enter**を押し、新規パーティションの詳細情報を確認します。
  返却情報は下図に示すように：
 ![](https://main.qcloudimg.com/raw/ee406e75c689f48d59e863adc768aa36.png)
 新規パーティション`/dev/vdc1`の詳細情報を表します。
10. `q`を入力し、Enterを押し、parted パーティションツールを終了します
11. 以下のコマンドを実行して、ディスクの名称を確認します。
 ```
lsblk
```
返却情報は下図に示すように、新規パーティション「/dev/vdc1」を確認できます。
![](https://main.qcloudimg.com/raw/f95f599f11f88b8bcb89d4f02bb41292.png)
12. 以下のコマンドを実行して、新規パーティションのファイルシステムをシステムに必要なフォーマットに設定します。
```
mkfs -t <ファイルシステムフォーマット> /dev/vdc1
```
各ファイルシステムがサポートしているパーティションのサイズも異なり、実際の要件に応じて、ファイルシステムを合理的に選択してください。ファイルシステムをEXT4に設定することを例として、次を実行する：
```
mkfs -t ext4 /dev/vdc1
```
 返却情報は下図に示すように：
 ![](https://main.qcloudimg.com/raw/3cd6bbd019dd9bdc85ad4ed11ba64f0b.png)
 フォーマットを実行している時、しばらく待つ必要があります。システムの実行状態を確認して、終了しないでください。
 13. 以下のコマンドを実行して、新しいマウントポイントを作成します。 
```
mkdir <マウントポイント>
```
新規マウントポイント`/data/newpart2`を例として、次を実行する：
```
mkdir /data/newpart2
```
14. 以下のコマンドを実行して、新規パーティションを新規マウントポイントにマウントします。 
```
mount /dev/vdc1 <マウントポイント>
```
新規マウントポイント`/data/newpart2`を例として、次を実行する：
```
mount /dev/vdc1 /data/newpart2
```
15. 以下のコマンドを実行して、マウント結果を確認します。
```
df -TH
```
 返却情報は下図に示すように：
 ![](https://main.qcloudimg.com/raw/774c2d9ff266634c4836df6456b9dd4d.png)
 新規パーティション`/dev/vdc1`は`/data/newpart2`にマウントされていることを示します。
 
> スタートアップする時にディスクの自動マウントを設定する必要がない場合、次の手順をスキップしてください。
>
16. マウントの方法を確認し、関連する情報を取得します。
 業務の要求に応じて、Elastic CBS のソフトリンク、ファイルシステム UUID（universally unique identifier）あるいはデバイスの名称を使用して、ディスクを自動的にマウントし、関連する説明と情報の取得方法は以下の通り：
 <table>
     <tr>
         <th>マウント方法</th>  
         <th>メリットとデメリット</th>  
         <th>情報の取得方法</th>  
     </tr>
	   <tr>      
         <td nowrap="nowrap">Elastic CBSのソフトリンクを使用する<b>（おすすめ）</b></td>   
	       <td><b>メリット</b>：各Elastic CBS のソフトリンクは固定されて唯一であり、マウント、アンマウントやパーティションのフォーマットなどの操作に従って変更されません。<br><b>デメリット</b>：Elastic CBS のみソフトリンクがあります。パーティションのフォーマットを感知できません。</td>
	       <td nowrap="nowrap">以下のコマンドを実行して、Elastic CBSのソフトリンクを確認します。</br><pre>ls -l /dev/disk/by-id</pre></td>
     </tr> 
	   <tr>      
         <td nowrap="nowrap">ファイルシステムのUUIDを使用する</td>   
	       <td>ファイルシステム UUID の変更により、自動マウントの設定が無効になっている可能性があります。</br>例えば、ファイルシステムを再フォーマットすると、ファイルシステムのUUID が変更されます。</td>
	       <td nowrap="nowrap">以下のコマンドを実行して、ファイルシステムの UUIDを確認します。</br><pre> blkid /dev/vdc1</pre></td>
     </tr> 
	   <tr>      
         <td nowrap="nowrap">デバイスの名称を使用する</td>   
	       <td>デバイス名称の変更により、自動マウント設定が無効になっている可能性があります。</br>例えば、データマイグレーションを実行する場合、CVMのElastic CBSをアンマウントして再度マウントすると、OS はファイルシステムを再度認識する時に名称が変更される可能性があります。</td>
	       <td>以下のコマンドを実行して、デバイスの名称を確認します。</br><pre>fdisk -l</pre></td>
     </tr> 
</table>
17. 以下のコマンドを実行して、`/etc/fstab ファイル`をバックアップします。/home ディレクトリの配下にバックアップすることを例として、次を実行する：
```
cp -r /etc/fstab /home
```
18. 以下のコマンドを実行して、VIエディターを利用して`/etc/fstab`ファイルを開きます。
 ```
vi /etc/fstab
```
19. **i**を押し、編集モードに入ります。  
20. カーソルをファイルの最後に移動し、**Enter**を押し、以下の内容を追加します。
 ```
<デバイス情報> <マウントポイント> <ファイルシステムのフォーマット> <ファイルシステムのインストールオプション> <ファイルシステムのダンプ頻度> <起動する時のファイルシステムのチェック手順>
```
 - **（おすすめ）**Elastic CBS のソフトリンクを使用して、自動的にマウントすることを例として、前文の例に合わせて、以下の内容を追加します：
 ```
/dev/disk/by-id/virtio-disk-bm42ztpm-part1 /data/newpart2   ext4 defaults     0   2
```
 - ディスクパーティションのUUIDを使用する自動マウントを例として、前文の例に合わせて、以下の内容を追加します：
```
UUID=fc3f42cc-2093-49c7-b4fd-c616ba6165f4 /data/newpart2   ext4 defaults     0   2
```
 - デバイスの名称を使用する自動マウントを例として、前文の例に合わせて、以下の内容を追加します：
```
/dev/vdc1 /data/newpart2   ext4 defaults     0   2
```
20. **Esc**を押し、**:wq**を入力し、**Enter**を押ます。
 設定を保存して、エディタを終了します。
21. 以下のコマンドを実行して、`/etc/fstab`ファイルへの書き込みが成功したかどうかを確認します。
```
 mount -a 
```
操作が成功すると、ファイルは正常に書き込まれ、新規作成したファイルシステムはOSが起動する時に自動的にマウントします。

## 関連操作
[CBSの初期化（2TB未満）](https://intl.cloud.tencent.com/document/product/362/31597)
