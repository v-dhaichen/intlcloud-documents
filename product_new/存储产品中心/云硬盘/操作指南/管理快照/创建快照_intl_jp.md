## ユースケース
CBSのスナップショットを作成することにより、指定した時刻のCBSデータを保存できます。Tencent Cloudは増分方式を使用してスナップショットを作成します。つまり、前回作成したスナップショットと比較して新しく変更されたデータのみを作成される為、データがほとんど変更されていない場合にスナップショットを短時間に作成できます。スナップショットは増分方式で作成されますが、スナップショットを削除してもスナップショットのデータに影響することがなく、削除されていないスナップショットはCBSをそのスナップショット状態に復元できます。
CBSは任意の状態でスナップショットを作成できますが、スナップショットは作成時点に既に書き込まれたデータのみ保存できます。アプリケーションまたはプロセスがデータを書き込んでいる場合、書き込み中のデータがその時点で作成されたスナップショットに保存されない可能性があります。実際の業務状況に応じて、全ての書き込みを一時的に停止してスナップショットを作成するか、CVMからCBSを [アンマウント](https://intl.cloud.tencent.com/document/product/362/32400) して、スナップショットを作成して再[マウント](https://intl.cloud.tencent.com/zh/document/product/362/32401) することにより、データの整合性を保つスナップショットを取得します。

## 前提条件
- [CBSの作成](https://intl.cloud.tencent.com/document/product/362/5744) が成功しました。
- 現在のリージョンのスナップショットの数と容量の合計は最大値以下であり、詳細については、 [スナップショットクォータの制限](https://intl.cloud.tencent.com/document/product/362/5754#Constraint) をご参照ください。

## 注意事項
スナップショットは、その時点でハードディスクに書き込まれたデータのみを保持し、その時点でメモリ内のハードディスクに書き込まれていないデータは保持しません。スナップショットを作成する前に、シャットダウンすること、メモリデータがハードディスクに書き込まれこと及びハードディスクの読み書きを一時停止することお勧めします。次の2つの側面から操作します：
### データベースレベル
データベース業務の場合、データベース内の全てのテーブルを読み取り専用状態にロックして、スナップショットの作成時に新しいデータが書き込まれることによって新しいデータがスナップショットにキャプチャされないことを防げます。このドキュメントではmysqlを例として、次のことを行います：
1. `FLUSH TABLES WITH READ LOCK` コマンドを実行して、開いている全てのテーブルを閉じ、グローバル読み取りロックを利用して全てのデータベースのテーブルをロックします。以下に示すように：
![](https://main.qcloudimg.com/raw/287ad27cec557a52a3386a60b937dc9b.png)
2. CBSのスナップショットを作成します。
3. `UNLOCK TABLES` を実行してロックを解除します。以下に示すように：
![](https://main.qcloudimg.com/raw/8a5fdcb0df254f0f9afcf3ef86679fc0.png)

### システムレベル
システムの観点から見ると、処理中のデータは通常メモリバッファーに保存されて、適切な時にCBSに書き込むことにより、システムの効率を向上させます。したがって、スナップショットを作成する際に、バッファー内のまだCBSに書き込まれていないデータは、スナップショットに書き込むこととスナップショットから復元することができないため、データの整合性に影響します。
`sync` コマンドを実行して、ファイルシステムのメモリバッファー内のデータをCBSに直ちに強制的に書き込み、さらにスナップショットを作成する前に新しいデータを書き込まれないようにします。コマンドを実行した後にエラーメッセージは返されなかったら、バッファー内のデータが既にCBSに書き込まれたことになります。以下に示すように：
![](https://main.qcloudimg.com/raw/e1b0ac245e325281a0693f7ae43946ff.png)



## 操作手順
### コンソールを利用してスナップショットを作成する
1. [CBS コンソール](https://console.cloud.tencent.com/cvm/cbs) にログインします。
2. ターゲットCBSの行で【スナップショットの作成】をクリックします。
3.【スナップショットの作成】ダイアログボックスで、スナップショット名を入力して、【OK】をクリックします。

### API を利用してスナップショットを作成する
CreateSnapshot インターフェースを利用してスナップショットを作成します。詳細については、 [スナップショットの作成](https://intl.cloud.tencent.com/document/product/362/15648) をご参照ください。
