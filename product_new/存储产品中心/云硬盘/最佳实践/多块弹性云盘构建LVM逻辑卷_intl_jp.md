## LVM 概要
論理ボリュームマネージャー（Logical Volume Manager、LVM）は、ハードディスクとパーティションの上にロジック層を作成することにより、ディスクまたはパーティションを同じサイズの PE（Physical Extents）ユニットに分割します。異なるディスクまたはパーティションを同じボリュームグループ（VG、Volume Group）に割り当てることができます。VGの上に論理ボリューム（LV）を作成して、LVの上にファイルシステムを作成できます。
ディスクパーティションを直接利用する場合と比べて、LVMの長所は柔軟にファイルシステムの容量を調整できます。
- ファイルシステムは物理ディスクのサイズに制限されなく、複数のディスクに分散できます。
例えば、三つの4TBのElastic CBSを購入し、LVMを利用して12TB程度の大規模なファイルシステムを作成できます。
- 論理ボリュームのサイズを動的に調整できるため、ディスクのパーティションを再変更する必要がありません。
LVM ボリュームグループのキャパシティーがニーズを満たせない場合、Elastic CBSを個別に購入して、対象のCVMにマウントし、LVM ボリュームグループに追加してスケールアウトします。

## LVMの構築
>?以下は三つのElastic CBSを利用して、LVMによりサイズが動的に調整可能なファイルシステムを作成することを例として説明します。下図に示すように：
![](https://main.qcloudimg.com/raw/81086e80477ff7e374e7c3f0fe9d2788.png)

### ステップ 1  物理ボリューム（PV）を作成する
1. rootユーザーで [Linux CVMにログインする](https://intl.cloud.tencent.com/document/product/213/5436)。
2. 以下のコマンドを実行して、物理ボリューム（Physical Volume、 PV）を作成します。
```
pvcreate <ディスクパス1> ... <ディスクパスN>
```
以下は`/dev/vdc`、`/dev/vdd` と `/dev/vde`を例に説明します。以下のコマンドを実行する： 
```
pvcreate /dev/vdc /dev/vdd /dev/vde
```
作成が成功すると、下図に示すように：
![](https://main.qcloudimg.com/raw/5b92a6c7878e22906599af48bfa09d95.png)
3. 以下のコマンドを実行して、現在のシステムの物理ボリュームを確認します。
```
lvmdiskscan | grep LVM
```
![](https://main.qcloudimg.com/raw/1de75af4a49c2deea689a2576eb075d9.png)

### ステップ 2 ボリュームグループ(VG)を作成する
1. 以下のコマンドを実行して、VGを作成します。
```
vgcreate [-s <PEサイズを指定する>] <ボリュームグループ名> <物理ボリュームのパス>
```
以下は「lvm_demo0」という名前のボリュームグループの作成を例に説明します。以下のコマンドを実行する：
```
vgcreate lvm_demo0 /dev/vdc /dev/vdd
```
作成が成功すると、下図に示すように：
![](https://main.qcloudimg.com/raw/3b8dba3329f62e85d2075fad10898632.png)
 「Volume group 」<ボリュームグループ名> 「successfully created」が表示されると、ボリュームグループの作成が成功したと示します。
 - ボリュームグループの作成が完了した後、以下のコマンドを実行して、ボリュームグループに新しい物理ボリュームを追加できます。
```
vgextend ボリュームグループ名 新しい物理ボリュームのパス
```
追加が成功すると、下図に示すように：
![](https://main.qcloudimg.com/raw/105e5a77472f173ffd4a58624f20a863.png)
 - ボリュームグループの作成が完了した後、`vgs`、`vgdisplay`等のコマンドを実行して、現在のシステムのボリュームグループの情報を確認できます。下図に示すように：
![](https://main.qcloudimg.com/raw/309c991d32cf4b801ddbe8d898f1bfbb.png)

### ステップ 3 論理ボリューム(LV)を作成する
1. 以下のコマンドを実行して、LVを作成します。
```
lvcreate [-L <論理ボリュームのサイズ>][ -n <論理ボリュームの名前>] <VGの名前>
```
以下は「lv_0」という名前の8GBの論理ボリュームの作成を例に説明します。以下のコマンドを実行する：
```
lvcreate -L 8G -n lv_0 lvm_demo0
```
作成が成功すると、下図に示すように：
![](https://main.qcloudimg.com/raw/ed6d2f827ae7c4a4630bf17e24d90df2.png)
>? `pvs` コマンドを実行して、`/dev/vdc` のみ8GBが使用されていることを確認できます。下図に示すように：
>![](https://main.qcloudimg.com/raw/2718d08f7c74b7b469a23473a1398dfe.png)

### ステップ 4 ファイルシステムを作成とマウントする
1. 以下のコマンドを実行して、作成した論理ボリュームにファイルシステムを作成します。
```
mkfs.ext3 /dev/lvm_demo0/lv_0
```
2. 以下のコマンドを実行して、ファイルシステムをマウントします。
```
mount /dev/lvm_demo0/lv_0 vg0/
```
マウントが成功すると、下図に示すように：
![](https://main.qcloudimg.com/raw/2a7701636c2604d67e0743de4f9a6af1.png)

### ステップ 5 論理ボリュームとファイルシステムのサイズを動的に拡張する
>!VG容量が残っている場合のみ、LV容量を動的に拡張できます。LV容量を拡張した後、当該LVに作成されたファイルシステムのサイズを同時に拡張する必要があります。

1. 以下のコマンドを実行して、論理ボリュームのサイズを拡張します。
```
lvextend [-L +/- <容量の増減>] <論理ボリュームのパス>
```
以下は「lv_0」というの論理ボリュームへの4GB容量の拡張を例に説明します。以下のコマンドを実行する：
```
lvextend -L +4G /dev/lvm_demo0/lv_0
```
拡張が成功すると、下図に示すように：
![](https://main.qcloudimg.com/raw/eccd7d6aec587eb90ec655a384367595.png)
>? `pvs` コマンドを実行して、`/dev/vdc` が完全に利用され、`/dev/vdd` が2GB利用されていることを確認できます。下図に示すように：
>![](https://main.qcloudimg.com/raw/189155ca377ef9550c4587ca78ab5b27.png)
2. 以下のコマンドを実行して、ファイルシステムを拡張します。
```
resize2fs /dev/lvm_demo0/lv_0
```
拡張が成功すると、下図に示すように：
![](https://main.qcloudimg.com/raw/2e37f35678014ab1ca398fe5470a754b.png)
拡張が成功した後、以下のコマンドを実行して、論理ボリュームの容量が12GBになっているかを確認できます。
```
df -h
```
