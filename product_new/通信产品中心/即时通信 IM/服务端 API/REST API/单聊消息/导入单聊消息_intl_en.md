## Feature Description
- This API is used to import historical one-to-one chat messages into IM.
- During smooth transition, real-time one-to-one chat messages from the original IM service will be imported into IM.
- This API does not trigger callbacks.
- This API **does not deduplicate imported messages**.

## API Invocation Description
### Request URL example
```
https://console.tim.qq.com/v4/openim/importmsg?sdkappid=88888888&identifier=admin&usersig=xxx&random=99999999&contenttype=json
```

### Request parameters
The following table lists and describes only the parameters to be modified when this API is invoked. For details on other parameters, see [RESTful API Overview](https://intl.cloud.tencent.com/document/product/1047/34620).

| Parameter | Description |
| ------------------ | ------------------------------------ |
| v4/openim/importmsg | The request API. |
| sdkappid | The SDKAppID assigned by the IM console when an app is created. |
| identifier | This must be the app admin account. For details, see [App Admins](https://intl.cloud.tencent.com/document/product/1047/33517#app-.E7.AE.A1.E7.90.86.E5.91.98). |
| usersig | The signature generated by the app admin account. For details, see [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385). |
| random | Enter a random 32-bit unsigned integer ranging from 0 to 4294967295. |


### Maximum invocation frequency

The maximum invocation frequency is 200 times per second.

### Request packet examples

- **Importing real-time messages during smooth transition**
```
{
    "SyncFromOldSystem": 1, // Imports real-time messages during smooth transition and counts these messages as unread messages.
    "From_Account": "lumotuwe1", // Message sender account
    "To_Account": "lumotuwe2", // Recipient account
    "MsgRandom": 1287657, // Message random number
    "MsgTimeStamp": 1556178721, // Message timestamp in UNIX format, in seconds
    "MsgBody": [ // Message content, in which case the message is a text message
        {
            "MsgType": "TIMTextElem", // Text message element
            "MsgContent": {
                "Text": "hi, beauty"
            }
        }
    ]
}
```
- **Importing historical messages**
```
 {
    "SyncFromOldSystem": 2, // Imports historical messages and does not count these messages as unread messages.
    "From_Account": "lumotuwe1", // Message sender account
    "To_Account": "lumotuwe2", // Recipient account
    "MsgRandom": 1287657, // Message random number
    "MsgTimeStamp": 1556178721, // Message timestamp in  UNIX format, in seconds
    "MsgBody": [ // Message content, in which case this message is a text message
        {
            "MsgType": "TIMTextElem", // Text message element
            "MsgContent": {
                "Text": "hi, beauty" // Message content
            }
        }
    ]
}
```


### Request packet fields

| Field | Type | Attribute | Description |
|---------|---------|----|---------|
| SyncFromOldSystem | Integer | Required | This field can only be set to 1 or 2. Other values are invalid. <br/>1: real-time messages are imported and counted as unread messages. <br/>2: historical messages are imported and not counted as unread messages. |
| From_Account | String | Required | The UserID  of the message sender, which is used to specify the sender. |
| To_Account | String | Required | The UserID  of the message recipient. |
| MsgRandom | Integer | Required | The message random number, which is generated by the random function and used only to locate issues at the backend. The backend will not deduplicate based on this field. |
| MsgTimeStamp | Integer | Required | The message timestamp in UNIX format, in seconds. The backend will not deduplicate based on this field. |
| MsgBody | Object | Required | Message content. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527) (Note: one message can contain multiple message elements, with MsgBody set to Array.) |
| MsgType | String | Required | The TIM message object type. Supported message objects are TIMTextElem (text messages), TIMFaceElem (emoji messages), TIMLocationElem (location messages), and TIMCustomElem (custom messages). |
| MsgContent | Object | Required | Different MsgContent formats are used for different values of MsgType. For details, see [Message Format Description](https://intl.cloud.tencent.com/document/product/1047/33527). |



### Response packet example

```
{
   "ActionStatus" : "OK",
   "ErrorInfo" : "",
   "ErrorCode" : 0
}

```
### Response packet fields

| Field | Type| Description |
|---------|---------|---------|
| ActionStatus | String | The request processing result. OK: succeeded. FAIL: failed. |
| ErrorCode | Integer | The error code. 0: succeeded. Others: failed. |
| ErrorInfo | String | Error information. |

## Error Codes

Unless a network error (such as error 502) occurs, the HTTP return code for this API is always 200. ErrorCode and ErrorInfo in the response packet represent the actual error code and error information, respectively.
For common error codes (60000 to 79999), see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).

The following table describes the error codes specific to this API.

| Error Code | Description |
| ------------- | ------------------------------------------------------------ |
| 90001 | Failed to parse the JSON request packet. In this case, check whether the request packet meets JSON specifications. |
| 90002 | The MsgBody format in the JSON request packet does not meet message format requirements, or MsgBody is not set to Array. For details, see the definition of the [TIMMsgElement Object](https://intl.cloud.tencent.com/document/product/1047/33527#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement). |
| 90003 | The JSON request packet does not contain the To_Account field or the To_Account field is not of the String type. |
| 90005 | The JSON request packet does not contain the MsgRandom field or the MsgRandom field is not of the Integer type. |
| 90006 | The JSON request packet does not contain the MsgTimeStamp field or the MsgTimeStamp field is not of the Integer type. |
| 90007 | The MsgBody type in the JSON request packet is not set to Array. In this case, change the type to Array. |
| 90008 | The JSON request packet does not contain the From_Account field or the From_Account field is not of the Integer type. |
| 90009 | The request requires app admin permissions. |
| 90010 | The JSON request packet does not meet message format requirements. For details, see the definition of the [TIMMsgElement Object](https://intl.cloud.tencent.com/document/product/1047/33527#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement). |
| 90011 | The number of target accounts for sending messages exceeds 500. In this case, reduce the number of target accounts in To_Account. |
| 90012 | To_Account is not registered or does not exist. In this case, check whether To_Account has been imported into IM or is misspelled. |
| 90026 | The retention period of offline messages is invalid. The period cannot exceed 7 days. |
| 90030 | The JSON request packet does not contain the SyncFromOldSystem field or the SyncFromOldSystem field is not of the Integer type. |
| 90048 | The requested user account does not exist. |
| 90992 | An internal server error occurred. In this case, try again. If this error code is returned for all requests and the app has configured third-party callback, check whether the app server sends the callback result to the IM backend server normally. |
| 91000 | An internal server error occurred. In this case, try again. |
| 93000 | The JSON data packet exceeds the length limit of 8 KB. |

## API Commissioning Tool
Use the [online commissioning tool for RESTful APIs](https://avc.cloud.tencent.com/im/APITester/APITester.html#v4/openim/importmsg) to commission this API.

## References
Importing group messages ([v4/group_open_http_svc/import_group_msg](https://intl.cloud.tencent.com/document/product/1047/34968))
