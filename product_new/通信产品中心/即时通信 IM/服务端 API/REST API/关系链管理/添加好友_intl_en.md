## Feature Description
This API is used to add a friend. You can add friends in batches.

## API Invocation Description
### Request URL example
```
https://console.tim.qq.com/v4/sns/friend_add?sdkappid=88888888&identifier=admin&usersig=xxx&random=99999999&contenttype=json
```
### Request parameters
The following table lists and describes only the parameters to be modified when this API is invoked. For details on other parameters, see [RESTful API Overview](https://intl.cloud.tencent.com/document/product/1047/34620).

| Parameter | Description |
| ------------------ | ------------------------------------ |
| v4/sns/friend_add | The request API. |
| sdkappid | The SDKAppID assigned by the IM console when an app is created. |
| identifier | This must be the app admin account. For details, see [App Admins](https://intl.cloud.tencent.com/document/product/1047/33517#app-.E7.AE.A1.E7.90.86.E5.91.98). |
| usersig | The signature generated by the app admin account. For details, see [Generating UserSig](https://intl.cloud.tencent.com/document/product/1047/34385). |
| random | Enter a random 32-bit unsigned integer ranging from 0 to 4294967295. |


### Maximum invocation frequency

The maximum invocation frequency is 200 times per second.

### Request packet examples
- **Basic form**
```
{
    "From_Account":"id",
    "AddFriendItem":
    [
        {
            "To_Account":"id1",
            "AddSource":"AddSource_Type_XXXXXXXX"
        }
    ]
}
```

- **Complete form**
```
{
    "From_Account":"id",
    "AddFriendItem":
    [
        {
            "To_Account":"id1",
            "Remark":"remark1",
            "GroupName": "Classmates",
            "AddSource":"AddSource_Type_XXXXXXXX",
            "AddWording":"I'm Test1"
        }
    ],
    "AddType":"Add_Type_Both",
    "ForceAddFlags":1
}
```
- **Batch form**
```
{
    "From_Account":"id",
    "AddFriendItem":
    [
        {
            "To_Account":"id1",
            "AddSource":"AddSource_Type_XXXXXXXX"
        },
        {
            "To_Account":"id2",
            "Remark":"remark2",
            "GroupName": "Classmates",
            "AddSource":"AddSource_Type_XXXXXXXX",
            "AddWording":"I'm Test2"
        },
        {
            "To_Account":"id3",
            "Remark":"remark3",
            "GroupName": "Colleagues",
            "AddSource":"AddSource_Type_XXXXXXXX",
            "AddWording":"I'm Test3"
        }
    ],
    "AddType":"Add_Type_Both",
    "ForceAddFlags":1
}
```

### Request packet fields

| Field | Type | Attribute | Description |
|--- |--- |--- |--- |
| From_Account | String | Required | The identifier for which a fiend needs to be added. |
| AddFriendItem | Array | Required | The structural object of the friend. |
| To_Account | String | Required | The identifier of the friend. |
| Remark | String | Optional | The remarks on To_Account made by From_Account. For details, see [Standard Friend Fields](https://intl.cloud.tencent.com/document/product/1047/33521#.E6.A0.87.E9.85.8D.E5.A5.BD.E5.8F.8B.E5.AD.97.E6.AE.B5). |
| GroupName | String | Optional | The group to which From_Account adds To_Account. For details, see [Standard Friend Fields](https://intl.cloud.tencent.com/document/product/1047/33521#.E6.A0.87.E9.85.8D.E5.A5.BD.E5.8F.8B.E5.AD.97.E6.AE.B5). |
| AddSource | String | Required | The source from which the friend is added. For details, see [Standard Friend Fields](https://intl.cloud.tencent.com/document/product/1047/33521#.E6.A0.87.E9.85.8D.E5.A5.BD.E5.8F.8B.E5.AD.97.E6.AE.B5). |
| AddWording | String | Optional | The request message when a friend relationship is created between From_Account and To_Account. For details, see [Standard Friend Fields](https://intl.cloud.tencent.com/document/product/1047/33521#.E6.A0.87.E9.85.8D.E5.A5.BD.E5.8F.8B.E5.AD.97.E6.AE.B5). |
| AddType | String | Optional | The method for adding a friend. The default value is Add_Type_Both. <br><li>"Add_Type_Single" indicates one-way friend addition. <br><li>"Add_Type_Both" indicates two-way friend addition. |
| ForceAddFlags | Integer | Optional | The flag for forcibly adding a friendly by the admin. 1: add the friend forcibly. 0: add the friend as normal. |


### Response packet examples
- **Basic form and complete form**
```
{
	"ResultItem":
	[
		{
			"To_Account":"id1",
			"ResultCode":0,
			"ResultInfo":""
		}
	],
	"ActionStatus":"OK",
	"ErrorCode":0,
	"ErrorInfo":"",
	"ErrorDisplay":""
}
```

- **Batch form**
```
{
	"ResultItem":
	[
		{
			"To_Account":"id1",
			"ResultCode":0,
			"ResultInfo":""
		},
		{
			"To_Account":"id2",
			"ResultCode":30006,
			"ResultInfo":"Err_SNS_FriendAdd_Unpack_Profile_Data_Fail"
		},
		{
			"To_Account":"id3",
			"ResultCode":30002,
			"ResultInfo":"Err_SNS_FriendAdd_SdkAppId_Illegal"
		}
	],
	"Fail_Account":["id2"],
	"Invalid_Account":["id3"],
	"ActionStatus":"OK",
	"ErrorCode":0,
	"ErrorInfo":"",
	"ErrorDisplay":""
}
```

### Response packet fields

| Field | Type | Description |
|--- |--- |--- |
| ResultItem | Array | The result object array for adding friends in batches. |
| To_Account | String | The identifier that requests adding a friend. |
| ResultCode | Integer | The processing result of To_Account. 0: succeeded. Others: failed. |
| ResultInfo | String | Error description for To_Account. If the processing was successful, the field is empty. |
| Fail_Account | Array | Returns a list of users for whom the processing failed. This field is returned only when the processing failed for a user. |
| Invalid_Account | Array | Returns a list of users with inconsistent SDKAppIDs. This field is returned only when invalid users exist. |
| ActionStatus | String | The request processing result. OK: succeeded. FAIL: failed. |
| ErrorCode | Integer | The error code. 0: succeeded. Others: failed. |
| ErrorInfo | String | Detailed error information. |
| ErrorDisplay | String | Detailed error information to be displayed on the client. |

## Error Codes

Unless a network error (such as error 502) occurs, the HTTP return code for this API is always 200. ErrorCode and ErrorInfo in the response packet represent the actual error code and error information, respectively.
For common error codes (60000 to 79999), see [Error Codes](https://intl.cloud.tencent.com/document/product/1047/34348).
The following table describes the error codes specific to this API.

| Error Code | Description |
| ------ | ------------------------------------------------------------ |
| 30001 | A request parameter is incorrect. In this case, check request parameters based on the error description. |
| 30002 | The SDKAppIDs are inconsistent. |
| 30003 | The requested user account does not exist. |
| 30004 | The request requires app admin permissions. |
| 30005 | A relationship chain field contains sensitive words. |
| 30006 | An internal server error occurred. In this case, try again. |
| 30007 | The network connection timed out. In this case, try again later. |
| 30008 | A write conflict occurred due to concurrent writes. In this case, we recommend that you use the batch mode. |
| 30009 | The backend prohibits this user from initiating a friend addition request. |
| 30010 | The number of current friends has reached the upper limit of the system. |
| 30011 | The number of groups has reached the upper limit of the system. |
| 30012 | The number of pending friend requests has reached the upper limit of the system. |
| 30014 | The number of the peer’s friends has reached the upper limit of the system. |
| 30515 | Unable to add the peer as this user is blacklisted. |
| 30516 | The peer’s friend request verification mode disallows anyone to add him/her as a friend. |
| 30515 | Unable to add the peer as your friend because you are blacklisted by this user. |
| 30539 | If A requests to add B as a friend, but B’s friend request verification mode is set to "AllowType_Type_NeedConfirm", then only a pending relationship can be established between A and B. This return code is used to indicate that a pending relationship was successfully created. In this way, you can differentiate this result from the successful addition of a friend, and the invoker can capture this error and provide the user with an appropriate prompt. |
| 30540 | The friend addition request was filtered by the security policy. In this case, do not initiate friend addition requests too frequently. |

## API Commissioning Tool
Use the [online commissioning tool for RESTful APIs](https://avc.cloud.tencent.com/im/APITester/APITester.html#v4/sns/friend_add) to commission this API.

## References

- Importing friends (<a href="https://intl.cloud.tencent.com/document/product/1047/34903">v4/sns/friend_import</a>)
- Updating friends (<a href="https://intl.cloud.tencent.com/document/product/1047/34904">v4/sns/friend_update</a>)
- Deleting a friend (<a href="https://intl.cloud.tencent.com/document/product/1047/34905">v4/sns/friend_delete</a>)
- Deleting all friends (<a href="https://intl.cloud.tencent.com/document/product/1047/34906">v4/sns/friend_delete_all</a>)
- Verifying friends (<a href="https://intl.cloud.tencent.com/document/product/1047/34907">v4/sns/friend_check</a>)
- Pulling friends (<a href="https://intl.cloud.tencent.com/document/product/1047/34908">v4/sns/friend_get</a>)
- Pulling a specified friend (<a href="https://intl.cloud.tencent.com/document/product/1047/34910">v4/sns/friend_get_list</a>)
