## ユースケース

セキュリティ識別子（SID）はMicrosoft OSにおいてコンピューターとユーザーを識別します。同一イメージに基づいて作り出されたCVMインスタンスの SID が同じであるため、ドメインに参加できない問題を引き起こす可能性があります。Windowsドメイン環境を構築したい場合、ドメインに参加できるためにSIDを修正する必要があります。
このドキュメントは、 Windows Server 2012 OSのCVMを例として、システムに付属しているsysprep及びsidchg ツールを使用して、SIDを修正する方法について説明します。

## 注意事項

- 本説明では Windows Server 2008 R2 、Windows Server 2012 及び Windows Server 2016にのみ適用しています。
- 一括でSIDを修正する必要がある場合、カスタマイズイメージ（「sysprepを実行してイメージを作成する」を選択する）を作成することにより修正できます。
-  SIDの修正によりデータの損失やシステムの破損などの問題が発生する可能性があるため、事前にシステムディスクのスナップショットまたはイメージを作成することを推奨します。

## 操作方法

### sysprep を使用してSIDを修正する

> 
> - sysprep を使用してSIDを修正した後、IP構成情報などを含む多くのシステムパラメーターがリセットされます。手動でリセットすること必要があります。
> - sysprep を使用してSIDを修正した後、C:\Users\Administrator がリセットされ、システムディスクデータの一部が消去されるため、データのバックアップに注意してください。
> 
1. [VNC を使用してCVMにログインする](https://intl.cloud.tencent.com/document/product/213/32496)。
2. OSインターフェースで、 <img src="https://main.qcloudimg.com/raw/87d894e564b7e837d9f478298cf2e292.png" style="margin: 0;"> >【実行】を右クリックし、 **cmd**を入力し、 **Enter**を押して、管理者コマンドラインツールを開きます。
3. <span id="step_03">管理者コマンドラインで、以下のコマンドを実行して、現在のネットワーク設定を保存します。</span>
```
ipconfig /all
```
4. 管理者コマンドラインで、以下のコマンドを実行して、 sysprepツールを開きます。
```
C:\Windows\System32\Sysprep\sysprep.exe
```
5. 開いた 「システム準備ツール 3.14」ウインドウで、以下の設定を行います。
 - 【システムのクリーンアップ操作】を【**システムの新たな体験に入る (OOBE)**】に設定し、【一般】もチェックします。
 - 【シャットダウンオプション】を【**再起動**】に設定します。
6.【OK】をクリックし、システムは自動的に再起動します。
7. 起動された後、ガイドに従って設定（例えば言語の選択、パスワードのリセットなど）を完成させます。
8. OSインターフェースで， <img src="https://main.qcloudimg.com/raw/87d894e564b7e837d9f478298cf2e292.png" style="margin: 0;"> >【実行】を右クリックし、 **cmd**を入力し、 **Enter**を押して、管理者コマンドラインツールを開きます。
9. 以下のコマンドを実行して、 SIDが変更されたことを確認します。
```
whoami /user
```
次のような情報が返されると、SIDがすでに変更されたことを示します。
10.  [ステップ3](#step_03)で保存されたネットワーク構成情報に従って、、ENIの関連情報（例えば、IPアドレス、ゲートウェイアドレス、DNS など）を再設定します。


### sidchgを使用してSIDを修正する

1. CVMにログインします。
2. IEブラウザでsidchgツールにアクセスしてダウンロードします。
sidchgツールのダウンロードアドレス：`http://www.stratesave.com/html/sidchg.html`です
3. 管理者コマンドラインツールを使用して、以下のコマンドを実行して、sidchgツールを開きます。下図に示すように：
例えば、sidchgツールは C: ディスクに保存され、名称は sidchg64-2.0p.exeとなります。
![](https://main.qcloudimg.com/raw/284926ae1eae88228fb009f247b82068.png)
その中で、`/R` は修正した後自動的に再起動することを示し、`/S` は修正した後閉じることを示し、使用の詳細情報は [SIDCHG の公式説明](http://www.stratesave.com/html/sidchg.html)をご参照ください。
4. インターフェースでの提示に従って、 license keyまたはtrial keyを入力し、 **Enter**を押します。
5. インターフェースの提示に従って、**Y**を入力し、**Enter**を押します。下図に示すように：
![](https://main.qcloudimg.com/raw/43c19634475517b183402d15fa32e962.png)
6. SIDを修正するためのプロンプトボックスで、【OK】をクリックし、 SIDのリセットを行います。下図に示すように：
リセットプロセス中に、システムが再起動されます。
7. 起動が完成した後、 <img src="https://main.qcloudimg.com/raw/87d894e564b7e837d9f478298cf2e292.png" style="margin: 0;"> >【実行】を右クリックし、 **cmd**を入力し、 **Enter**を押して、管理者コマンドラインツールを開きます。
8. 以下のコマンドを実行して、SIDが変更されたことを確認します。
```
whoami /user
```
次のような情報が返されると、SIDが変更されたことを示します。
