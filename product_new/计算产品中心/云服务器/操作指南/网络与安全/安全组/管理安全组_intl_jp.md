## 操作シナリオ

初めてCVMを設定する時にセキュリティグループを設定することができるし、コンソールのセキュリティグループページでセキュリティグループの新規作成、確認、更新や削除等の操作を行う同時に、セキュリティグループ及びセキュリティグループルールを管理することもできます。このドキュメントはコンソールでセキュリティグループを操作する方法について説明させていただきます。

## 前提条件

 [Tencent Cloud CVMコンソール](https://console.cloud.tencent.com/cvm/index)にログインしていること。

## 操作手順

### セキュリティグループの新規作成
> セキュリティグループを新規作成する時に、Tencent Cloud提供の「**オールポートをオーペンする**」と「**22、80、443、3389ポート及びICMPプロトコルをオーペンする**」という2種類のテンプレートを選択し新規作成することも、カスタムテンプレートを選択し新規作成することもできます。
>
#### Tencent Cloudテンプレートで新規作成
1. 左側ナビゲーションバーで、【[セキュリティグループ](https://console.cloud.tencent.com/cvm/securitygroup)】を選択し、【+新規作成】をクリックします。
2. ポップアップした「セキュリティグループを新規作成する」ウィンドウで、実際の必要に応じ、「**オールポートをオーペンする**」又は「**22、80、443、3389ポートとICMPプロトコルをオーペンする**」というテンプレートを選択し、セキュリティグループの名称を記入し、所属するプロジェクトを設定します。
3. 【OK】をクリックすると、新規作成が完了します。

#### カスタムテンプレートで新規作成
1. 左側ナビゲーションバーで、【[セキュリティグループ](https://console.cloud.tencent.com/cvm/securitygroup)】を選択し、【+新規作成】をクリックします。
2. ポップアップした「セキュリティグループを新規作成する」ウィンドウで、「カスタム」テンプレートを選択し、セキュリティグループの名称を記入し、所属するプロジェクトを設定し、【OK】をクリックします。
3. ポップアップした注意ウィンドーで、【すぐにルールを設定する】をクリックします。ルール設定の詳細については、下記のセキュリティグループのルール追加をご参照ください。

### セキュリティグループルールの追加
1. 「セキュリティグループルール」ページで、実際の必要に応じ、「インバウンドルール」と「アウトバウンドルール」の【ルール追加】をクリックします。
2. ポップアップした「インバウンド/アウトバウンドルールの追加」ウィンドウで、ルールを設定し、【完成】をクリックします。
ルール追加に関する主なパラメータは下記の通りです。
 - **タイプ**：システムルールテンプレート又はカスタムルールをを選択することができます。
 - **ソース/ターゲット**：トラフィックのソース（インバウンドルール）又はターゲット（アウトバウンドルール）としては、下記選択肢のいずれかを指定してください。
    - 指定した単一IPアドレス又はIPアドレス範囲： CIDR 表示法（例えば` 203.0.113.0` 又は `203.0.113.0/24`）を使います。
    - セキュリティグループIDの引用については、下記セキュリティグループのいずれかのIDを引用することができます。
      - 現在のセキュリティグループ。（セキュリティグループに関連付けられているCVMを示す）
      - ほかのセキュリティグループ。同じリージョンで同じプロジェクトに所属するもう一つのセキュリティグループ ID です。
    -  [パラメータテンプレート](https://cloud.tencent.com/document/product/215/20090)の中のIPアドレスオブジェクト又はIPアドレスグループオブジェクトを引用します。 
 - **プロトコルポート**：プロトコルタイプとポート範囲を記入します。 [パラメータテンプレート](https://cloud.tencent.com/document/product/215/20090) の中のプロトコルポート又はプロトコルポートグループを引用してもよいです。
 - **ポリシー**：許可又は拒否をすること。

>
> - セキュリティグループのID引用は高レベルな機能であり、オプションとして利用することができます。引用されるセキュリティグループルールは現在のセキュリティグループに追加されません。
> - セキュリティグループルールを設定する際に、ソース/ターゲットにセキュリティグループIDを入力する場合は、このセキュリティグループIDにバインディングしているCVMインスタンス、Elastic ENIのプライベートIPアドレスのみ（パブリックIPを含まない）をソース/ターゲットとすることを示しています。

### セキュリティグループルールの変更
> 実際の必要に応じ、設定したセキュリティグループルールを変更することができます。
>
1. 【[セキュリティグループ](https://console.cloud.tencent.com/cvm/securitygroup)】管理ページに入り、ルールを修正しようとするセキュリティグループのID/名称を選択し、右側の【ルール変更】をクリックします。
2. 変更する「セキュリティグループルール」ページで、実際の必要に応じ、既存ルールに対し**編集**、**削除**を行い、或いは**挿入**によりルールの優先度を調整します。セキュリティグループルールの優先度としては、**上にあるルールのほうは優先度が高い**です。

### インスタンスをセキュリティグループに関連付ける

1. 【[セキュリティグループ](https://console.cloud.tencent.com/cvm/securitygroup)】管理ページに入り、関連付けしようとするセキュリティグループを選択し、【インスタンス管理】をクリックし、インスタンス関連付けページに入ります。
2. 「インスタンス関連付け」ページで、【関連追加】をクリックします。
3. ポップアップした「インスタンス関連の追加」ウィンドウで、このセキュリティグループに関連付けしようとする一つか複数のインスタンスを選択し、【OK】をクリックし、このセキュリティグループに関連するインスタンスを追加します。

### セキュリティグループのクローン又は削除

【[セキュリティグループ](https://console.cloud.tencent.com/cvm/securitygroup)】管理ページに入り、クローン又は削除しようとするセキュリティグループを選択し、【もっと】をクリックし、【クローン】又は【削除】を選択します。
- セキュリティグループの**クローン**を選択した場合は、デフォルトではこのセキュリティグループのインバウンド/アウトバウンドルールのみをクローンし、このセキュリティグループに関連するインスタンスをクローンされません。
- セキュリティグループの**削除**を選択した場合は、削除しようとするセキュリティグループに関連するインスタンスがあるかを確認してください。関連するインスタンスがある場合は、先に関連するインスタンスを**セキュリティグループから削除**する必要があります（【インスタンス管理】をクリックする）。そうしないと、セキュリティグループの削除操作が実行できません。

### セキュリティグループルールのインポート/エクスポート

1. 【[セキュリティグループ](https://console.cloud.tencent.com/cvm/securitygroup)】管理ページに入り、セキュリティグループルールをインポート/エクスポートしようとするセキュリティグループのID/名称を選択し、【ルールの変更】をクリックし、当該のセキュリティグループ管理ページに入ります。
2. 【セキュリティグループルール】>【インバウンドルール】又は【アウトバウンドルール】タブを選択し、【ルールのインポート】をクリックします。
> 
> - 既存のルールがある場合、既存ルールを先にエクスポートすることをお薦めします。そうしないと、新しいルールをインポートすると、既存ルールを上書きします。
> - 元ルールが空である場合、先にテンプレートをエクスポートし、テンプレートファイルを編集してから、ファイルをインポートします。
> 
3. ポップアップした「**一括インポート-インバウンド/アウトバウンドルール**」ウィンドウで、編集済みのインバウンド/アウトバウンドルールのテンプレートファイルを選択し、【インポート開始】をクリックします。

### セキュリティグループAPIの利用

CVMコンソールのほかに、セキュリティグループAPIでセキュリティグループを操作することもできます。詳細については、[セキュリティグループAPI](https://cloud.tencent.com/document/product/213/12447)をご参照ください。
