## ユースケース

イメージを作成する時、パブリックイメージまたはサービスマーケットイメージでインスタンスを起動することを選択できます、このイメージをインスタンスに接続して、ソフトウェア環境を自分でデプロイします。インスタンスが正常に実行されている場合、実際のニーズに応じてこのインスタンスをベースにして、新しいカスタマイズイメージを作成できます。新しいカスタマイズイメージを作成した後、そのイメージを利用して、元インスタンスと同じカスタマイズ項目を持つ複数の新しいインスタンスを起動できます。

> 
> - カスタマイズイメージを作成する同時に、システムはデフォルトで関連するスナップショットも作成します。このスナップショットを削除する前に、関連するイメージを削除する必要があります。カレントのスナップショットはすでに商業化されており、カスタマイズイメージを保持すると、一定のスナップショット費用が発生します。 スナップショット課金ポリシーについては、[スナップショットの商業化に関するお知らせ](https://cloud.tencent.com/document/product/362/17935)をご参照ください。
> - 2018年7月以降パブリックイメージに基づいて作成されたCBSのCVMについて、オンラインイメージの作成をサポートします（インスタンスがシャットダウンされていない場合のイメージ作成）。
> - その他のインスタンスがカスタマイズイメージを作成する時、このインスタンスをシャットダウンしてください。イメージがカレントのインスタンスデプロイ環境と完全に一致するように保証します。

## 注意事項

- リージョンごとに10個のカスタマイズイメージがサポートされています。
- 以下のディレクトリ/ファイルがクリアされます：
 - /var/log/  
 - /root/.bash_history、/home/ubuntu/.bash_history（Ubuntu システム）
- Linuxインスタンスのカスタマイズイメージを作成する時、/ etc / fstabにデータディスク構成が含まれていないことを確認してください。そうでなければ、このイメージで作成されたインスタンスが正常に起動しなくなります。カスタマイズイメージを作成するLinuxインスタンスにデータディスクがマウントされている場合、/ etc / fstabの中に構成されたデータディスクの関連設定をコメント化または削除する必要があります。
- 作成プロセスは10分以上続く必要があり、具体的な時間はインスタンスのデータサイズによります。業務への影響を防ぐため、事前に関連準備を行ってください。

## 操作手順

### コンソールを利用してインスタンスから作成する

1. [CVMコンソール](https://console.cloud.tencent.com/cvm)にログインします。
2. インスタンスの管理画面で、イメージを作成する必要があるインスタンスを選択し、【詳細】>【インスタンス状態】>【シャットダウン】をクリックします。下図に示すように：
![シャットダウン](https://main.qcloudimg.com/raw/09102b9c844236d102a7f9e29a7e595c.png)
3. インスタンスがシャットダウンされた後、このインスタンス行で、【詳細】>【イメージの作成】をクリックします。下図に示すように：
![](https://main.qcloudimg.com/raw/5f4190da7a8b547fd751c5b5e0790755.png)
4. ポップアップの「カスタマイズイメージの作成」ウィンドウで、「イメージ名称」と「イメージ説明」を入力し、【イメージの作成】をクリックして作成します。
> コンソールの右上にある <img src="https://main.qcloudimg.com/raw/31b31c7b27848f0378932f17273feff3.png" style="margin: 0;"></img>をクリックし、イメージ作成の進行状況を確認します。
>
5. イメージが作成された後、左側ナビゲーションバーで、【[イメージ](https://console.cloud.tencent.com/cvm/image)】をクリックし、イメージの管理画面に入ります。
6. イメージリストで、作成したイメージを選択し、【インスタンスの作成】をクリックし、以前と同じイメージのサーバーを購入できます。下図に示すように：
![カスタマイズイメージ](https://main.qcloudimg.com/raw/80ee47a3d7f6d0b640b2bc3b04fa881c.png)

### APIを利用して作成する

CreateImageインターフェースを利用してカスタマイズイメージを作成することができます。 詳細については、[イメージAPIの作成](https://cloud.tencent.com/document/api/213/16726)をご参照ください。

## 最高実践

### データディスクのデータマイグレーション

新しいインスタンスを起動する同時に、元のインスタンスデータディスクのデータを保持する必要がある場合、まずデータディスクに[スナップショット](https://cloud.tencent.com/document/product/362/5754)を作成します。 新しいインスタンスを起動する時に、このデータディスクのスナップショットを利用して新しいCloud Block Storageデータディスクを作成します。
詳細情報については、 [Cloud Block Storageのスナップショット作成](https://cloud.tencent.com/document/product/362/5757)をご参照ください。




