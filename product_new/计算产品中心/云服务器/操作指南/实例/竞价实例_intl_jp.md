## 操作シナリオ
このドキュメントは、ビッドインスタンスの管理及び購入する方法について説明させていただきます。現在、下記の3種類の利用方法があります。
- **CVMコンソール**：CVM購入ページはビッドインスタンスモードに対応しています。
- **BatchComputeコンソール**：BatchComputeは作業提出及びコンピューティング環境作成時にビッドインスタンスを選択することに対応しています。
 **TencentCloud API**：[RunInstance インターフェース](https://cloud.tencent.com/document/api/213/15730) はビッドインスタンスの関連パラメータを追加しています。


## 操作手順
### CVMコンソール

1.  [CVM購入ページ](https://buy.cloud.tencent.com/cvm)にログインします。
2. 下図の示すように、モデルを選択する時に、課金モードは【ビッドインスタンス】を選択します。
> ビッドインスタンスは現在カナリアテスト段階にあります。カナリアになっていないユーザーは [作業依頼書を提出](https://console.cloud.tencent.com/workorder/category) して事前利用を申請できます。
>

3. 実際のニーズとページのヒントにより、リージョン、アベイラビリティゾーン、ネットワーク、インスタンス等のコンフィギュレーション情報を設定します。
4. 購入したビッドインスタンスの情報を確認し、各コンフィギュレーションの費用明細を把握します。
5. 【アクティブ】をクリックし、支払いします。
支払った後に、 [CVMコンソール](https://console.cloud.tencent.com/cvm) に入り、ビッドインスタンスを確認することができます。

### BatchComputeコンソール
- **非同期インターフェース**：作業提出又はコンピューティング環境作成、コンピューティング環境期待数の修正を行う際に、BatchComputeは非同期の形で顧客のリクエストを処理します。即ち、現在のリクエストが在庫や価格等の原因で満たされない場合は、満たされるまでにビッドインスタンス型リソースを申請し続けます。
インスタンスをリリースしたい場合は、BatchComputeコンソールでコンピューティング環境のインスタンス数を調整する必要があります。CVMコンソールでリリースする場合は、BatchComputeは期待する数を満たすまでに自動的に作成します。
- **クラスターモード**：BatchComputeのコンピューティング環境はクラスターモードでビッドインスタンスをメンテナンスすることに対応しています。必要な数、コンフィギュレーションと最高指値を提出すると、コンピューティング環境は期待する数を満たすまでに自動的に申請を出します。中断が起こっても、自動的に再度申請し数を補充します。
- **固定価格**：現在の段階では固定割引モードを採用しています。顧客はパラメータを現在の市場価格以上に設定しなければなりません。市場価格の詳細情報は [現在ビッドインスタンスの対応しているリージョン及びインスタンスタイプ・仕様](https://intl.cloud.tencent.com/document/product/213/17817)をご参照ください。

#### 使用手順

1.  [BatchComputeコンソール](https://console.cloud.tencent.com/batch/env)にログインします。
2. コンピューティング環境管理ページでは、任意リージョンを選択し（例えば広州リージョンを選ぶ）、【新規作成】をクリックします。
コンピューティング環境の新規作成ページに入ります。
3. 下図に示すように、コンピューティング環境の新規作成ページで、【課金タイプ】を【ビッドインスタンス】に設定し、実際のニーズに応じ、必要となる機種、イメージ、名称、期待数などの情報を選択します。

4. 【OK】をクリックし、新規作成を完了します。
新規作成した後に、 [BatchComputeコンソール](https://console.cloud.tencent.com/batch/env) で作成したコンピューティング環境を確認することができます。その同時に、コンピューティング環境におけるCVMも同期に作成中です。顧客は当該コンピューティング環境の【イベントログ】と【インスタンスリスト】により作成の状況を確認できます。


### TencentCloud API
RunInstance インターフェースにおける [InstanceMarketOptionsRequest](https://cloud.tencent.com/document/api/213/15753#InstanceMarketOptionsRequest) パラメータはビッドインスタンスモードを指定し、関連情報をコンフィギュレーションすることができます。
 **同期インターフェース**：現在、 RunInstanceが提供している同期リクエストインターフェースは一回限り使用できます。即ち、申請が失敗（在庫不足、請求価格が市場価格以下）した場合は直ちに失敗を戻し、引き続き申請をしません。
* **固定価格**：現在の段階では固定割引モードを採用しています。顧客はパラメータを現在の市場価格以上に設定しなければなりません。市場価格の詳細情報は [現在ビッドインスタンスの対応しているリージョン及びインスタンスタイプ・仕様](https://intl.cloud.tencent.com/document/product/213/17817)をご参照ください。

#### ケース例
顧客は広州三区における一つのインスタンスを保有しており、当該インスタンスの課金モードが時間ごとに課金する後払いのビッドモードとします。具体的なビッドモードのコンフィギュレーション情報は下記の通りです。
- 最高ビッド：0.6元/時間
- ビッドリクエストモード：一回限りのリクエスト
- イメージ ID：img-pmqg1cw7
- 選択するモデル：2C4G二世代標準型（S2.MEDIUM4）
- 購入数：1台

#### リクエストパラメータ
```
https://cvm.tencentcloudapi.com/?Action=RunInstances
&Placement.Zone=ap-guangzhou-3
&InstanceChargeType=SPOTPAID
&InstanceMarketOptions.MarketType=spot
&InstanceMarketOptions.SpotOptions.MaxPrice=0.60
&InstanceMarketOptions.SpotOptions.SpotInstanceType=one-time
&ImageId=img-pmqg1cw7
&InstanceType=S2.MEDIUM4
&InstanceCount=1
&<パブリックリクエストパラメータ>
```

#### 返されるパラメータ
```
{
  "Response": {
    "InstanceIdSet": [
      "ins-1vogaxgk"
    ],
    "RequestId": "3c140219-cfe9-470e-b241-907877d6fb03"
  }
}
```

