
## Auto Scaling ASとは？
Auto Scaling（AS）は、サービスニーズとポリシーに応じて、CVMコンピューティングリソースを自動的に調整することにより、アプリケーションの負荷を処理できるための適切な数のCVMインスタンスを確保します。Webサービスでは、インテリジェントなスケールアウトとスケールインは、コスト制御とリソース管理において重要な部分をなしています。Webアプリケーションがより多くのリクエストトラフィックを取得するとき、サーバーを追加することで余計な負荷を処理します。同時に、Webアプリケーションのトラフィックが減少するとき、十分に使用されていないサーバーが終了されます。

容量調整にASを使用するには、事前にスケールアウト条件とスケールイン条件を設定するだけです。ASは、条件が満たされている場合に、使用するサーバー数を自動的に増やすことでパフォーマンスを維持します;ニーズが低下している場合に、ASはスケールイン条件に基づいてサーバー数を減らすことでコストを最小限に抑えます。

下記両図の対比が示すように、ASを使用することにより、クラスターは常に適切な数のリソースを確保しながら、ヘルシー状態を維持できます。従来のモードにおける、下記のような様々な不便さがなくなります。 

- サービスの急増またはCC攻撃によりマシン数が不足しているため、サービスが応答できません
-  ピーク時の想定アクセス数に基づいてリソースを配備するが、通常のアクセス数がピークに達することはめったにないため、リソースの浪費になります
-  手動による保護および容量アラームの頻繁な処理のため、複数回の手動変更が必要になります

**従来のモードにおけるクラスターのメンテナンス：**
![Alt text](https://main.qcloudimg.com/raw/4832330faba1612dc6e70066c426dbbc.png)

**AS使用後の効果：**
![Alt text](https://main.qcloudimg.com/raw/f4a8c87d4f783fea986a171a8477bc1f.png)


## ASの仕組み

一般的なWebアプリケーションサービスでは、通常はクラスターでアプリケーションの複数コピーを実行することでお客様のトラフィックを満たします。たとえば、アクセス層にあるフロントエンドのサーバークラスター、ロジック層にあるアプリケーションサーバークラスター、バックエンドのキャッシュサーバークラスターなどです。各インスタンスはいずれもお客様のリクエストを処理できます。

これらの類似または同一のインスタンスの数は通常、調整可能です。下記の方式によって、これらの同一または類似のマシンを同じスケーリンググループで一括管理できます。

- 各スケーリンググループ内にあるインスタンスの最小数の値を指定できます。ASは、スケーリンググループ内にあるインスタンス数がいつでもこの値を下回らないことを確保します；
- 各スケーリンググループ内にあるインスタンスの最大数の値を指定できます。ASは、スケーリンググループ内にあるインスタンス数がいつでもこの値を上回らないことを確保します；
- スケーリングポリシーを指定できます。ASは、アプリケーションニーズの増減に応じて、インスタンスを起動するか、終了できます。スケーリングポリシーには下記の2つのタイプがあります。
     a）アラームのトリガーポリシー：指定した条件に基づいてダイナミックに拡張します（例：スケーリンググループのマシンのCPU利用率が60％を超えた場合に拡張します）
     b）定期スケーリングポリシー：指定した時刻に基づいて拡張します（例：毎晩の21時に拡張します） 
- ポリシーを設定した後、スケーリングアクティビティの通知を設定できます。ASは、スケーリングアクティビティ発生時にEメール、SMS、または内部メッセージでユーザー通知します。ASの通知に注意するだけでよいため、サービスのリクエスト数の変化を刻々と監視する必要はありません。
- 必要なマシン数をいつでもワンクリックで指定したり、既存のマシンをスケーリンググループに追加して管理したりすることもできます。

## ASの基本概念

**Auto Scaling製品の基本概念は次のとおりです：**

- スケーリンググループ
- スタートアップコンフィグレーション
- スケーリングポリシー
- クールダウン時間


## 1.スケーリンググループ
スケーリンググループは、同じルールに従い、同じシナリオに対応するCloud Virtual Machineインスタンスのコレクションです。スケーリンググループは、グループ内のCVMインスタンス数の最大値、最小値、および関連するCloud Load Balancerインスタンスなどのプロパティを定義します。

## 2.スタートアップコンフィグレーション
スタートアップコンフィグレーションは、Cloud Virtual Machineを自動的に作成するテンプレートです。なかには、イメージID、Cloud Virtual Machineインスタンスタイプ、システムディスクおよびデータディスクタイプと容量、キーペア、セキュリティグループなどが含まれます。

スケーリンググループの作成時にスタートアップコンフィグレーションを指定する必要があります。スタートアップコンフィグレーションを作成すると、そのプロパティが変更できません。

## 3.スケーリングポリシー
スケーリングアクティビティを実行するための条件です。トリッガーの条件は、時間またはクラウド監視のアラームに指定可能です。アクションは、CVMからの除去またはCVMへの追加が可能です。
スケーリングポリシーには次の2つのタイプがあります：

- **定期スケーリングポリシー**
指定した時刻に達すると、CVMインスタンスを自動的に増加するか減少できます。周期的な反復実行がサポートされています。

- **アラームスケーリング**
クラウド監視指標（CPU、メモリ、ネットワークトラフィック）に基づいて、CVMインスタンスを自動的に増加するか減少できます。

## 4.クールダウン時間
クールダウン時間とは、同じスケーリンググループで実行されたスケーリングアクティビティ（CVMインスタンスの追加または除去）終了後のロック時間のことです。この期間内に、スケーリンググループはスケーリングアクティビティを実行しません。クールダウン時間の値は、0〜999999（秒）に指定可能です。
