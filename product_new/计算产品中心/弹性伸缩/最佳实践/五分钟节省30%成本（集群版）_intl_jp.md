このソリューションは、クラスター化されたデプロイのウェブサイト/ APPに適しています。

業務が以下の条件を満たす場合は、5分でこのソリューションを構成し、コストの30％を節約できます：

- ウェブサイトはクラスターを使用し、クラスター内に複数のサーバーがあります。
- ウェブサイトには長時間の空き時間がある。 Tencent Cloudの統計によると、クラスターの90％は午前00:00〜午前09：00の9時間の負荷は30％未満である。

大部分のウェブサイトのピーク時間は8時間以下であり、残りの16時間はアイドル状態のサーバーをスケールインできるため、多くのコストを節約できます。

本文では、あるカジュアルウェブサイトを例として、このウェブサイトのアクセスピーク時間は20：00-24：00です。

##ソリューションの説明

- 非ピーク時の負荷で固定リソースをデプロイし、サブスクリプション方式のCVMを使用できます；
- ピーク時間の足りない部分は従量課金のCVMを使用します。 定時タスクを通して、20:00に1台をスケールアウトし、24：00にスケールインします。

新旧ソリューションの比較：
![](https://mc.qcloudimg.com/static/img/46cc4300131254282b894c9b1ed691ac/AS-Best+Practise-Cluster+Solution%281%29.png)

## 収益
原案は4コア4GのCVMを2台が必要だと仮定して、4コア4GのCVMを1台 + 毎日4時間の一時CVMに変更することにより、約30％の費用を節約できます。

例中の小さなウェブサイトは、年間約1500元を節約できます。

![](https://mc.qcloudimg.com/static/img/a72443a68d6f16e0a8a37d39f3b73aa7/image.jpg)

## 詳細の操作

インスタンスのウェブサイト構造は比較的簡単で、アプリケーションサーバーだけのクラスターです。複雑なウェブサイトにアプリケーションサーバーのクラスター、フロントエンドサーバーのクラスター、キャッシュサーバークラスターなどがあります。各クラスターは類似する操作を実行でき、各クラスターは1つのスケーリンググループに対応します。

![](https://mc.qcloudimg.com/static/img/76238c1b282534b67e80a7e4d04bba17/AS-Best+Practise-Cluster+Solution%282%29.png)

### step 1. クラスターCVMのカスタマイズイメージを作成する

この手順は非常に簡単で、既存の一台クラスターCVMに基づいて作成できます。ご質問がある場合は[カスタマイズイメージの作成>>](https://intl.cloud.tencent.com/document/product/213/4942)をご参考ください。

>注：
>事前にイメージ中の環境をデプロイする必要があり、イメージ内のアプリケーションがOSと同時に起動できることを確保します。このようにスケールアウトされたCVMは手動操作なしで直接稼働できます。

### step 2. 起動設定の作成

スケールアウトする時、ASは起動設定をテンプレートとしてCVMを作成します。従って、事前に起動設定を利用してリージョン、モデル、イメージを指定します。

1. [Auto Scalingコンソール](https://console.cloud.tencent.com/autoscaling/config)にログインし、ナビゲーションバー中の【起動設定】をクリックします。

2. 項目とリージョンを選択し、Webアプリケーションのある項目とリージョンを選択することに注意してください。
![](https://mc.qcloudimg.com/static/img/9a39d87fa90f3ae5995073a6077b1057/1.jpg)

3. 次の操作はCVMの購入と似ており、指示に従って起動設定の作成を完了できます。カスタマイズイメージ中、先ほど作成したイメージを指定することに注意してください。
![](https://mc.qcloudimg.com/static/img/02220977468b12ef47c9aeb30a26b06d/2.jpg)


### step 3. CVMのためにスケーリンググループを作成する

 [Auto Scalingコンソール](https://console.cloud.tencent.com/autoscaling)で、【新規作成】をクリックして、以下のようにクラスターの管理情報を記入します：

- **名称**：必要に応じて名前を付けます。例えばここに「アプリケーションサーバーのクラスター」を記入します。
- **最小スケーリング数**：クラスターサーバー数の下限。 例えば、ここに0を入力します。
- **初期インスタンス数**：スケーリンググループを作成されたときに、**自動作成**のCVMの数です。一般的に、スケーリンググループを作成された直後にCVMが自動的に作成されることはありません。ここに0を入力するのをお勧めします。
- **最大スケーリング数**：クラスターサーバー数の上限、ここには必要に応じて記入します。ここでは5を例として、スケーリンググループは最大5台のCVMがあります。
- **起動設定**：作成した起動設定を選択する。
- **ネットワークをサポートする**：セッションサーバーのネットワーク環境であり、通常は「基幹ネットワーク」を選択します。
- **アベイラビリティーゾーンをサポートする**：スケールアウトCVMが含まれるアベイラビリティーゾーンを選択し、ここではセッションサーバーのあるアベイラビリティーゾーンをチェックします。
- **削除ポリシー**：デフォルトを選択することです。
- **Cloud Load Balancer**：クラスターのCLBを選択します。
![](https://mc.qcloudimg.com/static/img/f3ab676105c79c61ce877b92e4e6ca7c/24.jpg)

最後に【OK】をクリックし、作成を完成します。

### step 4. 既存のCVMをスケーリンググループに追加する

1. [コンソール](https://console.cloud.tencent.com/autoscaling) でスケーリンググループ名をクリックし、管理画面に入り、画面の下部の【クラウドホストの追加】をクリックします。
![](https://mc.qcloudimg.com/static/img/3ff1beba2621d68ef939d7fd0df2de11/5.jpg)

2. ポップアップされたダイアログボックスで、クラスター内の既存のサーバーを選択してスケーリンググループに追加します。 非ピークの場合に、クラスター内の使用率が低いサーバーをリターンし、コストを節約できます。
![](https://mc.qcloudimg.com/static/img/be11ceec587195b7cf39f9183a051769/6.jpg)

3. 参加後、サーバーを「スケールインなし」に設定します。そのため、スケールイン処理の中、スケーリンググループはこのサーバーをスケールイン対象として選択しません。 そして、クラスターの中でこのCVMは常に動作しています、ASはそれを変更しません。
![](https://mc.qcloudimg.com/static/img/2c19119e95beb4eb820757939578c656/7.jpg)

### step 5. スケーリングのポリシーを設定する（重要！）

ASは、定時スケールアウト又はアラームダイナミックに基づいたスケールアウトをサポートし、スケーリング通知の受信およびスケーリング履歴の確認をサポートします。ユーザーはすべてを把握できます。
![](https://mc.qcloudimg.com/static/img/f348d96c002cdf79ac2033abcd7e6e4c/8.jpg)

-  **まず、20:00に定時スケールアウトのタスクを設定する**
![](https://mc.qcloudimg.com/static/img/0721f68f33dca49f7175d1f4fd3a80aa/t1.jpg)
> 注：
> Tencent CloudのCVMの作成は約1分ぐらいかかります、カスタマイズイメージが大きい場合は、さらに時間がかかります。 実行の開始時間を5分早くすることができます。

- **次に、24：00に定時スケールインのタスクを設定する**
![](https://mc.qcloudimg.com/static/img/a86e797fa59c66d304837b3017d7bc78/t2.jpg)

ここで成功を収めます！

ウェブサイトのバックグラウンドクラスターは、「1台の固定アプリケーションサーバー+ピーク時に定時的に作成された1台のアプリケーションサーバー」になります。
スケーリンググループに追加されていない他のクラスターCVMは、大部分の時間は十分に使用されない場合、リターンされてコストを節約できます。
