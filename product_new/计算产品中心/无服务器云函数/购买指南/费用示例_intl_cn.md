## 计算方案案例

当前云函数的资源用量，是按照函数的配置内存乘以触发时的**实际运行时长**进行计费。相较于原方案向上对齐 100ms 计费的方式，产生了更低的总体资源用量及费用，为您节省了预算。

### Web 和 API 服务

Web 服务或 API 请求，代码的实际运行时间通常仅为 30ms - 50 ms。按实际运行时长计费，优惠程度可达 70%。

**案例**：A 用户使用云函数及 API 网关构成的某个 API 服务，配置了128MB的函数，平均执行时间为 37ms。原计算方案中，函数的计费时长为 100ms，在每天 100 万次调用的情况下会产生 12500 GBs 的资源用量。而按实际运行时长计费的方案，产生的资源用量仅为 4625 GBs，相比降低了 63%。

### 消息处理

针对消息队列中的消息进行过滤、转换及转发，代码的实际运行时长通常仅为 60ms - 80ms。按实际运行时长计费，优惠程度可达 40%。

**案例**：B 用户使用 Ckakfa 的消息触发云函数，并将完成过滤及数据格式转换的消息重新投递 Ckafka，配置了 256 MB 的内存，平均运行时长为 67ms。在每天 500 万次调用的情况下，原计算方案会产生 125000 GBs 的资源用量。而按实际运行时长计费的方案，产生的资源用量仅为 83750 GBs ，相比降低了 37%。


### 事件转发

将对象存储的事件转发至下游系统，代码的实际执行时间通常仅为 50ms - 80ms。按实际运行时长计费，优惠程度可达 50%。

**案例**：C 用户使用云函数将 COS 对象存储的文件上传事件转发至自身的文件处理系统中，配置了 128MB 内存，函数的平均运行时长为 43ms。在每天有20万文件上传的情况下，原计算方案会产生 2500 GBs 的资源用量。而按照实际运行时长计费的方案，产生的资源用量为 1075 GBs，相比降低了 57%。



## 计费示例
### Web 和 API 服务
假设函数配置了 API 网关，通过 URL 请求触发函数运行，每天有 10 万次请求。云函数配置了 128 MB 内存，每次处理请求的平均运行时间为 70ms。

**每天的资源使用量及调用次数如下**：
- 每天的调用次数：100000 次
- 每天的资源使用量：（128 / 1024）×（70 / 1000）× 100000 = 875 GBs


**按月30天计算费用如下**：
- 资源使用月费用：875 × 30 = 26250 GBs，小于 40 万 GBs，不产生费用
- 调用次数月费用：（100000 x 30 / 10000 - 100）x 0.002 = 0.4 美元

在这种情况下，总花费为：调用次数费用 0.3 美元。

### 消息队列触发

假设函数配置了 Ckafka 触发方式，每秒触发函数3次，配置云函数使用了128MB内存，将消息处理后放入处理后的消息队列，每次处理消息，函数运行时间为260ms。

**每天的资源使用量及调用次数如下**：
- 每天的资源使用量：（128 / 1024）×（260 / 1000）× 3 × 3600 × 24 = 8424GBs
- 每天的调用次数： 3 × 3600 × 24 = 259200次

**按月30天计算费用如下**：
- 资源使用月费用：8424 × 30 = 252720GBs，小于40万GBs，无费用产生
- 调用次数月费用：（259200 × 30 / 10000 - 100）× 0.002 = 1.36 美元

在这种情况下，总花费为：调用次数费用 1.36 美元。


### 外部文件上传

假设函数由用户使用云 API 直接调用，每分钟调用50次，配置了云函数使用256MB内存，函数每次生成一个1KB大小的文件并上传至用户自建的外部站点上，每次生成及上传文件，函数运行时间为780ms

**每天的资源使用量及调用次数如下**：
- 每天的资源使用量：（256 / 1024）×（780 / 1000）× 50 × 60 × 24 = 14040GBs
- 每天的调用次数：50 × 60 × 24 = 72000次
- 每天的流量：1 × 50 × 60 × 24 = 72000KB = 70.31MB

**按月30天计算费用如下**：
- 资源使用月费用：（14040 × 30 - 400000）× 0.0000167  = 0.35 美元
- 调用次数月费用：（72000 × 30 / 10000 - 100）× 0.002 = 0.23 美元
- 外网出流量费用：（70.31 × 30 / 1024）× 0.12  = 0.25 美元

在这种情况下，总花费为：资源使用费用 0.35 + 调用次数费用 0.23 + 外网出流量费用 0.25 =  0.83美元。
