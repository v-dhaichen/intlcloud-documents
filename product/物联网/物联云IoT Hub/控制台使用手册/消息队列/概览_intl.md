[//]: # (chinagitpath:XXXXX)

You can perform configurations on the message queue page after a product is created, such as choosing the device message type to be pushed to the message queue. Your server obtains device data from the queue. The message queue feature provides reliable asynchronous communication mechanism between device and third-party server.

The figure below uses CMQ as an example to illustrate the whole process of data forwarding from the rule engine to the message queue:
![image](http://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/iot_server_subs.png)

## Applicable Scenarios
The most important feature of message queue is it can work with Tencent Cloud's message queue service to provide reliable message storage and transfer. The message queue can even be connected to other Tencent Cloud computing modules to provide seamless computing services. Because of the characteristics of the message queue feature, it is suitable for the following scenarios:
 - Fast and stable receipt of device messages is required, especially if the device generates a high number of messages or the message volume fluctuates greatly over time.
 - Real-time processing of device status messages is required to ensure that device status information does not get lost.
 - Connection with other Tencent Cloud computing modules is required to process massive amounts of device information.
 
## Forwarded Message Types
Currently, the message queue feature can forward the following two types of messages:
- **Device status notification**: this includes the notifications of changes in the device's online and offline status as well as some system notifications generated by IoT Hub.
- **Device-reported message**: this includes all messages published by the device to the topics. After the message queue feature is activated for the product and the "Device-reported messages" option is selected on the parameter configuration page, the IoT Hub backend will forward all messages published by all the devices under the product to the topics to the message queue.

## Message Format
The messages reported to the message queue must be in the format of a JSON string as shown below:

```
{
    "MsgType":"Publish",
    "Event":"",
    "Topic":"iot-product/iot-device/update",
    "Seq":244,
    "PayloadLen":121,
    "DeviceId":"144115205259838664",
    "ProductName":"iot-product",
    "DeviceName":"iot-device",
    "Payload":"eyJhY3Rpb24iOiAicmVwb3J0IiwgInRhcmdldERldmljZSI6ICJhYyIsICJkZXZJZCI6MTQ0MTE1MjA1MjU5ODM4NjY0LCAiZGF0YSI6eyJjdXJyZW50IjoyNTExLCAidGVtcCI6MjczMSwgIndhcm5pbmciOjF9fQ=="
}
```
The following are the meanings of the various fields:

| Field | Meaning |
|---------|---------|
| MsgType | Type of the reported message; value: "Publish" or "Status", representing messages reported by the device or device status notifications respectively. |
| Event | This field is valid only when MsgType is Status, representing the event notified of by the status. For example, the value "Online" means that the device is online, while "Offline" means that the device is offline. |
| Topic | The topic that publishes the message |
| Seq | Serial number of the message |
| PayloadLen | Message payload length |
| DeviceId | Device ID |
| ProductName | Product name |
| DeviceName | Device name |
| Payload | Message content, which is a Base64-encoded string |

## Configuration
IoT Hub supports two types of message queue: CMQ and CKafka. Go to the product details page and click "Message Queue" to configure the message queue type as needed.
![](https://main.qcloudimg.com/raw/aa980374992d9d537c87346306f87ee7.png)

## Additional Information
Click [Message Queue](https://cloud.tencent.com/document/product/634/12724) in the product section at the official website to learn more about Tencent Cloud Internet Middleware Message Queue products.
![](https://mc.qcloudimg.com/static/img/1a81bad91b5096f30ef8c44c33c60cf9/xiaoxiduilie_pro.png)

