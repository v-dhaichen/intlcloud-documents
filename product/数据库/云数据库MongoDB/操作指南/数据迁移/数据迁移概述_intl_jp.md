## MongoDB移行ツールの使用説明
## 自己構築型移行の概要
TencentDB for MongoDBは、現在クラウドサーバーCVMの自己構築インスタンスの移行とパブリックネットワークインスタンスの移行の2種類の移行をサポートしています。
#### 移行用語

| 用語 | 説明 |
|---------|---------|
| ソースインスタンス | 移行されたソースインスタンス |
| ターゲットインスタンス | 移行のターゲットインスタンス、つまりユーザーが購入したTencentDB for MongoDB |
| サーバー | 移行されたソースインスタンスのあるサーバー |

#### 移行の注意事項
1.移行の効率性を確保するために、CVMの自己構築インスタンスの移行は地域間の移行がサポートされません。  
2.パブリックネットワークインスタンスが移行されるとき、ソースインスタンスサービスがパブリックネットワーク環境でアクセス可能であることを確認します。  
3.移行が成功すると、ビジネス側でデータが検証された後、ソースインスタンス接続が切断され、接続がターゲットインスタンスに切り替えられます。  
4.[特記事項]自己構築インスタンスがシングルノードの場合、シングルノードにoplogがないため、オンライン移行はサポートされません。

## 移行過程
#### 移行タスクの新規作成
「移行タスクリスト」に移動した後、以下の手順に従って移行タスクを新規作成してください。
1.	ターゲットインスタンスのある地域を選択します。
2.	「インスタンス移行タスクの新規作成」をクリックして、移行タスクの作成ページに移動します。
![](https://mc.qcloudimg.com/static/img/164c0ebdd2ce7a9a171c9be0727b6cb3/1.1.png)

#### 基本情報の入力
以下は、クラウドサーバーCVM上のMongoDBインスタンスを例として、パブリックネットワークインスタンスの移行を説明します。

| フィールド | 説明 | 用途 | 必須項目 |
|---------|---------|---------|---------|
| タスクの名前 | 移行タスクの名前 |ユーザーがタスクを便利に管理できます | はい |
| CVM ID | ソースMongoDBインスタンスのあるTencent CVM ID |移行タスクは、CVMインスタンスIDに基づいてCVMの実行状況を確認します。パブリックネットワークの移行は、記入しなくてもいいです | はい |
| MongoDB IP |ソースMongoDBインスタンスのあるTencent　CVMのプライベートネットワークIP |移行タスクはCVMプライベートネットワークIPを確認します | はい |
| ポート | ソースインスタンスのポート番号 |移行タスクはソースインスタンスサービスにアクセスします | はい |
| パスワード | ソースインスタンスパスワード |ソースインスタンスサービスにアクセスするときに認証があります | はい |
| ターゲットデータベース-インスタンス | ターゲットインスタンスID |データをターゲットインスタンスに同期させます | はい |
![](https://mc.qcloudimg.com/static/img/77fb157b0783b3706e5bd7f97d3eb6fb/2.png)

#### 移行対象の選択
現在、データベースレベルの移行機能をサポートしています。移行するデータベースを選択してください。保留をクリックしてタスクを作成します
![](https://mc.qcloudimg.com/static/img/d04abd9d68433d3377adfe97cdf9ebf3/4.png)


タスクが成功的に作成されると、タスクがタスクリストに表示されます
![](https://mc.qcloudimg.com/static/img/346f74a2a400e9ef851d35412cb8dfb4/5.png)

#### 移行タスクの開始
タスクが成功的に作成された後、タスクはまだ開始されていません。開始をクリックして、タスクが開始された後、タスクはパラメーター検証を実行します。
![](https://mc.qcloudimg.com/static/img/188aace20bea6af2363b6b170409bb4a/6.png)

パラメーターの検証が成功した後、移行を実行できます。それ以外の場合は実行できません。
![](https://mc.qcloudimg.com/static/img/417733549ad60a3fbcbec475663f762f/7.png)
特記事項：ネットワークにアクセスできない場合は、ソースインスタンスが存在するサービスのセキュリティグループを確認し、セキュリティグループをすべてのポートに開放する必要があります

#### 移行過程
ポップアップのスタートボタンをクリックして、移行を正式に開始します。
移行過程は3つのステップに分けられます
1.データ同期
2.インデックス作成
3.oplog同期
![](https://mc.qcloudimg.com/static/img/4e72afb7a91729bbcc47e9424bc6ff65/8.png)

#### 同期の切断
oplogからlogを読み取り、新しいインスタンスに書き込みます。タスクの終了をクリックし、OKをクリックして、データ同期操作を完了できます。タスクの終了は、oplog同期を終了し、タスク成功をマークします。（同期を切断する前に、ターゲットインスタンスのデータを検証できます。検証が正しい場合は、同期を切断できます。）
移行過程中に移行を中断したい場合は、タスク中止をクリックすると、タスク中止は同期化された操作をすべてロールバックして、タスク失敗をマークします。

![](https://mc.qcloudimg.com/static/img/d4f8a746fb7be7c172088ce808d13fc1/9.png)

![](https://mc.qcloudimg.com/static/img/e56d0392b9e0fc287eec5ee1e8fcfd12/10.png)

