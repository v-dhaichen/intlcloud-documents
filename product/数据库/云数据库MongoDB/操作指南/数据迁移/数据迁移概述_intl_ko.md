## MongoDB 마이그레이션 도구 사용 설명
## 자체 생성한 마이그레이션 소개
TencentDB for MongoDB는 현재 CVM 자체 생성한 인스턴스 마이그레이션과 공중망 인스턴스 마이그레이션 두 가지를 지원합니다.
#### 마이그레이션 용어집

| 용어 | 설명 |
|---------|---------|
| 오리진 인스턴스 | 마이그레이션한 오리진 인스턴스 |
| 대상 인스턴스 | 마이그레이션한 대상 인스턴스, 즉, 사용자가 구매한 TencentDB for MongoDB |
| 속한 서버 | 마이그레이션한 오리진 인스턴스가 속한 서버 |

#### 마이그레이션 주의 사항
1. 마이그레이션의 효율을 높이기 위해, CVM 자체 생성한 인스턴스 마이그레이션은 지역 간의 마이그레이션을 지원하지 않습니다.
2. 공중망 인스턴스를 마이그레이션할 때, 오리진 인스턴스의 서비스가 공중망에서 액새스할 수 있도록 확인해야 합니다.
3. 마이그레이션이 성공하면, 비즈니스 측에서 데이터를 검증한 후, 오리진 인스턴스와의 연결을 끊고 대상 인스턴스로 전환합니다.
4. [주의] 자체 생성한 인스턴스가 단일 노드일 경우, 단일 노드에 oplog가 없기 때문에 온라인 마이그레이션을 지원하지 않습니다.

## 마이그레이션 과정
#### 마이그레이션 작업 생성
"마이그레이션 작업 리스트"에 들어가서 다음 절차에 따라 마이그레이션 작업을 생성합니다.
1. 대상 인스턴스가 속한 지역을 선택하십시오.
2. "인스턴스 마이그레이션 작업 생성"을 클릭하여 마이그레이션 작업 생성 페이지에 들어갑니다.
![](https://mc.qcloudimg.com/static/img/164c0ebdd2ce7a9a171c9be0727b6cb3/1.1.png)

#### 기본 정보 입력
다음은 CVM의 MongoDB 인스턴스를 예로 든 설명입니다. 공중망 인스턴스 마이그레이션도 이와 같습니다.

| 필드 | 설명 | 용도 | 필수 여부 |
|---------|---------|---------|---------|
| 작업 이름 | 마이그레이션 작업의 이름 | 사용자가 작업을 관리하는 데 도움이 됩니다 | 예 |
| CVM ID | 오리진 MongoDB 인스턴스가 위치한 CVM ID |마이그레이션 작업은 CVM 인스턴스 ID에 따라, CVM의 운영 상황을 검사합니다. 공중망 마이그레이션일 경우, 입력할 필요 없습니다. | 예 |
| MongoDB IP |오리진 MongoDB 인스턴스가 위치한 CVM의 사설망 IP |마이그레이션 작업은 CVM 사설망 IP를 검사합니다. | 예 |
| 포트 | 오리진 인스턴스 포트 번호 | 마이그레이션 작업은 오리진 인스턴스 서비스를 액세스합니다. | 예 |
| 비밀번호 | 오리진 인스턴스 비밀번호 |오리진 인스턴스 서비스에 액세스 시, 인증을 진행합니다. | 예 |
| 대상 데이터베이스 - 인스턴스 | 대상 인스턴스 ID |데이터를 대상 인스턴스로 동기화| 예 |
![](https://mc.qcloudimg.com/static/img/77fb157b0783b3706e5bd7f97d3eb6fb/2.png)

#### 마이그레이션 대상 선택
데이터베이스 수준의 마이그레이션 기능을 지원하므로 마이그레이션할 데이터베이스를 체크하십시오. 유지를 클릭하여 작업을 생성합니다.
![](https://mc.qcloudimg.com/static/img/d04abd9d68433d3377adfe97cdf9ebf3/4.png)


작업이 성공적으로 생성되면 태스크 리스트에 표시될 것입니다.
![](https://mc.qcloudimg.com/static/img/346f74a2a400e9ef851d35412cb8dfb4/5.png)

#### 마이그레이션 태스크 시동
태스크는 생성된 뒤 여전히 시동하지 않는 상태입니다. 시동을 클릭하여 태스크를 시동하면 태스크는 매개변수 검증을 진행합니다.

![](https://mc.qcloudimg.com/static/img/188aace20bea6af2363b6b170409bb4a/6.png)

매개변수를 성공적으로 검증한 다음 마이그레이션할 수 있습니다. 그렇지 않으면 진행할 수 없습니다.
![](https://mc.qcloudimg.com/static/img/417733549ad60a3fbcbec475663f762f/7.png)

주의: 네트워크가 도달할 수 없는 경우, 오리진 인스턴스가 위치한 서비스 보안 그룹을 검사하여 모든 포트를 개방해야 합니다.

#### 마이그레이션 과정
팝업창의 시동 버튼을 클릭하여 정식적으로 마이그레이션을 시작합니다.
마이그레이션 과정은 총 3단계로 나누어 집니다.
1. 데이터 동기화
2. 인덱스 생성
3. oplog 동기화

![](https://mc.qcloudimg.com/static/img/4e72afb7a91729bbcc47e9424bc6ff65/8.png)

#### 동기화 끊기
oplog에서 로그를 읽어 새로운 인스턴스를 쓸 때 태스크 완료를 클릭합니다. 그러면 데이터 동기화 작업을 완료하게 됩니다. 태스크가 완료되면 oplog의 동기화 작업을 종료하고 태스크를 성공으로 표시합니다(동기화를 끊기 전에, 대상 인스턴스에서 데이터를 검증할 수 있으며 검증에 문제가 없으면 동기화를 끊으면 됩니다). 
마이그레이션 과정에서 중단하고 싶을 경우, 태스크 중지를 클릭합니다. 태스크를 중지하면 이미 동기화된 작업을 모두 롤백하고 태스크를 실패로 표시합니다.

![](https://mc.qcloudimg.com/static/img/d4f8a746fb7be7c172088ce808d13fc1/9.png)

![](https://mc.qcloudimg.com/static/img/e56d0392b9e0fc287eec5ee1e8fcfd12/10.png)
