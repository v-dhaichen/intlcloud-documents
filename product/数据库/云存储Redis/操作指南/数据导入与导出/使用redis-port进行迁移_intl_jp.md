
## ツール紹介
[redis-port（linux64ビット）](https://main.qcloudimg.com/raw/a9650acb70f6f971aee9820def84c073/redis-port.tgz)

Redis-port は、オープンソースツールの集合体です。主に Redis ノード間のデータの同期やデータインポート、データエクスポートに使用し、Redis のクロスバージョンのデータ移行に対応しています。ツールの集合体には以下のツールが含まれます。
- redis-sync：Redis インスタンス間でのデータ移行を可能にします。
- redis-resotre：Redis のバックアップファイル（RDB）を指定した Redis インスタンスにインポートします。
- redis-dump：Redis のデータを RDB 形式のファイルとしてバックアップします。
- redis-decode：Redis バックアップファイル（RDB）を読み取り可能なファイルとして解析します。

## 互換バージョン
- ソース Redis バージョン2.8、3.0、3.2、4.0 に対応しています。
- 対応するターゲットインスタンスは、Redis バージョン 2.8、3.0、3.2、4.0、および Redis スタンドアロン版（コミュニティ）、マスタースレーブ版（コミュニティ）、クラウド版（コミュニティ）、マスタースレーブ版（CKV）、クラスタ版（CKV）を含むデータベースの全バージョンです。


## redis-sync を使用したオンライン移行
**Redis-sync ツールの移行原理**
- ツールは大きく2つのモジュールに分けられます。それぞれ、ノードを複製してソースインスタンスからデータを同期し、さらに複製したデータを書き込みコマンドに変換してターゲットインスタンスを更新する役割を果たします。
- データのコピーは2つのフェーズに分けられます。完全同期フェーズと増量同期フェーズです。

**パラメータ説明**：
- -n：同時に書き込むタスク数は設定しないか、CPU のコア数 * 2とすることをお勧めします。
- -m：ソースインスタンスアドレスです。形式は、 "password@ip:port"。
- -m：ターゲットインスタンスアドレスです。形式は、 "password@ip:port"。
- --tmpfile=FILE：テンポラリファイル名。
- --tmpfile-size=SIZW：テンポラリファイルの最大長さ。
- --help：ヘルプコマンドの表示。

**サンプル**：
```
./redis-sync -m 127.0.0.1:6379 -t 192.17.1.1:6379
```

**出力ログ**：

```
[root@VM_5_16_centos bin]# ./redis-sync -m 127.0.0.1:6379 -t xxx2018@10.0.5.8:6379
2019/02/21 09:56:00 sync.go:76: [INFO] sync: master = "127.0.0.1:6379", target = "Passwd2018@10.0.5.8:6379"
2019/02/21 09:56:01 sync.go:103: [INFO] +
2019/02/21 09:56:01 sync.go:109: [INFO] sync: runid = "f63e2ad58e2fcc15c8cc122f15778389a012c1a4", offset = 18576271
2019/02/21 09:56:01 sync.go:110: [INFO] sync: rdb file = 9063349 (8.64mb)
2019/02/21 09:56:01 sync.go:208: [INFO] sync: (r/f,s/f,s) = (read,rdb.forward,rdb.skip/rdb.forward,rdb.skip)
2019/02/21 09:56:02 sync.go:250: [INFO] sync: rdb = 9063349 - [100.00%] (r/f,s/f,s)=(1703936/71754,0/0,0) ~ (1.62mb/-,-/-,-) ~ speed=(1.62mb/71754,0/0,0)
2019/02/21 09:56:03 sync.go:250: [INFO] sync: rdb = 9063349 - [100.00%] (r/f,s/f,s)=(3407872/153850,0/0,0) ~ (3.25mb/-,-/-,-) ~ speed=(1.62mb/82096,0/0,0)
2019/02/21 09:57:54 sync.go:250: [INFO] sync: rdb = 9063349 - [100.00%] (r/f,s/f,s)=(80487526/411969,0/1587212,0) ~  (76.76mb/-,-/-,-) ~ speed=(0/0,0/0,0)
```

**使用説明**：
- ターゲットインスタンスの db データ要件が、ソースインスタンスの db 数より大きくない場合、移行に失敗します。
- 移行中、ネットワークの中断やその他の原因により切断された場合、まずターゲットインスタンスを消去してから移行を再開する必要があります。そうしない場合、ダーティリードが発生することがあります。
- 移行の進捗は、ログに "sync: rdb = 9063349 - [100.00%]" と表示されます。この内容は、全てのデータが完全に同期されていることを表し、"speed=(0/0,0/0,0)" は、増量データが完全に同期されていることを表します。
- 移行を停止する場合、Ctrl+C コマンドを使用するか、その他の方法でツールの実行を終了することでデータの同期が停止します。

## redis-restore を使用したデータインポート
Redis-restore ツールは、Redis のバックアップファイル（RDB）を指定した Redis インスタンスにインポートできるようにします。また、 AOF ファイルのインポートや、Redis のバージョン2.8、3.0、3.2、4.0 の RDB ファイル形式にも対応しています。

**パラメータ説明**：
- -n：同時に書き込むタスク数は設定しないか、CPU のコア数 * 2とすることをお勧めします。
- -i：RDB ファイルパス。
- -m：ターゲットインスタンスアドレスです。形式は、 "password@ip:port"。
- -i：AOF ファイルパス。
- --db=DB：インポートする DB ID。デフォルトではソースインスタンスと同じです。
- --unixtime-in-milliseconds=EXPR：データをインポートすると同時に、Key 有効期限切れの時間値を更新します。
- --help：ヘルプコマンドの表示。

**サンプル**：
```
./redis-restore dump.rdb -t 127.0.0.1:6379
```


## redis-dump を使用したデータバックアップ
redis-dump は、Redis のデータを RDB ファイルとしてバックアップできます。また、AOF の増量データをバックアップすることもできます。
>?TencentDB for Redis は現在のところ、redis-dump ツールを使用したバックアップに対応していません。Redis データベースコンソール、または API を使用してデータのバックアップとダウンロードを実行することができます。また、redis-dump ツールにより、自己構築した Redis インスタンスをバックアップすることも可能です。

**パラメータ説明**：
- -n：同時に書き込むタスク数は設定しないか、CPU のコア数 * 2とすることをお勧めします。
- -m：Redis インスタンスアドレスです。形式は、 "password@ip:port"。
- -o：バックアップを出力するための RDB ファイルパス。
- -a：バックアップを出力するための AOF ファイルパス。
- --help：ヘルプの表示。

**サンプル**：
```
./redis-dump  127.0.0.1:6379 -o dump.rdb
```



