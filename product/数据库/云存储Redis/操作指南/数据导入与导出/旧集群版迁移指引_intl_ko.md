## 시나리오

TencentDB for Redis 구식 클러스터 버전(2018년 1월 1일 이전에 구매한 클러스터)의 경우, 버전이 상대적으로 낮은 편이고 아키텍처가 오래되기 때문에 일정한 보안 리스크가 존재합니다. 비즈니스의 안전성을 보장하기 위해 최신 Redis 클러스터 버전으로 마이그레이션하시길 권장합니다.
새로운 버전은 더 유연한 사양 구성, 더 높은 성능 및 완전한 기능을 제공합니다. 당사는 2018년 10월 15일부터 2019년 1월 30일까지 Redis 구식 클러스터 버전 인스턴스를 Redis 2.8 마스터/슬레이브 버전 또는 4.0 클러스터 버전까지 업그레이드할 수 있도록 협조할 것입니다. 2.8 마스터/슬레이브 버전 소개는 [Redis 마스터/슬레이브 버전](https://cloud.tencent.com/document/product/239/17950)을 참조하고, 4.0 클러스터 버전은 [Redis 클러스터 버전](https://cloud.tencent.com/document/product/239/18336)을 참조하십시오.
>!Redis 구식 클러스터 버전 인스턴스는 마스터/슬레이브 버전 또는 클러스터 버전으로 핫 마이그레이션할 수 없습니다. 마이그레이션 과정 중 데이터가 유실되는 것을 막기 위해 마이그레이션을 시작할 때부터 Redis 클러스터에 대한 입력 작업을 중단해야 합니다.
보안 그룹을 설정하여 비즈니스 접근을 금지하거나 비밀번호를 변경하여 입력 작업을 차단합니다. 모니터링 페이지에서 QPS가 0까지 감소하는지를 확인할 수 있습니다.

## 전제 조건
- 새로운 마스터/슬레이브 버전 또는 클러스터 버전 인스턴스를 구매하였습니다.
>? 데이터 양이 12GB보다 작고 추후 데이터 증가가 60GB를 초과하지 않으며 QPS가 4만 아하로 유지하는 경우, Redis 2.8 마스터/슬레이브 버전을 권장합니다. 아니면 Redis 4.0 클러스터 버전을 권장합니다. Redis 4.0 클러스터 버전은 **트랜잭션 명령을 지원하지 않습니다**(. 지원이 필요할 경우, 2.8 마스터/슬레이브 버전을 선택하십시오). 기타 명령은 Redis 구식 클러스터 버전과 완전히 호환합니다.
Redis 2.8 마스터/슬레이브 버전의 출판 가격은 76CNY/GB/월이며 Redis 4.0 클러스터 버전의 출판 가격은 84CNY/GB/월입니다. 실제 상황에 따라 선택할 수 있습니다.
- 데이터 가져오기용으로 CVM 1대를 준비하였고 CVM은 기존 인스턴스 데이터를 저장할 수 있도록 충분한 디스크 공간을 가져야 합니다.
- 데이터 가져오기 도구 crs-port를 이미 설치하였고 도구 사용 설명과 다운로드 주소는 [도구 주소](https://cloud.tencent.com/document/product/239/33786)를 참조하십시오.

## 작업 절차
1. Redis 구식 클러스터 버전 인스턴스에 대한 입력 작업을 중단합니다.
2. Redis 구식 클러스터 버전 인스턴스의 백업 데이터를 생성하고, 인스턴스 백업이 완료될 때까지 기다리십시오. 백업 시간은 데이터 양에 따라 결정합니다. 백업 완료 후 RDB 파일 1개를 생성합니다.
![](https://main.qcloudimg.com/raw/c48d183c272730a8fa3240cfb77114c9.png)
3. 데이터 백업을 완료하면 백업 리스트에서 이전 백업된 파일을 볼 수 있습니다. [내보내기]를 클릭하여 RDB 파일을 생성하고, RDB 파일이 생성되면 해당하는 다운로드 링크를 생성합니다. 다운로드 링크를 클릭하여 사설망 주소를 복사하고 사설망 CVM에서 백업 파일을 다운로드합니다. **가용 영역 간 다운로드는 지원하지 않습니다**.
4. 새로 구매한 Redis 2.8 마스터/슬레이브 버전 또는 4.0 클러스터 버전의 비밀번호를 초기화합니다. **새로운 인스턴스의 비밀번호는 더는 “인스턴스 ID: 인스턴스 비밀번호”의 형식을 지원하지 않고, 클라이언트 접근은 비밀번호만 지니고 있으면 됩니다**. crs-port 도구로 다운로드한 RDB 파일을 새로운 인스턴스에 가져옵니다.
```
crs-port restore -n 16 -i /data/dump.rdb -t 192.168.0.1:6379 -A passwd
```
5. 데이터를 가져온 후, 콘솔을 통해 데이터 가져오기 성공 여부를 확인합니다. 인스턴스 세부 정보 페이지의 구성 정보에서 실제 메모리 사용량을 조회할 수 있습니다.
6. 응용프로그램을 새로운 인스턴스에 마이그레이션합니다. **코드 중 구식 클러스터 버전의 IP를 새로운 인스턴스의 IP로 업데이트하면 됩니다**.

