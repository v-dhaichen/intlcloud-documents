
## 도구 소개
[redis-port(Linux 64자리)](https://main.qcloudimg.com/raw/a9650acb70f6f971aee9820def84c073/redis-port.tgz)

Redis-port는 오픈 소스 도구 집합으로 주로 Redis 노드 간 데이터베이스 동기화, 데이터 가져오기, 데이터 내보내기에 사용되며 Redis의 버전 간 데이터 마이그레이션을 지원합니다. 도구 집합은 다음 도구를 포함합니다.
- redis-sync: Redis 인스턴스 간 데이터 마이그레이션을 지원합니다.
- redis-resotre: Redis의 백업 파일(RDB)을 지정한 Redis 인스턴스에 가져오기를 지원합니다.
- redis-dump: Redis의 데이터를 RDB 형식 파일로 백업을 지원합니다.
- redis-decode: Redis 백업 파일(RDB)을 읽기 가능 파일로 해석을 지원합니다.

## 호환 버전
- 오리진 Redis 2.8, 3.0, 3.2, 4.0 버전을 지원합니다.
- 대상 인스턴스가 Redis 2.8, 3.0, 3.2, 4.0인 버전 및 클라우드 데이터베이스의 모든 버전을 지원합니다. Redis 스탠드 얼로운(커뮤니티), 마스터/슬레이브 버전(커뮤니티), 클러스터 버전(커뮤니티), 마스터/슬레이브 버전(CKV), 클러스터 버전(CKV)을 포함합니다.


## redis-sync로 온라인 마이그레이션
**redis-sync 도구 마이그레이션 원리**
- 도구는 두 개의 모듈로 나뉘며, 하나는 복사 노드로 시뮬레이션하여 오리진 인스턴스에서 데이터를 동기화합니다. 또 하나는 복사한 데이터를 명령으로 번역하여 대상 인스턴스에 업데이트합니다.
- 복사 데이터는 전체 동기화 단계와 증분 동기화 단계로 나뉩니다.

**매개변수 설명**:
- -n: 동시 발생이 입력한 태스크 수량으로 설정하지 않거나 CPU 핵심 수량 * 2로 설정하길 권장합니다.
- -m: 오리진 인스턴스 주소로 형식은 "password@ip:port"입니다.
- -t: 대상 인스턴스 주소로 형식은 "password@ip:port"입니다.
- --tmpfile=FILE: 임시 파일 이름입니다.
- --tmpfile-size=SIZW: 임시 파일 최대 길이입니다.
- --help: 도움말 보기 명령입니다.

**예시**:
```
./redis-sync -m 127.0.0.1:6379 -t 192.17.1.1:6379
```

**출력 로그**:

```
[root@VM_5_16_centos bin]# ./redis-sync -m 127.0.0.1:6379 -t xxx2018@10.0.5.8:6379
2019/02/21 09:56:00 sync.go:76: [INFO] sync: master = "127.0.0.1:6379", target = "Passwd2018@10.0.5.8:6379"
2019/02/21 09:56:01 sync.go:103: [INFO] +
2019/02/21 09:56:01 sync.go:109: [INFO] sync: runid = "f63e2ad58e2fcc15c8cc122f15778389a012c1a4", offset = 18576271
2019/02/21 09:56:01 sync.go:110: [INFO] sync: rdb file = 9063349 (8.64mb)
2019/02/21 09:56:01 sync.go:208: [INFO] sync: (r/f,s/f,s) = (read,rdb.forward,rdb.skip/rdb.forward,rdb.skip)
2019/02/21 09:56:02 sync.go:250: [INFO] sync: rdb = 9063349 - [100.00%] (r/f,s/f,s)=(1703936/71754,0/0,0) ~ (1.62mb/-,-/-,-) ~ speed=(1.62mb/71754,0/0,0)
2019/02/21 09:56:03 sync.go:250: [INFO] sync: rdb = 9063349 - [100.00%] (r/f,s/f,s)=(3407872/153850,0/0,0) ~ (3.25mb/-,-/-,-) ~ speed=(1.62mb/82096,0/0,0)
2019/02/21 09:57:54 sync.go:250: [INFO] sync: rdb = 9063349 - [100.00%] (r/f,s/f,s)=(80487526/411969,0/1587212,0) ~  (76.76mb/-,-/-,-) ~ speed=(0/0,0/0,0)
```

**사용 설명**:
- 대상 인스턴스의 데이터베이스의 데이터가 오리진 인스턴스의 데이터베이스 수량보다 커야 합니다. 그렇지 않으면 마이그레이션에 실패합니다.
- 마이그레이션 중 네트워크 중단 또는 기타 원인으로 끊긴 경우, 우선 대상 인스턴스를 비운 뒤 다시 마이그레이션합니다. 그렇지 않으면 불필요한 데이터가 나타날 수 있습니다.
- 마이그레이션 진도로 로그는 "sync: rdb = 9063349 - [100.00%]"를 표시합니다. 이 내용은 전체 데이터가 이미 동기화되고 현재 증분 데이터 동기화가 진행 중임을 의미하며, "speed=(0/0,0/0,0)"은 증분 데이터 동기화가 완료되었음을 의미합니다.
- 마이그레이션을 중단합니다. Ctrl+C 명령 또는 기타 방식을 통해 도구 실행을 중단하면 데이터 동기화를 중단할 수 있습니다.

## redis-restore로 데이터 가져오기
redis-restore 도구는 Redis의 백업 파일(RDB)을 지정한 Redis 인스턴스에 가져오기를 지원하며, AOF 파일 가져오기도 지원합니다. Redis 2.8, 3.0, 3.2, 4.0 버전의 RDB 파일 형식도 지원합니다.

**매개변수 설명**:
- -n: 동시 발생이 입력한 태스크 수량으로 설정하지 않거나 CPU 핵심 수량 * 2로 설정하길 권장합니다.
- -i: RDB 파일 경로입니다.
- -t: 대상 인스턴스 주소로 형식은 "password@ip:port"입니다.
- -a: AOF 파일 경로입니다.
- --db=DB: 가져온 데이터베이스 ID이고, 기본적으로 오리진 인스턴스와 일치합니다.
- --unixtime-in-milliseconds=EXPR: 데이터를 가져오는 동시에 Key 만료 시간을 업데이트합니다.
- --help: 도움말 보기 명령입니다.

**예시**:
```
./redis-restore dump.rdb -t 127.0.0.1:6379
```


## redis-dump로 데이터 백업
Redis-dump는 Redis의 데이터를 RDB 파일로 백업을 지원하며, 동시에 AOF 증분 데이터 백업도 지원합니다.
>?TencentDB for Redis는 현재 redis-dump 도구로 백업을 지원하지 않습니다. Redis 콘솔 또는 API를 통해 데이터 백업과 다운로드할 수 있습니다. 또는 redis-dump 도구로 자체 생성한 Redis 인스턴스를 백업할 수 있습니다.

**매개변수 설명**:
- -n: 동시 발생이 입력한 태스크 수량으로 설정하지 않거나 CPU 핵심 수량 * 2로 설정하길 권장합니다.
- -m: Redis 인스턴스 주소로 형식은 "password@ip:port"입니다.
- -o: 백업 출력한 RDB 파일 경로입니다.
- -a: 백업 출력한 AOF 파일 경로입니다.
- --help: 도움말 보기.

**예시**:
```
./redis-dump  127.0.0.1:6379 -o dump.rdb
```




