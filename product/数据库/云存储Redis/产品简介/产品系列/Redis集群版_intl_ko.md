Redis 클러스터 버전(커뮤니티)은 Tencent Cloud가 커뮤니티 버전 Redis 4.0에 기반하여 만든 최신 버전으로 분산형 구조를 채택하였으며 수직과 수평 용량 확장/줄임을 선보입니다. 고도의 유연성과 가용성, 천만급에 달하는 QPS 고성능을 보유하고 있습니다. Redis 클러스터 버전은 수평 방향 3 - 128 샤딩 확장, 수직 방향 1개 - 5개 복제본 세트 확장, 용량 확장, 용량 줄임을 지원하며, 마이그레이션 과정 비즈니스는 거의 인식하지 않아 최대 시스템 가용성을 구현할 수 있습니다.![](https://main.qcloudimg.com/raw/28b67a0b4de50e751fd2119876019ffd.svg)

## 클러스터 사양
- 샤딩 사양(GB): 4, 8, 12, 16, 20, 24, 28, 32
- 샤딩 수량: 3, 5, 8, 12, 16, 24, 32, 64, 96, 128
- 복제본 수량: 1, 2, 3, 4, 5

## 클러스터 모드
- Redis 클러스터 모드는 데이터에 대해 자동으로 샤딩하여 시스템은 데이터 밸러싱, 데이터 마이그레이션 기능을 제공합니다.
- 클러스터 모드가 지원하는 샤딩 사양은 4GB - 32GB입니다.
- 비클러스터 모드와 비교할 때 클러스터 모드의 명령은 상대적으로 일정한 호환성을 지니며, 주로 Slot 간 데이터 접근으로 구현합니다. 자세한 설명은 [사용 제한](https://cloud.tencent.com/document/product/239/18336?!preview&!editLang=zh#.E4.BD.BF.E7.94.A8.E9.99.90.E5.88.B6)을 참조하십시오.

## 복제본 설명
- 복제본 수가 1인 경우, Redis는 데이터 마스터/슬레이브 실시간 핫 백업을 지원하여 고가용성 및 고 신뢰성을 제공합니다. HA 시스템이 노드 고장을 모니터링하면 요청이 슬레이브 노드로 전환되고 슬레이브 노드 하나를 시스템에 새로 추가하게 됩니다.
- 복제본 수가 1보다 클 경우, Redis는 데이터 마스터/슬레이브 실시간 핫 백업을 제공하고 슬레이브 노드 읽기 전용 기능을 제공합니다.

## 기능 특성
**유연성**
Redis 클러스터 버전은 3 ~ 128개 노드에 수평적 용량 확장/줄입을 지원하고 수직적 1 ~ 5개 복제본 세트에 용량 확장/줄임을 지원합니다. 인스턴스를 조정하여 다양한 시나리오를 지원합니다.
**가용성**
Redis 클러스터 버전의 수평 방향(샤딩 수량)과 수직 방향(복제본 수량)의 용량 확장/줄임은 비즈니스에 완전히 인식하지 않아 고도의 시스템 가용성을 구현합니다.
 **호환성**
Redis 클러스터 버전은 시나리오에서 커뮤니티 버전 원본 Cluster의 시나리오를 지원하며, Jedis 등 스마트 클라이언트 시나리오와 Codis 시나리오와 호환합니다.
 **OPS 가능**
Redis 클러스터 버전은 시스템의 능력을 최대적으로 개방하고 샤딩 수준의 모니터링과 관리, 샤딩 데이터 마이그레이션과 밸러싱, 빅 Key 모니터링, 핫 Key 모니터링 등 고급 기능을 제공하여 시스템을 완전하게 관리 및 운영 관리할 수 있습니다.

## 적용 시나리오
**마스터/슬레이브 고가용성 시나리오**
단일 노드를 선택하고 노드에 1개의 복제본 세트를 선택하여 마스터/슬레이브 고가용성에 도달하고 이중 기계 핫 스탠바이와 고장 시 자동 전환 기능을 제공함으로써 Redis 서비스의 높은 신뢰성과 높은 가용성을 보장합니다.
 **읽기/쓰기 분리 시나리오**  
노드 복제본 수가 1보다 클 경우, TencentDB for Redis는 읽기/쓰기 분리 기능을 자동 제공하며, 수직 방향에서 단일 노드 가독성 향상을 제공합니다. 최대 5개의 복제본 세트를 지원하며 마스터 노드 및 각 복제본 노드의 읽기 접근 가중치 구성을 지원합니다.
**샤딩 고성능 시나리오**
Redis 클러스터 버전은 샤딩 모드를 자동으로 시작하고 다양한 Key를 여러 개의 노드에 할당하여 시스템 성능 수평 확장의 목적을 확보합니다.

## 사용 제한
클러스터 버전의 경우 데이터는 자동 Hash 샤딩을 지원하며 클러스터 모드는 현재 4GB보다 작은 사양을 제공하지 않습니다.
클러스터 모드에서 Redis가 명령 세트에 지원하는 상황은 **지원**, **한정적 지원**, **사용자 지정 명령**, **지원하지 않음**으로 나뉘며, 지원하지 않는 명령의 경우 시스템은 다음 오류를 반환합니다.
```
 select 1
 (error) ERR unknown command 'select'
```

**지원하지 않는 명령:**
클러스터 버전은 멀티 DB를 지원하지 않고 `select 0` 명령을 지원합니다. 멀티 DB는 성능에 부정적인 영향을 끼칠 수 있으니 전용 데이터베이스의 사용을 권장합니다. 다음 명령이 차단되어 실행 시 오류가 발생할 수 있습니다.
-  MOVE
-  SWAPDB

데이터 지속성과 백업은 콘솔을 통해 관리할 수 있어 다음 관련 명령은 지원하지 않습니다.
- BGREWRITEAOF
- BGSAVE
- LASTSAVE

시스템 복사와 고가용성은 TencentDB for Redis 백 엔드가 일괄적으로 관리하며, 그에 대한 작업은 안전족인 리스크를 가져올 수 있기 때문에 다음 명령을 지원하지 않습니다.
- REPLCONF
- SLAVEOF
- SYNC / PSYNC

클러스터 버전은 현재 트랜잭션 관련 명령을 지원하지 않으며 관련 명령은 다음을 포함합니다.
- MULTI
- EXEC
- DISCARD
- UNWATCH

기타 지원하지 않는 명령:
- DEBUG
- PFDEBUG
- OBJECT
- SHUTDOWN
- MONITOR
- COMMAND
- SCRIPT-DEBUG
- LATENCY
- READONLy
- TIME
- WAIT
- MODULE
- DBSIZE

**제한적으로 지원하는 명령:**
Jedis cluster 시나리오와 호환하기 위해 TencentDB for Redis는 Cluster가 지원하는 명령이 반환하는 IP 리스트를 수정하며 반환 정보 중 모든 노드의 IP 주소는 인스턴스의 VIP입니다.
- CLUSTER NODES
- CLUSTER SLOTS
- CONFIG GET

Slot 간 명령 지원
클러스터 버전은 현재 지원하는 Slot 간 접근 명령은 다음을 포함합니다.
- MGET
- MSET

현재 Slot 간 실행하는 명령을 지원하지 않으며, 시스템은 다음 오류를 반환하게 됩니다.
 `(error) CROSSSLOT Keys in request don't hash to the same slot`

지원하지 않는 Slot 간 접근 명령은 다음과 같습니다.
- DEL
- UNLINK
- EXISTS
- BRPOP
- BLPOP
- SINTER
- STNTERSTORE
- SUNION
- SDIFF
- SDIFFSTORE
- MSETNX
- PFCOUNT
- PFMERGE

**사용자 지정 명령:**
Redis 클러스터 버전은 VIP 캡슐화를 통해 클러스터 모드에 스탠드 얼로운 사용 체험을 크게 향상시킵니다. 하지만, OPS 프로세스의 투명도가 부족해서 사용자 지정 명령을 통해 보완할 수 있습니다. 클러스터 중 모든 노드의 접근을 지원하며, 기존 명령의 매개변수 리스트에 가장 오른쪽에 매개변수 [노드 ID], COMMAND arg1 arg2 ... [노드 ID]를 새로 추가하면 됩니다. 노드 ID는 `cluster nodes` 명령을 통하거나 콘솔에서 획득할 수 있습니다.
  ```
	10.1.1.1:2000> cluster nodes
	25b21f1836026bd49c52b2d10e09fbf8c6aa1fdc 10.0.0.15:6379@11896 slave 36034e645951464098f40d339386e9d51a9d7e77 0 1531471918205 1 connected
	da6041781b5d7fe21404811d430cdffea2bf84de 10.0.0.15:6379@11170 master - 0 1531471916000 2 connected 10923-16383
	36034e645951464098f40d339386e9d51a9d7e77 10.0.0.15:6379@11541 myself,master - 0 1531471915000 1 connected 0-5460
	53f552fd8e43112ae68b10dada69d3af77c33649 10.0.0.15:6379@11681 slave da6041781b5d7fe21404811d430cdffea2bf84de 0 1531471917204 3 connected
	18090a0e57cf359f9f8c8c516aa62a811c0f0f0a 10.0.0.15:6379@11428 slave ef3cf5e20e1a7cf5f9cc259ed488c82c4aa17171 0 1531471917000 2 connected
	ef3cf5e20e1a7cf5f9cc259ed488c82c4aa17171 10.0.0.15:6379@11324 master - 0 1531471916204 0 connected 5461-10922

	원본 명령:
	info server
	사용자 지정 명령:
	info server ef3cf5e20e1a7cf5f9cc259ed488c82c4aa17171

	SCAN 명령 예시:
	scan 0 238b45926a528c85f40ae89d6779c802eaa394a2
	scan 0 match a* 238b45926a528c85f40ae89d6779c802eaa394a2

	KEYS 명령 예시:
	keys a* 238b45926a528c85f40ae89d6779c802eaa394a2
  ```

 사용자 지정 명령 리스트:
- INFO	 
- MEMORY
- SLOWLOG
- KEYS(hashtag 지원, hashtag 우선 매칭)
- SCAN(hashtag 지원, hashtag 우선 매칭)

**지원하는 명령:**
  Redis 클러스터 버전은 상기 명령을 제외한 명령을 모두 지원합니다.
