この方案はクラスタ配置のWebサイト/APPに適します。

あなたの業務が以下の条件を満たす場合、わずか5分でこの方案を構成すれば、30%のコストを節約できます。

- Webサイトがクラスタ方式を採用し、クラスタが1台以上のサーバーを超えます。
- Webサイトのアイドル時間が長いです。Tencent Cloudの統計によると、90%のクラスタが早朝00：00～09：00の9時間の負荷が30%以下です。

ほとんどのWebサイトのピーク時間は8時間以内で、残りの16時間はアイドル状態のサーバーを完全に縮小することができるため、多くのコストを節約できます。

本文はレジャーWebサイトの例を挙げます。このWebサイトのアクセスピーク時間帯は20：00～24：00です。

## 方案概要

- オフピーク時間帯の負荷配置のための固定リソースは、年額/月額CVMを使用できます。
- ピーク時間帯の不足部分は従量制課金のCVMを採用します。時限タスクで20：00に1台拡張し、24：00に圧縮します。

新旧方案の比較：
![](https://mc.qcloudimg.com/static/img/cd4f9a05923871165c6e7184b984336e/image.png)

## 収益
旧方案の4コア4GBのCVM 2台を、4コア4GBのCVM 1台 + 每日4時間の一時CVMに変更すると、約30%の費用を節約します。

次の小Webサイトは每年1500CNYを節約できます：

![](https://mc.qcloudimg.com/static/img/a72443a68d6f16e0a8a37d39f3b73aa7/image.jpg)

## 具体的な操作

インスタンスのWebサイトの構造は比較的単純で、アプリケーションサーバーのクラスタは1つだけです。複雑なWebサイトは、アプリケーションサーバークラスタ、フロントエンドサーバークラスタ、キャッシュサーバークラスタなどがあります。各クラスタは同様の操作を実行でき、各クラスタは1つのスケーリンググループに対応します。

![](https://mc.qcloudimg.com/static/img/ba977d67b59a73d6a137323b61d17ec4/image.png)

### step 1. クラスタCVMのカスタムイメージの作成

このステップは簡単で、既存の1台のクラスタCVMに基づいて作成すればよい。ご不明な点について[カスタムイメージの作成 >>](https://cloud.tencent.com/document/product/213/4942)を参照してください

>注：
>イメージ内のアプリケーションが操作システムと一緒に起動できるように、イメージ内の環境を事前に配置する必要があります。このように拡張されたCVMは手動の介入なしに直接動作することができます。

### step 2. 起動構成の作成

拡張時にASは起動構成をテンプレートとしてCVMを作成するため、事前に起動構成により地域、モデル、イメージを指定します。

1. [AS](https://console.cloud.tencent.com/autoscaling/config)にログインし、ナビゲーションバーの【起動構成】をクリックします。

2. プロジェクトと地域を選択します。ここで、Webアプリケーションが所在するプロジェクトと地域を選択することに注意してください。
![](https://mc.qcloudimg.com/static/img/653ebf516d940a90fd79728e5d319cdc/image.png)

3. 次の操作はCVM購入と同様です。ガイドラインに従って起動構成の作成を完了します。カスタムイメージでさっき作成したイメージを指定してください。
![](https://mc.qcloudimg.com/static/img/4cecf25e8ad9caa67271159c67d0b770/image.png)


### step 3. CVMにスケーリンググループを作成します

[ASコンソール](https://console.cloud.tencent.com/autoscaling)で【新規作成】をクリックし、以下のようにクラスタの管理情報を入力します。

- **名前**：必要に応じて名前を付けます。例えば、ここで「アプリケーションサーバークラスタ」を入力します
- **最小スケーリング数**：クラスタサーバー数の下限。例えば、0を入力してください。
- **開始インスタンス数**：スケーリンググループの作成時に**自動的に作成された**CVM数。一般的には、スケーリンググループを作成した直後にCVMが自動的に作成されることはありません。ここに0を記入することをお勧めします。
- **最大スケーリング数**：クラスタサーバー数の上限。ここに必要に応じて記入します。ここの5は、スケーリンググループには最大5台のCVMがあります。
- **起動構成**：さっき作成した起動構成を選択します。
- **サポートネットワーク**：セッションサーバーのネットワーク環境。通常、「基本ネットワーク」を選択します。
- **サポートAvailability Zone**：拡張されたサーバーが属するAvailability Zoneを選択し、セッションサーバーが所在するAvailability Zoneに応じて選択します。
- **除去ポリシー**：デフォルトを選択します。
- **CLB**：クラスタのCLBを選択します。
![](https://mc.qcloudimg.com/static/img/88d97cc3150b98741d52c4abd4b801df/image.jpg)

最後【OK】をクリックし、作成を完了します。

### step 4. 既存のCVMをスケーリンググループに追加します

1. [コンソール](https://console.cloud.tencent.com/autoscaling)でスケーリンググループの名前をクリックして、管理画面に入り、ページの下方に【CVM追加】をクリックします。
![](https://mc.qcloudimg.com/static/img/d940c118ffa3e443543ffbc5a7b71daf/image.jpg)

2. ポップアップウィンドウで、クラスタ内の既存のサーバーを選択してスケーリンググループに追加します。オフピーク時には、コストを節約するためにクラスタ内の充分に利用されないサーバーを返却できます。
![](https://mc.qcloudimg.com/static/img/8a3ba69a5ffc9e9004e91c8a300149c2/image.jpg)

3. 追加した後、サーバーを「圧縮適用外」に設定します。それで圧縮アクティビティでは、スケーリンググループは該CVMを圧縮対象として選択しません。故にクラスタのCVMは常にサービスを提供し、ASによって変更されることはありません。
![](https://mc.qcloudimg.com/static/img/de9840c7507a725d836f02ca77fd0490/image.jpg)

### step 5. 拡張圧縮ポリシーを設定します（重点！）

ASが時限拡張またはアラームに基づく動的拡張、拡張と圧縮通知の受信、拡張と圧縮の履歴詳細表示をサポートします。すべてはコントロールできるようにしております。
![](https://mc.qcloudimg.com/static/img/b783799ed9140767ec456ed91ed985cb/image.jpg)

-  **まずは20：00の時限拡張タスクを設定します**
![](https://mc.qcloudimg.com/static/img/e3c790c1fa7594643bcfb591e5ca949b/image.jpg)
> 注：
> Tencent Cloud CVMの作成には約1分かかります。カスタムイメージが大きい場合は、さらに時間がかかる可能性があります。5分早く実行を開始することができる。

- **次は24：00の時限圧縮タスクを設定します**
![](https://mc.qcloudimg.com/static/img/e0fce491429b83cc77fa244db5382778/image.jpg)

以上、完了します！

Webサイトのバックグラウンドクラスタを「1台固定アプリケーションサーバー+1台ピーク時限作成したアプリケーションサーバー」に変更します。
スケーリンググループ未追加のその他のクラスタCVMは、大半の時間に十分に利用されないので、節約コストのために返却できます。

