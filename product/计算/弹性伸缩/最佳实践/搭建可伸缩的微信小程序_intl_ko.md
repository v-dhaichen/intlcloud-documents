
## 아키텍처 배포
다음 아키텍처로 WeChat Mini Program을 생성할 수 있습니다. 그 중에 비즈니스 서버 클러스터와 세션 관리 서버 클러스터는 AS 기능을 갖춰야 합니다.
![](https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/solution/css/img/wx/fw-pic.png)

## 왜 AS를 구성하나요?

다음 두 시나리오에서 AS는 비용을 낮추고 비즈니스 연속성을 향상시킵니다.

1. WeChat Mini Program 방문은 주기적 변화가 뚜렷하다. 추산에 따르면, 비즈니스 서버 클러스터와 세션 서버 클러스터는 1대 이상의 CVM이 필요하고 피크 시간은 8시간보다 짧고 **오프 피크 시 고정 서버 유지 + 피크 시 임시 서버 추가**의 방식으로 약 30%의 비용을 낮출 수 있다. AS로 Tencent Cloud가 피크 시 임시 서버를 확장하고 오프 피크 시 충분히 이용하지 않은 서버를 종지·회수할 수 있도록 시간 제한 용량 확장/줄임 태스크를 설정할 수 있습니다.

2. WeChat Mini Program 접속 양이 안정적인 경우 모니터링 알람을 기반으로 한 AS 전략을 구성하면 돌발적인 고부하에 대비하고 지속 가능한 서비스를 제공하여 더 쉽게 문제를 해결할 수 있습니다. 이상 고부하는 [CC공격](http://baike.baidu.com/link?url=aSNcL5Q_xzDxPvFYRU3qbS11NIQXD5vwvI5yxtJTVlL0xhjAaLntwmDHVW8buUlH4bbNJqMzCPp8b1N2LX-OnwAUR3MnE9GhH-F7fomUac3) 및 예외 트래픽(예를 들면, "myotee" 출시 시 예상보다 훨씬 더 빠른 전파 속도 또는 특정 사건으로 인해 순식간에 대량의 접속 트래픽)을 포함합니다. 공익 사이트 [Baobeihuijia](https://cloud.tencent.com/community/article/651089001483090830)를 사례로 참조하십시오.

>주의: AS 기능은 무료로 제공되고 추가된 CVM은 초당 요금이 청구됩니다.

## AS는 어떤 기능이 있나요?

AS는 다음과 같은 기능을 실현합니다.
1. 정기적으로 클러스터에 CVM을 추가하거나 감소합니다.
2. 클러스터 서버의 부하 상황에 따라 CVM을 추가하거나 감소합니다.
3. 추가된 CVM은 자동으로 로드밸런서에 등록되고 전자동 확장을 실현한다.


## 구성 조건
WeChat Mini Program 기능을 구축합니다. [세부 절차](https://console.cloud.tencent.com/la/guide)를 참조하십시오.

## 세션 서버에 AS 전략을 구성합니다.

### 1. 시동 구성 생성 

확장 시 **시동 구성**으로 템플릿에 CVM을 생성합니다. 따라서 사전에 시동 구성을 통해 지역, 모델, 및 이미지를 지정합니다.

1. [AS 콘솔](https://console.cloud.tencent.com/autoscaling/config)에 로그인하여 탐색 모음에서 [시동 구성]을 클릭합니다.

2. 프로젝트와 지역을 선택하고 여기서 WeChat Mini Program이 위치한 프로젝트와 지역을 반드시 선택해야 합니다.
![](https://main.qcloudimg.com/raw/895578616ace66061bc833165f8fb868/dj1.png)

3. 다음 조작은 CVM 구매와 비슷하고 가이드에 따라 시동 구성을 생성합니다.
![](https://main.qcloudimg.com/raw/719e784a1313a12cd2d32acd965cd7b5/dj2.png)

> 주의:
> 이미지의 응용프로그램을 운영 체제와 함께 활성화할 수 있도록 미리 이미지의 환경을 생성해야 합니다. 이 경우 확장된 CVM은 수동으로 개입할 필요없이 직접적으로 작동할 수 있습니다.
![](https://camo.githubusercontent.com/c58d92b133f44b3d70a0936cf4d6f087e7e0d3ee/68747470733a2f2f6d632e71636c6f7564696d672e636f6d2f7374617469632f696d672f33663363343433316137353637656261323565383633356537383865353962612f392e706e67)

### 2. 조정 그룹 생성

AS의 [콘솔](https://console.cloud.tencent.com/autoscaling)에서[생성]을 클릭하여 다음과 같이 클러스터 관리 정보를 입력합니다.

- **이름**: 요구에 따라 이름을 지정합니다. "세션 서버 클러스터"를 입력합니다.
- **최소 조정 수**: 클러스터 서버의 하한입니다. 0을 입력하면 됩니다.
- **초기 인스턴스 수**: 조정 그룹 생성 시 자동 생성한 CVM 수량이고 0을 입력하면 됩니다.
- **최대 조정량**：클러스터 서버 수량의 상한이고 여기서 수요에 따라 기입하십시오.
- **시동 구성**: 방금 생성한 시동 구성을 선택합니다.
- **지원하는 네트워크**: 세션 서버의 네트워크 환경입니다. 일반적으로 “기본 네트워크”를 선택합니다.
- **가용 영역 지원**：어느 가용 영역에 위치하는 걸 선택하는 것이고 여기서 세션 서버가 위치하는 가용 영역을 선택하면 됩니다.
- **제거 전략**: 기본값을 선택합니다.
- **로드밸런싱**: 세션 서버의 부하 균형을 선택합니다.

![](https://main.qcloudimg.com/raw/a9c20b10fccb7ae63e4e23f520258dbf/dj3.png)

마지막으로 [확인]을 클릭하여 구성을 완료합니다.

### 3. 기존 CVM을 조정 그룹에 추가합니다.

1. [콘솔](https://console.cloud.tencent.com/autoscaling)에서 조정 그룹의 이름을 클릭하여 관리 페이지에 들어가 페이지 하단에서 "CVM 추가"를 클릭합니다.
![](https://main.qcloudimg.com/raw/4df8051dbcd76ca41d9d24a20195d541.png)

2. 팝업창에서 기존의 세션 서버를 조정 그룹에 추가합니다.
![](https://main.qcloudimg.com/raw/dd38413e9e66a21ae2a645c36f90e781/dj4.png)

3. 용량 축소 활동에서 조정 그룹이 이 서버를 축소하지 않게 그룹 가입한 후 서버에 "축소 면제"를 설정합니다.
![](https://mc.qcloudimg.com/static/img/62319473a1a05e98d51c64c22ca24424/0308113553.jpg)

### 4. 확장 전략 설정
시간 제한 확장이나 알람을 기반으로 동적 용량 확장을 선택할 수 있습니다(보통 확장 태스크와 용량 축소 태스크는 짝으로 나타납니다.).

![](https://main.qcloudimg.com/raw/7d7fb4305f2fb13c970179dae324840b/dj5.png)

**a. 시간 제한 용량 확장/축소**:

예를 들면, 배달 WeChat Mini Program에 있어서 점심 시간의 부하가 기타 시간보다 높은 것으로 예상됩니다. 이 경우, 매일 11:00 - 13:00 기간에서 두대의 서버를 추가합니다.

- 먼저 시간 제한 확장 태스크를 설정합니다.
![](https://main.qcloudimg.com/raw/4a2f93eef612f0da6d710d640ed05140/dj7.png)

- 그 다음 시간 제한 축소 태스크를 설정합니다.
![](https://main.qcloudimg.com/raw/0fbc7d7a3ec04fd0de2333906fba1652/dj8.png)

**b. 알람을 기반으로 확장**:

예상이 명확하지 않은 확장은 뜻밖의 트래픽/공격에 주의해야 합니다.

- 먼저 알람 확장 전략을 설정하여 뜻밖의 트래픽에 대응합니다.
![](https://main.qcloudimg.com/raw/2e3c81b73325fe76c912b8e021224dd3/dj9.png)

- 그 다음 알람 축소 전략을 설정하여 충분히 이용되지 않은 서버를 지웁니다.
![](https://main.qcloudimg.com/raw/dbbd5ef378e123b3e51dc7ba4f2b0536/dj10.png)


## 비즈니스 서버에 AS 전략을 구성합니다.

이 과정은 세션 서버와 비슷합니다.

- 비즈니스 서버에 시동 구성을 생성합니다.
- 비즈니스 서버의 로드밸런싱을 위하여 비즈니스 서버에 조정 그룹 "비즈니스 서버 클러스터"를 생성합니다.
- 비즈니스 서버에 조정 전략을 구성합니다.

## 조정성 검증 및 조정 활동 보기
[편집]을 클릭하여 조정 그룹의 예상 인스턴스 수에 1을 더하면 조정 그룹은 자동으로 클러스터에 CVM 한대를 추가합니다. 새로 추가된 CVM이 정상적으로 요청을 처리하면 조정 그룹은 정상적으로 작동하는 것입니다.
![](https://main.qcloudimg.com/raw/d77f115c2dd5c57545b03ba188e9f27e/dj11.png)

조정 그룹은 또한 [조정 활동 기록 조회](https://cloud.tencent.com/document/product/377/3804)를 지원하고 조정 활동의 상황을 완전히 파악할 수 있도록 합니다.

이로써 사용자 WeChat Mini Program은 이미 스마트 확장 기능을 갖추게 되었습니다. 더이상 확장/축소 문제에 걱정하실 필요가 없고 조정 그룹의 알림에 주의하거나 부정기적으로 조정 활동 기록을 확인하면 됩니다.

