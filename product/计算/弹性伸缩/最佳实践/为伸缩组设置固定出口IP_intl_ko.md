이 섹션에서는 클러스터에 능동 외부 액세스를 필요하는 경우 외부 액세스에 고정 IP 주소를 설정하는 방법을 소개합니다.

## 필수 조건

조정 그룹의 클러스터에 다음 3가지 요구가 동시에 존재하는 경우:
- CLB로부터 요청을 수신합니다
- 클러스터 CVM에 능동 외부 액세스가 필요합니다.
- 외부 액세스 시 **고정한** 공인 IP를 사용하는 것이 바람직합니다.

다음의 방안에 따라 설정할 수 있습니다.

## 방안 설명
1. CLB를 통해 외부 요청을 수신하고 응답합니다.
2. CVM을 VPC의 서브넷에 포함시키고 라우팅 테이블을 NAT 게이트웨이로 지향하고 모든 능동 외부 액세스 요청은 NAT 게이트웨이의 공개 IP로 전달됩니다.
3. 조정 그룹의 네트워크 속성을 해당 서브넷으로 설정합니다. 추가된 CVM은 모두 NAT 게이트웨이로 능동적으로 외부에 액세스합니다.

다음 그림과 같습니다.

![](https://mc.qcloudimg.com/static/img/9cccdddfe99dbc065c97cad27448ed9f/image.png)



## 설정 방법

### 단계1: VPC와 서브넷 생성

#### **1. VPC 생성**

1. [Tencent Cloud 콘솔](https://console.cloud.tencent.com/)에 로그인하여 탐색 모음의 [VPC]를 클릭하거나 Tencent Cloud [VPC 소개 페이지](https://cloud.tencent.com/product/vpc.html)의 [바로 체험하기] 버튼을 눌러 [VPC 콘솔](https://console.cloud.tencent.com/vpc/)로 진입합니다.

2. 리스트의 상부 드롭다운 상자에서 [생성]을 클릭해 VPC를 생성합니다. 예를 들어 “화북 지역(베이징)”을 선택합니다.

3. VPC, 서브넷 및 CIDR의 이름을 입력하고 서브넷의 가용 영역을 선택합니다.

4. [생성]을 클릭합니다.


#### **2. 서브넷 생성**

1. [Tencent Cloud 콘솔](https://console.cloud.tencent.com/)에 로그인 하여 탐색 모음의 [VPC]를 클릭하고 좌측 탐색 모음의 [서브넷]을 클릭합니다. 드롭다운 상자에서 지역과 VPC를 선택합니다.
![](https://mc.qcloudimg.com/static/img/02c52c44678a56597b4d7053f8f8c467/3.jpg)

2. [생성]을 클릭해 서브넷 이름, CIDR, 가용 영역 및 관련 라우팅 테이블을 입력합니다. [생성]을 클릭하여 확인합니다.

3. 생성 완료 후, 해당 서브넷에서 CVM을 구매할 수 있습니다.


### 단계2: NAT 게이트웨이 생성
#### **1. 구매**
1. [Tencent Cloud 콘솔](https://console.cloud.tencent.com/)에 로그인 하여 [VPC] 탭을 선택하고 [NAT 게이트웨이]를 선택합니다.

2. 좌측 모서리 [생성] 버튼을 클릭하고 팝업된 창에서 순서대로 다음의 매개변수를 입력 또는 확인합니다.
	- 게이트웨이 이름
	- 게이트웨이 유형(게이트웨이 유형 생성 후 수정 가능)
	- NAT 게이트웨이 서비스의 VPC(막 생성한 VPC임)
	- NAT 게이트웨이에 EIP를 할당하고 해당 IP는 사용자 CVM이 외부에 액세스하는 고정 IP입니다.

3. 선택 종료 후 [확인] 버튼을 클릭해 NAT 게이트웨이 생성을 완료할 수 있습니다.

4. NAT 게이트웨이를 생성한 후 VPC 콘솔 라우팅 테이블 페이지에서 라우팅 규칙을 설정해 서브넷 트래픽을 NAT 게이트웨이로 향하도록 설정합니다.

#### **2. 라우팅 테이블 설정(중요)**
1. [Tencent Cloud 콘솔](https://console.cloud.tencent.com/)에 로그인하여 탐색 모음의 [VPC]를 클릭해 [VPC 콘솔](https://console.cloud.tencent.com/vpc/vpc?rid=8)로 진입해 [라우팅 테이블]을 선택합니다.

2. 라우팅 테이블 리스트에서 인터넷을 방문할 서브넷이 관련된 라우팅 테이블 ID를 클릭해 라우팅 테이블 상세 페이지로 진입하고 라우팅 전략에서 [편집] 버튼을 클릭합니다.

3. 새 열 추가를 클릭해 대상(예: “0.0.0.0/0”)을 입력하고 다음 홉 유형은 [NAT게이트웨이]를 선택하고 이미 생성된 NAT 게이트웨이 ID를 선택하여 확인을 클릭합니다.
![](https://mc.qcloudimg.com/static/img/3cd89bc5f80c66fd88c27cfc4e08d785/1.jpg)

이제 공인 IP가 없어도 이 서브넷의 CVM은 NAT 게이트웨이의 고정 IP를 통해 능동적으로 외부에 액세스할 수 있습니다.이 동안이 IP는 외부에서 고정되어 있는 것으로 나타납니다.

공인 IP가 없고 대역폭이 0인 CVM을 구입하더라도 다음과 같이 능동적으로 외부에 액세스할 수 있습니다.
![](https://mc.qcloudimg.com/static/img/17ed153e06272885b56764781d9ab581/49.jpg)
하지만 조정 그룹은 해당 서브넷을 식별해야 하고 CVM이 모두 해당 서브넷에 생성되도록 해야 합니다.

### 단계3: 조정 그룹 설정
이 단계는 새로 확장된 CVM이 확장 그룹에 의해 이 서브넷에 설치될 수 있도록 서브넷 정보를 확장 그룹에 지정하는 데 사용됩니다.
**이 방법으로 확장된 CVM이 NAT 게이트웨이의 고정된 종료 IP 주소를 사용하여 외부 웹사이트에 액세스합니다.**

[AS 콘솔](https://console.cloud.tencent.com/autoscaling/config)에서 생성을 클릭합니다.

- 조정 그룹의 이름, 시동 구성(시동 구성은 미리 설정해야 함), 최대 조정 수, 최소 조정 수, 초시 인스턴스 수 등 정보를 입력합니다.
- “네트워크”와 “서브넷”을 선택해 방금 설정한 VPC와 서브넷 으로 지정합니다**(중요)**.

다음 그림과 같습니다.
![](https://mc.qcloudimg.com/static/img/699ee5bde186a9d4686684346032eba5/16.jpg)

설정이 완료되었습니다.

