このプロジェクトは、Tencent Cloud [AS](https://cloud.tencent.com/product/as)を使用して柔軟なWebアプリケーションサービスの配置を案内します。ASは、最も適切なインスタンス数でビジネスに対応するのに役立ちます。ビジネスニーズが増加すると、自動的にシームレスに適切な量のCVMインスタンスを追加することができます。ビジネスニーズが低下た場合は、不要なCVMインスタンスを自動的に削減し、デバイスの使用率を高め、配置とインスタンスのコストを節約できます。
このプロジェクトは、クラスタ配置するWebサイト/APPに適しています。このプロジェクトのWebサイトの構造は比較的単純で、アプリケーションサーバーのクラスタは1つだけです。複雑なWebサイトは、アプリケーションサーバークラスタ、フロントエンドサーバークラスタ、キャッシュサーバークラスタなどがあります。各クラスタは同様の操作を実行でき、各クラスタは1つのスケーリンググループに対応します。
**適用条件**
- Webサイトがクラスタ方式を採用し、クラスタが1台以上のサーバーを超えます。
- Webサイトのアイドル時間が長いです。ほとんどのWebサイトのピーク時間は8時間以内で、残りの16時間はアイドル状態のサーバーを完全に圧縮することができるため、多くのコストを節約できます。

このプロジェクトはレジャーWebサイトの例を挙げます。このWebサイトのアクセスピーク時間帯は20：00-24：00です。
- オフピーク時間帯の負荷配置のための固定リソースは、年額/月額CVMを使用できます。
- ピーク時間帯に従量制課金のCVMを使用します。時限タスクで20:00に1つのCVMインスタンスを追加し、24：00に減少します。
![](//mc.qcloudimg.com/static/img/cd4f9a05923871165c6e7184b984336e/image.png)

### 一、クラスタカスタムイメージの作成
クラスタ内の既存のCVMに基づいてイメージを作成します。カスタムイメージの作成については、[カスタムイメージの作成](/doc/product/213/4942)を参照してください。
1. [CVMコンソール](https://console.cloud.tencent.com/cvm/index)にログインします。
2. イメージを作成する前にインスタンスをシャットダウンする必要があります。シャットダウンする必要があるインスタンスを選択し、上の【シャットダウン】をクリックします。
3.　イメージを作成する必要があるインスタンスの右側にある【その他】をクリックし、【イメージ作成】をクリックします。
4.　ポップアップウィンドウに**イメージ名**と**イメージの説明**を入力し、【OK】をクリックして作成を提出します。カスタムイメージを作成するにはある程度の時間がかかります。しばらくお待ちください。
5.　作成が成功したら、左側のナビゲーションバーの【イメージ】をクリックしてイメージリストに移動し、詳細情報を確認できます。

> **注意：**
> イメージ内のアプリケーションが操作システムと一緒に起動できるように、イメージ内の環境を事前に配置する必要があります。このように拡張されたCVMは手動の介入なしに直接動作することができます。

### 二、起動構成の作成

拡張時にASは**起動構成**をテンプレートとしてCVMを作成します。そのため、事前に**起動構成**を通して、地域、モデル、およびイメージを指定する必要があります。

1. [AS](https://console.cloud.tencent.com/autoscaling/config)にログインし、ナビゲーションバーの【起動構成】をクリックします。
2. プロジェクトと地域を選択します。ここでは、Webアプリケーションが所在するプロジェクトと地域を選択する必要があります。このプロジェクトは、「デフォルトプロジェクト」と「華南地区（広州）」を選択します。
![](//mc.qcloudimg.com/static/img/653ebf516d940a90fd79728e5d319cdc/image.png)
3. モデルを選択します。モデル選択の詳細については、[推奨モデル選択](https://cloud.tencent.com/act/recommended)を参照してください。このプロジェクトはシリーズ1標準タイプ1個のCPU 1GBメモリを選択します。
![](//mc.qcloudimg.com/static/img/301ed9b779010186705029631853a6ab/image.png)
4. イメージを選択します。【カスタムイメージ】で、さっき作成したのイメージを指定します。このプロジェクトは「test」の例を挙げます。
![](//mc.qcloudimg.com/static/img/192691062ce8fa93f2bbcd0f02af5bc2/image.png)
5. ストレージとネットワークを選択します。
![](//mc.qcloudimg.com/static/img/2ec4987b14f97966851f90849c016167/image.png)
6. 情報を設定します。パスワードとセキュリティグループを設定します。
![](//mc.qcloudimg.com/static/img/ee9caea59c347e581fb82c273407e28d/image.png)

### 三、スケーリンググループの作成
1. [ASコンソール](https://console.cloud.tencent.com/autoscaling)で、【スケーリンググループ】>【新規作成】をクリックしてクラスタの関連管理情報を入力します。正しいことを確認したら、【次へ】をクリックします。
 - **名前**：スケーリンググループの名前。このプロジェクトは「アプリケーションサーバークラスタ」の例を挙げます。
 - **最小スケーリング数**：クラスタサーバー数の下限。このプロジェクトは0を記入してください。
 - **開始インスタンス数**：スケーリンググループの作成時に自動的に作成されたCVMの数。一般的には、スケーリンググループを作成した直後にCVMが自動的に作成されることはありません。ここに0を記入することをお勧めします。
 - **最大スケーリング数**：クラスタサーバー数の上限。ここに必要に応じて記入します。このプロジェクトは例として5を取ります。つまり、スケーリンググループには最大5台のCVMがあります。
 - **起動構成**：さっき作成した起動構成を選択します。
 - **サポートネットワーク**：セッションサーバーのネットワーク環境。このプロジェクトは「基本ネットワーク」を選択します。
 - **サポートAvailability Zone**：即ち、追加されるサーバーが属するAvailability Zoneを選択し、セッションサーバーが所在するAvailability Zoneに応じてチェックを入れます。このプロジェクトは「広州第二区」を選択します。
 - **除去ポリシー**：「最も古いCVMを除去する」と「最新のCVMを除去する」の2つのポリシーを提供します。このプロジェクトは、「最も古いCVMを除去する」を選択します。
![](//mc.qcloudimg.com/static/img/1dfcdab95c12ad0b999a09de98e8508a/image.png)
2.　CLBを選択します。追加されたCVMは関連するCLBに自動的にマウントされ、既存のCLBを使用するか、新しいCLBを作成するかを選択できます。正しいことを確認したら、【完了】をクリックして作成を完了します。
 - **CLB**：クラスタのCLBを選択します。このプロジェクトはCLBを選択しません。
![](//mc.qcloudimg.com/static/img/2771bbfe477d54400fcb72b21014668b/image.png)

### 四、既存のCVMインスタンスをスケーリンググループに追加します

1. [ASコンソール](https://console.cloud.tencent.com/autoscaling)で、スケーリンググループの名前をクリックし、スケーリンググループの管理ページに入り、【CVMを関連付けする】>【CVMの追加】をクリックします。
![](//mc.qcloudimg.com/static/img/9063e98237388d8bfbbb72f267103a42/image.png)

2. ポップアップウィンドウで、クラスタ内の既存のサーバーを選択してスケーリンググループに追加します。オフピーク時には、コストを節約するためにクラスタ内の充分に利用されないサーバーを返却することをお勧めします。
![](https://mc.qcloudimg.com/static/img/8a3ba69a5ffc9e9004e91c8a300149c2/image.jpg)

3. 【除去保護の設定】をクリックして、このCVMの除去保護を設定します。このように、圧縮アクティビティーでは、スケーリンググループは圧縮するためにこのCVMを選択しません。クラスタ内のこのCVMは常にサービス中であり、ASによって変更されることはありません。
![](https://mc.qcloudimg.com/static/img/de9840c7507a725d836f02ca77fd0490/image.jpg)

### 五、拡張と圧縮ポリシーの設定

ASは、時限拡張と圧縮、およびアラームに基づく動的な拡張と圧縮をサポートし、拡張と圧縮の通知受信を設定し、拡張と圧縮の履歴詳細を確認できます。
![](//mc.qcloudimg.com/static/img/9ff9af152c4d99a1955c837f1177f131/image.png)
このプロジェクトは、時限拡張と圧縮の例をあげて説明します。スケーリンググループ管理ページで、【時限タスク】>【+新規作成】をクリックして新しい時限タスクの作成ページがポップアップされます。
![](//mc.qcloudimg.com/static/img/98f7fd2432fd64b88c3090fa0487a2da/image.png)
-  **時限拡張タスクの設定**
![](https://mc.qcloudimg.com/static/img/e3c790c1fa7594643bcfb591e5ca949b/image.jpg)
> **注意：**
> Tencent Cloud CVMの作成には約1分かかります。カスタムイメージが大きい場合は、さらに時間がかかる可能性があります。5分早く実行を開始することをお勧めします。
- **時限圧縮タスクの設定**
![](https://mc.qcloudimg.com/static/img/e0fce491429b83cc77fa244db5382778/image.jpg)
この時点で、Webサイトのバックエンドクラスタは「1台固定アプリケーションサーバー+1台ピーク時に定期的に作成したアプリケーションサーバー」に変更します。

