 DDoS高保護IP製品は、プロキシ転送モードを使用して、インターネットサービスサーバーに対してトラフィックの多いDDoS攻撃保護とトラフィックフィルタリングサービスを提供します。ユーザーは簡単な設定で、サービストラフィックと攻撃トラフィックをDDoS高保護IPに指向することができます。攻撃トラフィックが高保護IPを通過するとき、保護システムは検出とフィルタリングを実行し、フィルタリングサービストラフィックをサービスサーバーにトラフィック転送して、DDoS攻撃シナリオでのサービスの可用性を確保します。
 
本文では、DDoS高保護IPをオンラインで設定する手順について詳しく説明します。設定購入の選択方法の詳細については、[**製品設定説明**](https://cloud.tencent.com/document/product/685/18798) を参照してください。

## フローチャート
![0](https://main.qcloudimg.com/raw/5be39325084f812720e4aabc5d10ea20.png)

## アクセス手順
1. **DDoS高保護IPの購入**
a. ユーザーは [Aegis高保護コンソール](https://console.cloud.tencent.com/gamesec)に移動し、左のディレクトリで【DDoS高保護IP】をクリックして、「高保護IPリスト」下で【購入】をクリックします。

![1](https://main.qcloudimg.com/raw/821cfed2fe7b722cf89213dc38ccefb3.png)
b. サービスのニーズに応じて必要な設定を選択し、設定を確認して【今すぐ支払う】をクリックします。
![2](https://main.qcloudimg.com/raw/29be919c421a757d0d2327e6733c80b7.png)
2. **高保護IP転送ルールグループの追加**
a. 「DDoS高保護IP」下で、【転送ルールグループ】をクリックし、【転送ルールグループを追加】をクリックします。
b. 「新しいルールグループ名」を入力し、「転送モード」と「所属アイテム」 を選択し、【OK】をクリックします。 

![3](https://main.qcloudimg.com/raw/b3c06f610a0cdd8d13f3b2f4141f7444.png)
>**説明：**
>転送ルールグループごとに60個の転送ルールがデフォルトで無料で提供されます。

3. **転送ルールを追加**
a. 転送ルールグループを作成した後、【転送ルールグループID】をクリックして、「転送ルールグループの詳細」ページに移動します。
![4](https://main.qcloudimg.com/raw/981112f073e55c30955f22cbb55d8211.png)
b. 【ルールグループ情報】で、【転送ルールを追加】をクリックして、4層ポート転送に基づくルールを追加できます。サービスプロトコルのニーズに応じて、「プロトコルタイプ」を選択し、「セッション保留」スイッチを設定し、適切な「ポーリングポリシー」を選択し、「転送ポート」番号、「実サーバポート」番号および「実サーバパブリックネットワークIPと重み」を入力し、バッチ追加をサポートする転送ルールを作成し、【OK】をクリックします。

![5](https://main.qcloudimg.com/raw/79ceb163b1c48e317f8675f293335ac7.png)
>**説明：**
各転送ルールは、40個の実サーバパブリックネットワークIPを設定できます。

 **プロトコルタイプ**：選択されるサービスのポートのプロトコルタイプであり、TCPまたはUDPプロトコルをサポートします。
 **セッション保留**：セッション保留を有効にすると、関連する一連のアクセスリクエストが同じサーバーに割り当てられることを保証します。同じ転送ルールで複数の実サーバIPが存在する場合、同じクライアントのリクエストが同じサーバーに処理される必要がある場合、セッション保留を有効にする必要があります。
 **ポーリングポリシー**：同じ転送ルールで複数の実サーバIPが存在する場合、重みによるポーリングまたは最小接続数によるポーリングを選択し、バックエンド実サーバがサービスリクエストを処理する割合を割り当てることができます。重みによるポーリングは、実サーバIPの重みの大きさに応じて割り当てるものであり、最小接続数によるポーリングは、パブリックネットワークIPの最小接続数に応じて割り当てるものです。
  **転送ポート**：高保護IPでサービスを提供する必要があるポート番号です。クライアントまたはユーザーのサービスリクエストは、高保護IPの当該ポートに直接アクセスします。
  **実サーバポート**：転送ポートに対応し、実サーバでサービスを提供するポート番号です。高保護IPは、転送ポートでのユーザーのサービスリクエストを実サーバIPの当該実サーバポートに転送して処理します。
 **実サーバパブリックネットワークIPと重み**：サービスを提供するバックエンド実サーバのIPアドレスです。複数の実サーバパブリックネットワークIPが存在する場合、高保護IPはサービスリクエストを各実サーバIPへポーリングします。設定された重みの大きさは、この実サーバIPによって処理されたサービスリクエストの割合を表します。重みが大きいほど、より多くのサービスリクエストが受信されます。
>**注意：**
>-複数の転送ルールがある場合は、バッチで作成できます。転送ポートと実サーバポートの入力ボックスにそれぞれ複数のポート番号をカンマで区切って入力します。転送ルールは、ポート順に1つずつ作成されます。
>-以下のポート番号は、転送クラスタ用保留ポートであり、転送ポートとして追加することはできません：843、3306、1433、1434、36000、56000、3389。
4. **転送ルールグループの高保護IPへのバインディング**
転送ルールグループを作成したら、「DDoS高保護IP」で、【転送ルールグループ】をクリックし、「操作」列で、【高保護 IPを関連付け】をクリックし、この転送ルールグループを高保護IPにバインドします。

![6](https://main.qcloudimg.com/raw/835f276d156a39a7a0b61d28e2b7c108.png)
「DDoS高保護IP」で「高保護IP」を選択し、「DDoS高保護IPの詳細」のページに移動し、【基礎設定】をクリックし、「転送ルールグループの設定」のアイテムで、【バインド】をクリックし、転送ルールグループを高保護IPにバインドすることもできます。

![7](https://main.qcloudimg.com/raw/592b72c6315131b688bb6d490c1403c0.png)
![8](https://main.qcloudimg.com/raw/46b6302302381d3ab8392d7f6dcb8629.png)
5. **サービスの高保護IPへの指向**
 転送ルールグループを高保護IPにバインドした後、ユーザーは、高保護IPの転送ポートから実サーバの実サーバポートへの接続性を検証できます。サービスを高保護IPに指向するように設定すれば、高保護IPのアクセス設定が完了します。ユーザーサービスの前にドメイン名解決が使用されている場合、ユーザーはサービスドメイン名解決サービスプロバイダーでドメイン名解決を変更し、元のIPアドレスをバインドされた高保護IPアドレスに置き換えることができます。 
設定が完了すると、ユーザの実サーバはすでに高保護IPの保護を受けています。
6. **CNAME保護ドメイン名**
ユーザーは、保護ドメイン名を無料で作成し、サービスドメイン名解決サービスプロバイダーでCNAMEを追加することで、保護ドメイン名アクセスを解決することもできます。設定の詳細については、[**保護ドメイン名の高保護IPへのバインディング**](https://cloud.tencent.com/document/product/685/18808)を参照してください。
