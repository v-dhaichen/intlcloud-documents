Tencent Cloud API authenticates each access request, i.e. each request needs to include signature information (Signature) in the common request parameters to verify the identity of the user. The Signature is generated by the security credentials executed by the user which include SecretId and SecretKey. If you don't have the security credentials yet, you need to apply for them at Tencent Cloud's official website; otherwise, you cannot call the Cloud API.

## Applying for Security Credentials
Before using the Tencent Cloud API for the first time, you need to apply for security credentials in **Tencent Cloud Console** > **[API Key Management](https://console.cloud.tencent.com/cam/capi)**. Security credentials include SecretId and SecretKey:

- **SecretId** is used to identify the API caller.
- **SecretKey** is used to encrypt the signature string and verify it on the server.

>**Note:**
>API key is an important credential for building Tencent Cloud API requests. You can use Tencent Cloud API to operate all Tencent Cloud resources under your account. For your property and service security, please keep the key private and update it regularly. After you change the key, please delete the old key in time.


#### Steps for Applying for Security Credentials

1. Log in to [Tencent Cloud Console](https://console.cloud.tencent.com/).
2. Click **Products** and select **Cloud API Key** under **Management Tools** to enter the cloud API key management page.
  ![](//mc.qcloudimg.com/static/img/a771465c47830d54730f8f431d586991/image.png)
3. On the [API key management](https://console.cloud.tencent.com/capi) page, click **Create Key** to create a pair of SecretId/SecretKey.
>**Note:**
> - A developer account can have up to two pairs of SecretId/SecretKey.
> - A QQ account added by the developer as a sub-user can apply for different security credentials in different developer consoles.
> - Currently, only some cloud APIs can be called with a sub-user's security credentials.

## Generating Signature String
After obtaining the security credentials (SecretId and SecretKey), you can generate a signature string. Below describes how to generating the signature string in details:

![](//mc.qcloudimg.com/static/img/3a3a616ba175bb95be68123d86715e77/image.png)

Assume that the SecretId and SecretKey are:
SecretId: AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA
SecretKey: Gu5t9xGARNpq86cd98joQYCN3Cozk1qA

>**Note:**
>This is just an sample here. For actual operations, use your real SecretId and SecretKey and request parameters.

Take Tencent Cloud CVM as an example. When its [instance list-viewing](https://intl.cloud.tencent.com/document/product/213/9388) API (DescribeInstances) is called, the request parameter is as follows:

| Parameter name | Description | Parameter value |
|---------|---------|---------|
| Action | Method name | DescribeInstances |
| SecretId | Key ID  | AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA |
| Timestamp | Current timestamp | 1465185768 |
| Nonce | Random positive integer | 11886 |
| Region | Region where the instance is located | ap-guangzhou |
| SignatureMethod | Signature method | HmacSHA256 |
| InstanceIds.0 | ID of the to-be-queried instance | ins-09dx96dg |

### 1. Sorting Parameters
First, sort all request parameters by parameter name in ascending lexicographical order. (As the name implies, in the ascending lexicographical order, sorting is made as if the words are arranged in a dictionary in the ascending order of the alphabet or number table, that is, the first "letter" is considered first, and the second "letter" is considered if the first letters are identical, and so on.) You can do this with the aid of related sorting functions in the programming language, such as the ksort function in PHP. The sorting results of the sample parameters above are as follows:

```
{
    "Action" : "DescribeInstances",
    "InstanceIds.0" : "ins-09dx96dg"
    "Nonce" : 11886,
    "Region" : "ap-guangzhou",
    "SecretId" : "AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA",
    "SignatureMethod" : "HmacSHA256",
    "Timestamp" : 1465185768,
    
}
```
When developing in another programming language, you can sort these sample parameters and it would work as long as you get the same results.
### 2. Generating Request String
This step generates a request string.
Format the request parameters sorted in the previous step into the form of "parameter name"="parameter value". For example, for the Action parameter, its parameter name is `"Action"` and its parameter value is `"DescribeInstances"`, so it will become `Action=DescribeInstances` after formatted.
>**Note:**
>1. The "parameter value" is the original value but not the value after URL encoding.
>2. If the Key of the input parameter contains an underscore, the underscore needs to be replaced with a "."; however, underscores in Value do not need to be replaced. For example, `Placement_Zone=CN_GUANGZHOU` should be converted to `Placement.Zone=CN_GUANGZHOU`.

Then, splice together the formatted parameters with `"&"`. The resulting request string is as follows (please ignore the line breaks here):

```
Action=DescribeInstances
&InstanceIds.0=ins-09dx96dg
&Nonce=11886
&Region=ap-guangzhou
&SecretId=AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA
&SignatureMethod=HmacSHA256
&Timestamp=1465185768
```

### 3. Generating Signature Original String
This step generates a signature original string.
The splicing rule of the signature original string is:
> **Request method + request host + request path + ? + request string**

Parameter component description:
**Request method:** POST and GET modes are supported, and GET is used here for the request. Please note that the method name should be in all capital letters.
* **Request host:** This is the host domain name. Request domain name is determined by the product or product module to which the API belongs. The request domain names of different products or product modules vary, for example, the request domain name of Tencent Cloud CVM's instance list querying API (DescribeInstances) is: `cvm.api.qcloud.com`. For the request domain names of specific products, see the description of each API.
* **Request path:** Tencent Cloud API corresponds to the request path of a product. Generally, a product corresponds to a fixed path, for example, Tencent Cloud CVM's request path is fixed to `/v2/index.php`.
* **Request string:** This is the request string generated in the previous step.


Therefore, the generated signature original string of the example above is as below (please ignore the line breaks here):
```
GETcvm.api.qcloud.com/v2/index.php?Action=DescribeInstances
&InstanceIds.0=ins-09dx96dg
&Nonce=11886
&Region=ap-guangzhou
&SecretId=AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA
&SignatureMethod=HmacSHA256
&Timestamp=1465185768
```

### 4. Generating Signature String
This step generates a signature string.
>**Note:** 
>There are two ways to calculate the signature: HmacSHA256 and HmacSHA1. Here, a signature string is generated based on the signature algorithm you specify (i.e., the SignatureMethod parameter). The HmacSHA256 algorithm is used to calculate the signature when SignatureMethod is specified as HmacSHA256. In other cases, the signature is calculated with HmacSHA1.

First, use the signature algorithm (HmacSHA256 or HmacSHA1) to sign the **signature original string** obtained in the previous step, and then encode the generated signature string using Base64 to obtain the final signature string.

The specific code is as below with the PHP language as an example. Since the signature algorithm used in this example is **HmacSHA256**, the code for generating the signature string is as follows (when developing in another programming language, you can sign and verify the original in the sample above and it would work as long as you get the same results):

```php
$secretKey = 'Gu5t9xGARNpq86cd98joQYCN3Cozk1qA';
$srcStr = 'GETcvm.api.qcloud.com/v2/index.php?Action=DescribeInstances&InstanceIds.0=ins-09dx96dg&Nonce=11886&Region=ap-guangzhou&SecretId=AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA&SignatureMethod=HmacSHA256&Timestamp=1465185768';
$signStr = base64_encode(hash_hmac('sha256', $srcStr, $secretKey, true));
echo $signStr;
```

The final signature string is:

```
0EEm/HtGRr/VJXTAD9tYMth1Bzm3lLHz5RCDv1GdM8s=
```

Similarly, if you specify the signature algorithm as **HmacSHA1**, the code to generate the signature string is as follows:
```
$secretKey = 'Gu5t9xGARNpq86cd98joQYCN3Cozk1qA';
$srcStr = 'GETcvm.api.qcloud.com/v2/index.php?Action=DescribeInstances&InstanceIds.0=ins-09dx96dg&Nonce=11886&Region=ap-guangzhou&SecretId=AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA&SignatureMethod=HmacSHA1&Timestamp=1465185768';
$signStr = base64_encode(hash_hmac('sha1', $srcStr, $secretKey, true));
echo $signStr;
```

The final signature string is:
```
nPVnY6njQmwQ8ciqbPl5Qe+Oru4=
```


## Encoding Signature String
The generated signature string cannot be directly used as a request parameter and needs to be URL encoded.
For example, if the signature string generated in the previous step is `0EEm/HtGRr/VJXTAD9tYMth1Bzm3lLHz5RCDv1GdM8s=`, if would be `0EEm%2FHtGRr%2FVJXTAD9tYMth1Bzm3lLHz5RCDv1GdM8s%3D` after encoding. Therefore, the final signature string request parameter (Signature) is `0EEm%2FHtGRr%2FVJXTAD9tYMth1Bzm3lLHz5RCDv1GdM8s%3D`, which will be used to generate the final request URL.
>**Note:**
>If your request method is GET, then all the request parameter values need to be URL encoded; in addition, some languages automatically encode the URL, and repeated encoding will lead to signature verification failure.

## Authentication Failure
When the authentication fails, errors in the table below may occur:

| Error code | Error type | Error description |
|---------|---------|---------|
| 4100 | Identity verification failed | Identity verification failed. Please make sure that the Signature in the request parameter is calculated correctly as detailed in the steps above. Note: The Signature needs to be URL encoded before initiating the request. |
| 4101 | Not authorized by the developer to access this API | This sub-user is not authorized to call this API. Please contact the developer for authorization. For details, see [Authorization Policy](https://intl.cloud.tencent.com/document/product/598/10601). |
| 4102 | Not authorized by the developer to access the resources operated by this API | In the resource parameter of the request, there are resources that are not authorized by the developer for access. Please view the related resource ID in the message field. </br>Please contact the developer for authorization. For details, see [Authorization Policy](https://intl.cloud.tencent.com/document/product/598/10601). |
| 4103 | Non-developer's SecretId cannot call this API. | The sub-user's SecretId cannot call this API and only the developer has the right to call it. |
| 4104 | SecretId does not exist | The SecretId used for the signature does not exist, or the key is in a wrong state. Please make sure that the API key is valid and enabled. |
| 4110 | Authentication failed | Permission verification failed. Please make sure that you have the permission to use the accessed resources. |
| 4500 | Replay attack error | Please note that the Nonce parameter must be unique, and the Timestamp cannot differ from that of the Tencent server by more than 2 hours. |
