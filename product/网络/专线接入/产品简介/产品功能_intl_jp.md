## 物理的専用回線
Tencent Cloudとローカルデータセンターを接続する物理的専用回線。サードパーティーのネットワークサービスプロバイダを介してデータセンターとTencent Cloudの専用回線ネットワークのアクセスポイントの間にネットワーク接続を構築することができます。
## 専用チャネル
- 専用チャネルは、物理的専用回線のネットワークリンク区分です。
- ユーザーは異なる専用回線ゲートウェイに接続される専用チャネルを作成し、ローカルデータセンターと複数のVPCの相互接続を実現することができます。

## 専用回線ゲートウェイ
- 専用回線ゲートウェイはVPCと物理的専用回線が専用チャネルを構築する入口であり、VPCは最大2つの専用回線ゲートウェイをサポートします（NATをサポートする+NATをサポートしないの各1つ）。
- 専用回線ゲートウェイは複数の物理的専用回線の間に専用チャネルを構築し、複数の地域を接続するハイブリッドクラウド展開を実現できます。

## ネットワークアドレス変換（NAT）
ネットワークアドレス変換は、ハイブリッドクラウドの接続時に専用回線両端のIPが競合する問題に対応するソリューションです。専用回線ゲートウェイ上にネットワークアドレス変換規則を構成することができ、ネットワークアドレス変換（NAT）はIP変換とIPポート変換の2種類を含みます。
## IP変換
- IP変換とは元のIPを新しいIPに変換し、ネットワークの相互アクセスを実現することを指し、**ローカルIP変換**と**ピアIP変換**に分かれます。
- IP変換はソース、宛先方向を区分せず、マッピングIPはピアにアクセスすることも、またピアからアクセスされることもできます。

#### ローカルIP変換
**1. 変換の説明**
 - ローカルIP変換とはVPC内の元のIPを新しいIPにマッピングし、且つ新しいIPのステータスで専用回線ピアと相互アクセスすることを指します。
 - 複数のローカルIP変換規則を構成し、また、各ローカルIP変換規則にネットワークACLを構成することができ、ネットワークACLはソースポート、宛先IP、宛先ポートの構成をサポートします。
>**注意：**
>ネットワークアドレス変換規則は、ACL制限に適合するネットワークリクエストに対してのみ有効となります。
 - ローカルIP変換はネットワークリクエストの方向を制限せず、VPCが専用回線ピアにアクセスすることも、専用回線ピアからアクセスされることもできます。
![](https://main.qcloudimg.com/raw/77f940ecea61658b36d9e7aeebda3ecb.png)

**2. 変換の例**
VPC内のIP A`192.168.0.3`がIP B`10.100.0.3`にマッピングされた場合、IP Aの専用回線ピアに対して自発的にアクセスするネットワークパケットソースIPは自動的に`10.100.0.3`に変更され、すべての専用回線ピアがアクセスする`10.100.0.3`のネットワークパケットは自動的にIP A`192.168.0.3`にディレクトします。

#### ピアIP変換
**1. 変換の説明**
 - ピアIP変換とはユーザーIDC内の元のIPを新しいIPにマッピングし、また、新しいIPのステータスでVPC内のIPと相互アクセスすることを指します。
 - ローカルIP変換と異なり、ピアIP変換はネットワークACLの制限をサポートしないため、ひとたびピアIP変換規則が構成されると、すべての専用チャネルピアに対して有効となります。
 - ピアIP変換はネットワークリクエストの方向を制限せず、VPCが専用回線ピアにアクセスすることも、専用回線ピアからアクセスされることもできます。
 ![](https://main.qcloudimg.com/raw/461790e7eff146ac46aabec4ec4ebb31.png)

**2. 変換の例**
専用回線ピアのIP D`10.0.0.3`がIP C`172.16.0.3`にマッピングされた場合、IP D`10.0.0.3`のVPCに自発的にアクセスするネットワークパケットソースIPは自動的にIP C`172.16.0.3`に変更され、すべてのVPCでIP C`172.16.0.3`にアクセスするネットワークパケットは自動的に専用回線ピアIP D`10.0.0.3`にディレクトします。

>**注意：**
- ローカル、ピアIP変換を構成した後、専用回線ゲートウェイは変換後のIPルーティングのみを専用回線ピアに配信するため、ローカル、ピアIP変換を構成していない元のIPは専用回線ピアにpingできません。ただし、専用回線ゲートウェイは専門のネットワークファイアウォールを代替することができず、高度なネットワーク保護を必要とする場合、VPC内にセキュリティグループとネットワークACLポリシーを構成すると同時に、IDCデータセンターに専門の物理的ネットワークファイヤーウォールデバイスを展開してください。
- 専用回線ゲートウェイが同時にピアIP変換を構成する時、ローカルソースIPポート変換のACL規則の**宛先IP**は元のIPではなく、**ピアIP変換のマッピングIP**を書き込む必要があります。

## IPポート変換
- IPポート変換とは元のIPポートを新しいIPポートにマッピングし、また、新しいIPポートでネットワークの相互アクセスを実現することを指し、**ローカルソースIPポート変換**、**ローカル宛先IPポート変換**を含みます。
- IPポート変換は指向性を強調し、ソースIPポート変換とは自発的な外部アクセスを指し、宛先IPポート変換とはピアからの自発的なアクセスを指します。

## ローカルソースIPポート変換
**1. 変換の説明**
 - ローカルソースIPポート変換とは、VPC内のIPが専用回線ゲートウェイを介して自発的に外部アクセスする時に、指定IPプール内のランダムIPのランダムポートで専用回線ピアのユーザーIDCにアクセスすることを指します。
 - ローカルソースIPポート変換はACL規則の構成をサポートし、ACL規則に適合するネットワークのアウトバウンドアクセスのみがアドレスプール転送規則にマッチングします。アドレスプールに異なるACL規則を構成することにより、複数のサードパーティーがアクセスする時のネットワークアドレス変換規則を柔軟に構成することができます。
![](https://main.qcloudimg.com/raw/236a2f1417f75ec8c1cbe0d8c2335129.png)

- ローカルソースIPポート変換はVPC側が自発的に送信したネットワークアクセスリクエストのみをサポートし、専用回線ピアがVPC内のIPポートに自発的にアクセスする必要がある場合、ローカル宛先IPポート変換を追加で構成する必要があります。ローカルソースIPポート変換VPCが自発的に送信したネットワークリクエストはステートフル接続であり、ネットワークの戻りパケットの問題を考慮する必要がありません。

**2. 例：**
VPC CのIPアドレス範囲は`172.16.0.0/16`で、専用回線を介してサードパーティーの銀行AとBに接続され、そのうち銀行AのピアIPアドレス範囲は`10.0.0.0/28`で、要求される接続IPアドレス範囲は`192.168.0.0/28`です。銀行BのピアIPアドレス範囲は`10.1.0.0/28`で、要求される接続IPアドレス範囲は`192.168.1.0/28`です。この場合、以下のように2つのローカル側ソースIPポート変換を構成することができます。
- アドレスプールA `192.168.0.1 - 192.168.0.15`。ACL規則A。ソースIP`172.16.0.0/16`。宛先IP`10.0.0.0/28`。宛先ポートALL。
- アドレスプールB `192.168.1.1 - 192.168.1.15`。ACL規則B。ソースIP`172.16.0.0/16`。宛先IP`10.1.0.0/28`。宛先ポートALL。

この場合、VPC内でA、Bに自発的にアクセスするネットワークリクエストは、ACL規則A、Bに基づきそれぞれ対応するアドレスプールのランダムポートに変換され、対応する専用チャネルにアクセスします。

#### ローカル宛先IPポート変換
**1. 変換の説明**
 - ローカル宛先IPポート変換は、専用回線ピアがVPCに自発的にアクセスする方法です。VPC内の指定IPの指定ポートを新しいIPとポートにマッピングした場合、専用回線ピアはマッピング後のIPポートにアクセスすることによってのみVPC内の指定IPポートと通信することができ、その他のIPポートは専用回線ピアに公開されません。
![](https://main.qcloudimg.com/raw/3c70c23e29e3a74baa9b67270edf3ab3.png)

 - ローカル宛先IPポート変換はACL規則の適応をサポートしないため、IPポート変換規則は専用回線ゲートウェイに接続されるすべての専用チャネルに対して有効となります。ローカル宛先IPポート変換は専用チャネルピアのVPCへの自発的なアクセスに対してのみ有効となり、VPCが専用回線ピアに自発的にアクセスする必要がある場合、ローカルソースIPポート変換を構成することができます。ローカル宛先IPポート変換のネットワークリクエストはステートフル接続であり、ネットワークの戻りパケットの問題を考慮する必要はありません。

**2. 変換の例**
VPC CのIPアドレス範囲が`172.16.0.0/16`であり、いくつかのポートを専用回線ピアの自発的なアクセスのために開放することだけを希望する場合、以下のプランで構成することができます。
- マッピングAの元のIPポート`172.16.0.1:80`。マッピングIPポート`10.0.0.1:80`。
- マッピングBの元のIPポート`172.16.0.0:8080`。マッピングIPポート`10.0.0.1:8080`。
この場合、専用回線ピアは`10.0.0.1:80`、`10.0.0.1:8080`ポートに自発的にアクセスし、VPC内の`172.16.0.1:80`、`172.16.0.0:8080`の2つのポートへの自発的なアクセスを実現することができます。

>**注意：**
-  ローカルソース、宛先IP変換を構成した後、専用回線ゲートウェイは変換後のIPポートのルーティングのみを専用回線ピアに配信するため、構成されていないローカルIPポートは自発的にリクエストを開始したり受動的にリクエストを受け取ったりすることができません。ただし、専用回線ゲートウェイは専門のネットワークファイアウォールを代替することができず、高度なネットワーク保護を必要とする場合、VPC内にセキュリティグループとネットワークACLポリシーを構成すると同時に、IDCデータセンターに専門の物理的ネットワークファイヤーウォールデバイスを展開してください。
- IP変換とIPポート変換を同時に構成する時、IP変換を優先的にマッチングし、IP変換にマッチングするオプションがない時に、引き続きIPポート変換をマッチングします。
- 専用回線ゲートウェイが同時にピアIP変換を構成する時、ローカルソースIPポート変換のACL規則の**宛先IP**は元のIPではなく、**ピアIP変換のマッピングIP**を書き込む必要があります。

