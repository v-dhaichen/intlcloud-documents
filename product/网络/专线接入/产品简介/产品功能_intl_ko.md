## 물리적 직접 연결
Tencent Cloud와 로컬 IDC를 연결한 물리적 회선 연결로 제3자 네트워크 서비스 제공업체를 통해 데이터 센터와 Tencent Cloud 직접 연결 네트워크 액세스 포인트에 네트워크 연결을 생성할 수 있습니다.
## 전용 채널
- 전용 채널은 물리적 직접 연결의 네트워크 링키지 구획입니다.
- 다른 직접 연결 게이트웨이에 연결된 전용 채널을 생성하여 로컬 IDC와 여러 VPC의 상호 연결을 구현할 수 있습니다.

## 직접 연결 게이트웨이
- 직접 연결 게이트웨이는 VPC가 물리적 직접 연결과 전용 채널을 생성한 입구로 VPC는 최대 2개의 직접 연결 게이트웨이(NAT 지원 + NAT 각 1개는 지원하지 않음)를 지원합니다.
- 직접 연결 게이트웨이는 여러 개의 물리적 직접 연결과 전용 채널을 생성하여 여러 지역을 연결한 하이브리드 클라우드 배포를 구현할 수 있습니다.

## 네트워크 주소 전환(NAT)
네트워크 주소 변환은 하이브리드 클라우드로 연결 시, 직접 연결 양측의 IP가 충돌하는 문제의 해결 방안입니다. 직접 연결 게이트웨이에서 네트워크 주소 전환 규칙을 구성할 수 있습니다. 네트워크 주소 전환(NAT)은 IP 변환과 IP 포트 변환이 포함됩니다.
### IP 변환
- IP 변환이란 기존 IP가 새 IP로 변환되어 네트워크 상호 접근을 구현하는 것을 가리키며 **로컬 IP 변환**과 **피어 IP 변환**으로 나뉩니다.
- IP 변환은 소스와 대상 방향을 구분하지 않고 매핑 IP는 주동적으로 피어에 접근하거나 피어에 의해 접근될 수 있습니다.

#### 로컬 IP 변환
**1. 변환 설명**
 - 로컬 IP 변환이란 VPC 내 기존 IP가 새 IP로 매핑되고 새 IP 신분으로 직접 연결 피어와 상호 접근하는 것을 가리킵니다.
 - 여러 개의 로컬 IP 변환 규칙을 구성하고 모든 로컬 IP 변환 규칙에 네트워크 ACL을 구성할 수 있습니다. 네트워크 ACL은 소스 포트, 대상 IP, 대상 포트의 구성을 지원합니다.
>**주의:**
>네트워크 주소 변환 규칙은 ACL 제한에 부합하는 네트워크 요청에 대해서만 유효합니다.
 - 로컬 IP 변환은 네트워크 요청 방향을 제한하지 않고, VPC가 직접 연결 피어에 주동적으로 접근하거나 직접 연결 피어가 VPC에 주동적으로 접근할 수 있습니다.
![](https://main.qcloudimg.com/raw/77f940ecea61658b36d9e7aeebda3ecb.png)

**2. 변환 예시**
VPC 내 IP A`192.168.0.3`을 IP B`10.100.0.3`으로 매핑하면, 직접 연결 피어에 대한 IP A의 주동적 접근 네트워크 패킷 소스 IP가 `10.100.0.3`으로 수정되며, 직접 연결 피어 접근한 `10.100.0.3` 네트워크 패킷은 모두 자동적으로 IP A`192.168.0.3`를 향하게 됩니다.

#### 피어 IP 변환
**1. 변환 설명**
 - 피어 IP 변환이란 사용자 IDC 내 기존 IP가 새 IP로 매핑되고 새 IP 신분으로 VPC 내 IP와 상호 접근하는 것을 가리킵니다.
 - 로컬 IP 변환과 다르게 피어 IP 변환은 네트워크 ACL 제한을 지원하지 않기 때문에 피어 IP 변환 규칙을 일단 구성하면 모든 전용 채널 피어에 유효합니다.
 - 피어 IP 변환은 네트워크 요청 방향을 제한하지 않고, VPC가 직접 연결 피어에 주동적으로 접근하거나 직접 연결 피어가 VPC에 주동적으로 접근하는 것을 지원합니다.
 ![](https://main.qcloudimg.com/raw/461790e7eff146ac46aabec4ec4ebb31.png)

**2. 변환 예시**
직접 연결 피어 IP D`10.0.0.3`을 IP C`172.16.0.3`으로 매핑하면 IP D`10.0.0.3`이 VPC의 네트워크 패킷 소스 IP에 주동적으로 접근하고, IP C`172.16.0.3`으로 수정됩니다. 모든 VPC가 IP C`172.16.0.3`의 네트워크 패킷에 접근하면, 직접 연결 피어 IP D`10.0.0.3`으로 자동으로 향하게 됩니다.

>**주의:**
- 로컬, 피어 IP 변환 구성 후, 직접 연결 게이트웨이는 변환 후 IP 라우팅을 직접 연결 피어에 발행하기 때문에 로컬, 피어 IP 변환을 구성하지 않은 기존 IP는 직접 연결 피어를 ping할 수 없습니다. 직접 연결 게이트웨이는 전문 네트워크 방화벽을 대체할 수 없으니 고급 네트워크 보호가 필요할 경우, VPC 내에서 보안 그룹과 네트워크 ACL 전략을 구성하고 IDC 데이터 센터에 전문 물리적 네트워크 방화벽 장치를 배포하십시오.
- 직접 연결 게이트웨이가 피어 IP 변환을 동시에 구성하는 경우, 로컬 소스 IP 포트 변환에 ACL 규칙의 **대상 IP**를 **피어 IP 변환의 매핑 IP**로 입력해야 하며 소스 IP가 아닙니다.

### IP 포트 변환
- IP 포트 변환이란 기존 IP 포트를 새 IP 포트로 매핑하고 새 IP 포트로 네트워크 상호 접근을 구현하는 것을 의미합니다. **로컬 소스 IP 포트 변환**, **로컬 대상 IP 포트 변환**을 포함합니다.
- IP 포트 변환은 방향성을 강조하고, 소스 IP 포트 변환이란 주동적 외부 접근을 가리키며, 대상 IP 포트 변환이란 피어에 주동적으로 접근되는 것을 의미합니다.

#### 로컬 소스 IP 포트 변환
**1. 변환 설명**
 - 로컬 소스 IP 포트 변환이란 VPC 내 IP가 직접 연결 게이트웨이를 통해 주동적으로 외부 접근할 때, 지정된 IP 풀 내 랜덤 IP의 랜덤 포트로 직접 연결 피어의 사용자 IDC에 접근하는 것을 가리킵니다.
 - 로컬 소스 IP 포트 변환은 ACL 규칙을 지원하면, ACL 규칙에 부합하는 네트워크가 접근해야 주소 풀 포워딩 규칙을 매칭합니다. 주소 풀에 다른 ACL 규칙을 구성하면, 제3자 액세스 시 여러 개의 네트워크 주소 전환 규칙을 유연하게 구성할 수 있습니다.
![](https://main.qcloudimg.com/raw/236a2f1417f75ec8c1cbe0d8c2335129.png)

- 로컬 소스 IP 포트 변환은 VPC가 주동적으로 개시한 네트워크 접근 요청만 지원합니다. 직접 연결 피어가 VPC 내 IP 포트에 주동적으로 접근하려면 로컬 대상 IP 포트 변환 구성을 별도 구성해야 합니다. 로컬 소스 IP 포트 변환 VPC가 주동적으로 개시한 네트워크 요청은 상태 저장인 경우, 네트워크 응답 패킷 문제를 고려할 필요가 없습니다.

**2. 예시:**
VPC C IP 주소 범위는 `172.16.0.0/16`이며 직접 연결을 통해 제3자 은행 A와 B를 연결합니다. 그 중 은행 A 피어 IP 주소 범위는 `10.0.0.0/28`이며, 연결 IP 주소 범위는 `192.168.0.0/28`이어야 합니다. 은행 B 피어 IP 주소 범위는 `10.1.0.0/28`이며 연결 IP 주소 범위는 `192.168.1.0/28`이어야 합니다. 다음에 따라 두 개의 로컬 소스 IP 포트 변환을 구성할 수 있습니다.
- 주소 풀 A `192.168.0.1 - 192.168.0.15`, ACL 규칙 A, 소스 IP `172.16.0.0/16`, 대상 IP `10.0.0.0/28`, 대상 포트 ALL입니다.
- 주소 풀 B `192.168.1.1 - 192.168.1.15`, ACL 규칙 B, 소스 IP `172.16.0.0/16`, 대상 IP `10.1.0.0/28`, 대상 포트 ALL입니다.

VPC 내에서 A, B에 주동적으로 접근한 네트워크 요청은 ACL 규칙 A, B에 따라 각각 해당 주소 풀의 랜덤 포트로 변환되고 해당 전용 채널에 접근합니다.

#### 로컬 대상 IP 포트 변환
**1. 변환 설명**
 - 로컬 대상 IP 포트 변환은 직접 연결 피어가 VPC에 능동적으로 접근하는 방법 중 하나입니다. VPC 내 지정한 IP와 포트를 새로운 IP와 포트로 매핑합니다. 직접 연결 피어는 매핑된 IP 포트로 VPC 내 지정한 IP 포트와 통신할 수 있으며, 기타 IP 포트는 직접 연결 피어에 개방하지 않습니다.
![](https://main.qcloudimg.com/raw/3c70c23e29e3a74baa9b67270edf3ab3.png)

 - 로컬 대상 IP 포트 변환은 ACL 규칙 적용을 지원하지 않기 때문에 IP 포트 변환 규칙은 직접 연결 게이트웨이가 연결한 모든 전용 채널에 적용됩니다. 로컬 대상 IP 포트 변환은 전용 채널 피어가 VPC에 대한 능동적인 액세스에만 적용되고 VPC가 직접 연결 피어에 능동적으로 액세스해야 할 경우, 로컬 소스 IP 포트 변환을 구성할 수 있습니다. 로컬 대상 IP 포트 변환의 네트워크 요청이 상태 저장인 경우, 네트워크 응답 패킷 문제를 고려할 필요가 없습니다.

**2. 변환 예시**
VPC C의 IP 주소 범위가 `172.16.0.0/16`이고 직접 연결 피어가 농동적인 액세스용으로 일부 포트만 개방하고자 할 경우, 다음에 따라 구성할 수 있습니다.
- 매핑 A  소스 IP 포트 `172.16.0.1:80`, 매핑 IP 포트 `10.0.0.1:80`
- 매핑 B  소스 IP 포트 `172.16.0.0:8080`, 매핑 IP 포트 `10.0.0.1:8080`
직접 연결 피어가 `10.0.0.1:80`, `10.0.0.1:8080` 포트에 농동적으로 액세스할 수 있으며 즉, VPC 내 `172.16.0.1:80`, `172.16.0.0:8080` 포트에 대한 농동적인 액세스를 구현합니다.

>**주의:**
-  로컬 소스 및 피어 IP 포트 변환을 구성한 후, 직접 연결 게이트웨이는 변환 후 IP 라우팅을 직접 연결 피어에 발행합니다. 따라서, 구성하지 않은 소스 IP 포트는 능동적으로 요청을 개시하거나 피동적으로 요청을 수신할 수 없습니다. 하지만 직접 연결 게이트웨이는 전문적인 네트워크 방화벽을 대체할 수 없으니 더 높은 수준의 네트워크 보호가 필요할 경우, VPC 내에서 보안 그룹과 네트워크 ACL 전략을 구성하는 동시에 IDC 데이터 센터에 전문 물리적 네트워크 방화벽 장치를 배포하십시오.
- IP 변환과 IP 포트 변환을 동시에 구성할 경우, IP 변환은 더 높은 우선순위가 가지고 있습니다. IP 변환에 매칭 옵션이 없을 때 IP 포트 변환을 계속하게 됩니다.
- 직접 연결 게이트웨이가 피어 IP 변환을 동시에 구성하는 경우, 로컬 소스 IP 포트 변환에 ACL 규칙의 **대상 IP**를 **피어 IP 변환의 매핑 IP**로 입력해야 하며 소스 IP가 아닙니다.

