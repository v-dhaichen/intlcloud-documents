Tencent Cloud 응용형 CLB는 강화형 CLB로 전통형 CLB와 비교하였을 때, 응용형 CLB는 더 많은 기능과 더 강한 성능을 지원합니다. 전통형의 기본 기능 외에도 응용형 CLB는 사용자가 도메인 이름과 URL 포워딩 규칙에 기반하여 구성할 수 있도록 지원합니다. 더불어, 리디렉션(예를 들어 HTTP 요청을 HTTPS 요청으로 리디렉션) 및 SNI에 여러 인증서 바인딩 등도 지원합니다. 이 문서는 새로운 사용자가 Tencent Cloud 응용형 CLB를 사용하는 방법을 소개합니다.

## 1. CVM을 구매하고 백 엔드 서비스를 구축합니다
CLB는 트래픽을 포워딩만 책임지고 요청을 처리할 능력을 보유하지 않았기 때문에 사용자 요청을 처리할 수 있는 CVM 인스턴스를 보유해야 합니다. 먼저 CVM을 구매하고 백 엔드 서비스를 구축합니다
### 1.1 CVM 구매
CVM의 [구매 페이지](https://buy.cloud.tencent.com/cvm)에서 자신에게 적합한 모델과 이미지 등을 선택하고 CVM의 초기 비밀번호를 설정하며 보안 그룹(여기에 쉽게 테스트할 수 있도록 먼저 전체 포트를 개방한 다음 다시 제한할 수 있음)을 구성합니다. 그 밖에 CVM을 구매할 때 공중망 트래픽을 개통해야 하며 그렇지 않으면 CLB 연결 후 접근할 수 없는 문제가 발생됩니다.
![](https://main.qcloudimg.com/raw/8edc105a8037a0bedcb2538828430d81.png)

본 예제에서는 광저우 지역에 이미 CVM 인스턴스 `rs-1`과 `rs-2`를 생성하였습니다. 세부 정보는 [CVM 인스턴스 구매 및 시작](https://cloud.tencent.com/document/product/213/4855)을 참조하십시오.
- **서버 정보**
 - 지역: 광저우
 - 가용 영역: 광저우 3 지역 1대, 광저우 4 지역 1대
 - CVM 요금제: 사용량 기반 요금제
 - 네트워크 요금제: 대역폭 기반 요금제
 - 소속 네트워크: VPC(기본; Default-VPC)
- **서버 구성**
 - 인스턴스 유형: S4.SMALL2(표준형 S4)
 - 운영 체제	CentOS 7.5 64비트
 - CPU: 1코어
 - 메모리: 2GB
 - 시스템 디스크: 50GB(HDD 클라우드 디스크)
 - 데이트 디스크: 500GB(프리미엄 클라우드 디스크)
 - 공중망 대역폭: 1Mbps(필수 항목)

 > 주의: 현재 대역폭 속성이 CLB가 아닌 CVM에 있기 때문에 CVM에는 반드시 공중망 대역폭을 구매해야 합니다.

### 1.2 백 엔드 서비스 구축
본문은 HTTP 포워딩을 예로 하고 있으며, CVM에는 Apache, Nginx, IIS 등과 같은 해당하는 Web 서버를 배포해야 합니다. 결과를 인증하기 위해 예제는 `rs-1`에 Nginx를 배포하고 'This is rs-1! URL is index.html'을 지닌 HTML 1개를 반환하고, `rs-2`에 Nginx를 배포하고 'This is rs-2! URL is image/index.html'을 지닌 HTML을 반환합니다. Nginx 배포는 [Linux(CentOS)에서 nginx 배포](게시 예정)를 참조하십시오. CVM에 서비스를 배포와 관련한 더 많은 내용은 [Linux(CentOS)에서 Java Web 배포](게시 예정) 및 [Windows에서 PHP 설치 및 구성](https://cloud.tencent.com/document/product/213/10182)을 참조하십시오.

### 1.3 인증 서비스
CVM의 공인 IP + 경로에 접근하십시오. 배포한 페이지가 보인다면 배포에 성공하였음을 증명합니다.

## 2. CLB 인스턴스 구매
1. Tencent Cloud [CLB 서비스 구매 페이지](https://buy.cloud.tencent.com/lb)에 로그인합니다.
2. 이 예는 CVM과 같은 [광저우] 지역을 선택하고 인스턴스 유형은 [응용형]을 선택하고, 네트워크 속성은 [공중망]을 선택하고, 네트워크는 [Default-VPC(기본)]을 선택하였으며 인스턴스 이름에 [clb-test]를 입력했습니다.
3. [즉시 구매] 버튼을 클릭하여 지불을 완료합니다.
CLB 인스턴스 관련 더 많은 내용은 [구매 속성 가이드](게시 예정)를 참조하십시오.
![](https://main.qcloudimg.com/raw/ce5c1f23b671760a8e14f06f28040da4.png)
4. [LB 인스턴스 목록] 페이지에서 해당 지역을 선택하면 새로 생성한 인스턴스를 볼 수 있습니다.
![](https://main.qcloudimg.com/raw/36e75ded1d8a0e93bd25b9c24ee850c5.png)

## 3. CLB 수신기 생성
CLB 수신기는 지정한 프로토콜 및 포트를 통해 실제 포워딩합니다. 이 문서는 CLB가 클라이언트에 포워딩하는 HTTP 요청 구성을 예로 하고 있습니다.
### 3.1 HTTP 수신 프로토콜과 포트 구성
1. [Tencent Cloud 콘솔](https://console.cloud.tencent.com/)에 로그인하여 [클라우드 제품]-[네트워크]-[CLB]를 클릭하여 CLB 콘솔에 진입합니다.
2. [LB 인스턴스 목록]에서 생성한 응용형 CLB 인스턴스 `clb-test`를 찾아내고 인스턴스 ID를 클릭하여 CLB 세부 정보 페이지에 진입합니다.
3. [기본 정보] 부분에서 이름 뒤의 작은 아이콘을 클릭하여 인스턴스 이름을 수정할 수 있습니다.
4. [수신기 관리]의 [HTTP/HTTPS 수신기]에서 [생성] 버튼을 클릭하여 CLB 수신기를 생성합니다.
![](https://main.qcloudimg.com/raw/08476cf9f61eec6dc1baba400821e6ec.png)
5. 팝업창에서 아래 내용을 구성합니다.
  - 이름을 'Listener1'로 사용자 지정.
  - 수신 프로토콜 포트는 `HTTP: 80`임.
  - [제출] 버튼을 클릭하여 CLB 수신기를 생성합니다.

### 3.2 수신기의 포워딩 규칙 구성
1. [수신기 관리]에서 방금 생성한 수신기 Listener1을 선택한 뒤 '＋'를 클릭하여 규칙 추가를 시작합니다.
![](https://main.qcloudimg.com/raw/ff0a2b40bf4fcd7e361966ee6d4a21d9.png)
2. 팝업창에 도메인 이름, URL 경로와 밸런싱 방식을 구성합니다.
  - 도메인 이름: 백 엔드 서비스에 사용한 도메인 이름으로 이 예제는 `www.qcloudtest.com`을 사용하였습니다. 도메인 이름은 와일드카드를 지원하며 세부 정보는 [구성 설명](https://cloud.tencent.com/document/product/214/9032)을 참조하십시오.
  - URL 경로: 백 엔드 서비스 접근 경로로 이 예제에서는 `/image/`를 사용합니다.
  - 밸런싱 방식으로 ‘가중치에 따라 라운드 로빈’ 선택
![](https://main.qcloudimg.com/raw/1dc1ab66d04f361dd138e24eb7509d50.png)
3. 상태 검사 구성: 상태 검사를 시작하여 도메인 이름이 사용한 기본 포워딩 도메인 이름과 포워딩 경로를 검사합니다.
![](https://main.qcloudimg.com/raw/305f3f9de7e4641f0cd8f5944ff57ac8.png)
4. 세션 유지: 세션 유지를 선택하지 않습니다.
5. [완료]를 클릭하여 수신기 포워딩 규칙의 구성을 완료합니다.
![](https://main.qcloudimg.com/raw/5de81a61e3a83eb760339ed0124f7d66.png)

CLB 수신기 관련 더 많은 내용은 [CLB 수신기 개요](https://cloud.tencent.com/document/product/214/6151)를 참조하십시오.
> 주의: 1개의 수신기(수신 프로토콜: 포트)에 여러 개의 도메인 이름을 구성할 수 있고, 1개의 도메인 이름에 여러 개의 URL 경로를 구성할 수 있습니다. 수신기 또는 도메인 이름을 선택하고 '＋'를 클릭하면 새로운 규칙을 생성할 수 있습니다.
> 사용자가 세션 유지 기능을 끄고 라운드 로빈 방식으로 스케줄링하면 요청이 각기 다른 RS에 순서대로 할당됩니다. 사용자가 세션 유지 기능을 켜거나 세션 유지 기능을 껐지만 ip_hash 스케줄링 방식을 선택하였을 경우, 요청은 동일 RS에 할당됩니다.

### 3.3 CVM 바인딩
1. [수신기 관리] 페이지에서 방금 생성한 수신기 Listener1을 선택하고 펼쳐 도메인 이름, URL 경로 등을선택하면 스크린 오른쪽에서 해당 URL 경로가 바인딩한 CVM 정보를 볼 수 있으며 [바인딩] 버튼을 클릭하면 됩니다.
![](https://main.qcloudimg.com/raw/fa041a80ebf420e75f77f4ab5fbddf24.png)
2. 팝업창에서 CLB와 같은 지역의 CVM 인스턴스 `rs-1`과 `rs-2`를 선택하고 CVM 포트를 모두 `80`으로 설정합니다. CVM 가중치는 모두 기본값 `10`입니다.
![](https://main.qcloudimg.com/raw/8729820affbf015a4256f8716ae888de.png)
4. [확인] 버튼을 클릭하여 바인딩을 완료합니다.
4. 수신기를 URL 경로 차원까지 열면 바인딩한 CVM과 상태 검사 상태를 확인할 수 있으며, 상태가 '정상" 상태일 경우 CVM이 CLB 포워딩 요청을 정상적으로 처리할 수 있다고 표시됩니다.
![](https://main.qcloudimg.com/raw/b66d71a83253dd0729092a0489c33d1e.png)
> 참고: 포워딩 규칙(수신 프로토콜 + 포트 + 도메인 이름 + URL 경로) 1개는 같은 CVM의 여러 포트를 바인딩할 수 있습니다. 사용자가 `rs-1`의 `80`과 `81` 포트에 동일한 서비스를 배포하였을 경우, CLB는 예제 중 포워딩 규칙을 지원하고 동시에 `rs-1`의 `80`과 `81` 포트를 바인딩하여 두 개의 포트는 모두 CLB 포워딩 요청을 수신합니다.

## 4. CLB 서비스 인증
CLB 구성이 완료한 후, 해당 아키텍처가 적용 여부를 인증할 수 있습니다. 즉, 1개의 CLB 인스턴스에서 서로 다른 **도메인 이름+URL**을 통해 각기 다른 백 엔드 CVM에 대한 액세스 또는 **"내용 라우팅"** 기능을 인증합니다.
### 4.1 방법1: hosts를 구성하여 도메인 이름을 CLB에 향해시킵니다.
Windows 시스템에서 `C:\Windows\System32\drivers\etc` 디렉터리에 진입해 hosts 파일을 수정하고 도메인 이름을 CLB 인스턴스의 VIP에 매핑합니다.
![](https://main.qcloudimg.com/raw/2a5cd0cc116ce53fed3ac98d4017a59f.png)

hosts 구성 성공 여부를 인증하기 위해 로컬에 cmd를 열고 ping 명령을 사용하여 해당 도메인 이름이 VIP와 바인딩 여부를 탐지합니다. 데이터 패킷이 발견될 경우, 바인딩에 성공하였음을 증명합니다.
![](https://main.qcloudimg.com/raw/cbf250997c885695d3ff8525de816be5.png)

이어 웹 브라우저에 접근 경로 `http://www.qcloudtest.com/image/`를 입력하고 CLB 서비스를 테스트합니다. 다음과 같이 이번 요청이 CLB에 의해 rs-1 CVM에 포워딩되었음이 표시되며 CVM은 요청을 정상적으로 처리하고 반환합니다.
![](https://main.qcloudimg.com/raw/97b1f947d2b9dd90e99efb82a95722b9.png)

이 수신기의 라운드 로빈 알고리즘은 "가중치로 라운드 로빈"이며 CVM 두 대의 가중치는 모두 10입니다. 웹 브라우저를 세로고침하면 요청이 다시 발송되어 이번 요청이 CLB에 의해 rs-2 CVM에 포워딩되었음을 간주합니다.
![](https://main.qcloudimg.com/raw/7c467013c2635338527dc0eb70fc4635.png)
> 주의: `image/` 뒷부분의 `/`는 매우 중요합니다. 이는 image라는 파일이 아닌 image가 기본적인 디렉터리임을 의미하기 때문입니다.

### 4.2 방법2: CDNS(클라우드 도메인 이름 서비스)를 구성하여 도메인 이름을 CLB에 향해시킵니다.
1. [Tencent Cloud 도메인 이름 등록 페이지](https://dnspod.cloud.tencent.com)를 열어 도메인 이름 조회와 등록을 진행합니다. Qcloudtest.com을 예로 하며, 세부 정보는 [도메인 이름 등록](https://cloud.tencent.com/document/product/242/9595)을 참조하십시오.
2. [Tencent Cloud 콘솔](https://console.cloud.tencent.com/)에 로그인하여 [클라우드 제품] - [도메인 이름과 웹사이트] - [CDNS]를 클릭합니다.
3. 구매하려는 [도메인 이름]을 클릭하고 [도메인 이름 DNS 관리] 페이지에서 [기록 추가] 버튼을 클릭하여 도메인 이름에 A 기록을 추가하고 다음 내용을 입력합니다.
  - 기록 유형: `A 기록`
  - 호스트 기록: 즉, 도메인 이름 접두사. 이 예제는 모든 접두사를 예로 하고 있으며 `*.qcloudtest.com`으로 설정합니다.
  - 회선 유형: 기본값
  - 기록값: [클라우드 리소스 연결]을 클릭하여 팜업창에서 방금 생성한 `clb-test`를 선택합니다.
  - TTL: 기본값 `600s`로 설정.
  - 추가 완료 후 [저장]을 클릭합니다.

CDNS(클라우드 도메인 이름 서비스)가 인터넷을 통해 레코드를 전송하는 데는 어느 정도 시간이 걸립니다. 도메인 이름이 정상적으로 해석하고 있는지를 테스트하려면 해석 레코드가 얼마 동안 추가된 경우 바인딩된 CNAME 도메인 이름(예: www.qcloudtest.com)에 직접 액세스 할 수 있습니다. 이 방법으로 CLB를 검증할 수 있습니다.

## 5. 리디렉션 기능 구성(선택 가능)
리디렉션 구성은 수동과 자동 두 가지로 나뉩니다.
- 자동 리디렉션(강제 HTTPS): PC, 휴대폰 웹 브라우저 등 HTTP 요청으로 Web 서비스를 접근하는 경우, CLB에 의해 프록시 후 HTTPS의 응답을 반환하시길 원합니다. 기본적으로 웹 브라우저는 HTTPS로 홈페이지에 접근하도록 강제합니다/
- 사용자 지정 리디렉션: 웹 비즈니스가 임시적으로 오프라인해야 할 경우(예: 전자 상거래 매진, 페이지 유지보수 및 업데이트/업그레이드), 리디렉션 기능이 필요합니다. 그렇지 않으면 사용자의 즐겨찾기 및 검색 엔진 데이터베이스의 이전 주소에서 오류 코드 “404”, “503”만 표시되어 사용자 경험을 낮추고 추가적인 트래픽 손실을 초래합니다. 게다가, 이전에 해당 페이지가 누적한 검색 엔진 점수도 괜히 낭비됩니다.
세부 정보는 [리디렉션 구성](https://cloud.tencent.com/document/product/214/8839)을 참조하십시오.
