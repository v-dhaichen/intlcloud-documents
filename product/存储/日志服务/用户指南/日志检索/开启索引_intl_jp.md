CLSは、ビジネス上の問題を迅速に特定するのに役立つリアルタイムのログ照合機能を提供します。ログを検索する前に、インデックスを構成してインデックスを有効にする必要があります。

## 検索原理

ログ検索はログコンテンツのキーワードに基づいており、ログコンテンツのキーワードをユーザーによって入力された情報と一致させます。ユーザーは区切り文字をカスタマイズし、大文字と小文字を区別するかどうかを選択することで、ビジネスシナリオの特定のニーズに応じてキーワードを柔軟に調整できます。区切り文字と大文字と小文字の区別の概念を紹介するために、例としてユーザーのログコンテンツを見てみましょう。

```
10002345987;write;ERROR;code=400;topic does not exist;
```

### 区切り文字

元のログのテキストは、検索を容易にするために区切り文字を使用して複数のキーワードに分割することができます。

- ユーザーが区切り文字を `; =`に設定すると、ログコンテンツは6つの単語（`10002345987`、` write`、 `ERROR`、` code`、 `400`、` topic does not exist`）に分割されます。正確な検索では、ユーザーは任意の単語を入力するだけでこのログコンテンツを検索できます。
- 区切り文字がNULLに設定されている場合は、ログ全体が一つの単語と見なされます。正確な検索では、ユーザーは完全な単語を入力しないと、このログを検索することができません。

### 大文字と小文字を区別します

大文字と小文字の区別は、文字列内の大文字と小文字の正確な区別を指します。例えば、区切り文字が `; =`の場合、次のようになります。

- 大文字と小文字の区別を有効にすることを選択した場合、`error`を入力してこのログを検索することはできません。なぜなら`error`と`ERROR`は異なるキーワードとして扱われるからです。

- 大文字と小文字の区別が無効になっている場合は、`error`、`Error`または`ERROR`を入力して、このログを見つけることができます。

## インデックスを有効にします

インデックスはログトピックのオプション機能であり、最初に照合するログトピックを選択してからインデックス機能を有効にします。具体的な手順は次のとおりです。

1.[CLSコンソール](https://console.cloud.tencent.com/cls)にログインしてください。
2.左側のログセット管理を選択し、ターゲットログセット、ログトピックに順番に移動します。
3.ログトピックタブで、**インデックス構成**を選択します。
4.必要に応じてフルテキストインデックスまたはキー値インデックスを有効にし、大文字と小文字が区別されるか（デフォルトではチェックされない）、区切り文字（デフォルト区切り文字：： `, "';=()[]{}?@&<>/:\n\t\r`）があるかを確認します。
5.【保存】をクリックしてインデックス構成を完了します。

> **注：**
> ログトピックが作成された後、デフォルトではインデックスでは有効になっていないので、手動で有効にする必要があります。

## インデックスタイプ

### フルテキスト

CLSは完全な単一ログをテキストとして照合します。フルテキストインデックスを有効にした後は、キーワード情報に基づいてログ検索を行います。ユーザーはフルテキストの区切り文字をカスタマイズすることもでき、元のログテキストは区切り文字に従って複数のキーワードに分割され、ユーザーが検索しやすくなります。
![](https://main.qcloudimg.com/raw/2c9d0b1ee437cc4bb519e10dbba71c97.png)

フルテキスト区切り文字の機能特性をより直感的に説明するために、以下は部分検索の例です。

| フルテキスト区切り文字 | 正確な検索                                                     | あいまい検索                  |
| ---------- | ------------------------------------------------------------ | ------------------------- |
| Null に設定します   |  “10002345987;write;error;code=400;topic does not exist;”を入力します | "10002345987*"を入力します        |
| ;          | "code = 400"または"topic does not exist"を入力します                     | "code = 40？"または"code *"を入力します |
| ;=         | "code"または"400"または“code=400”を入力します                        | "topic*"または"40?”を入力します     |
| ;  =       | “topic"または"does"または"not"または"exist”を入力します                    | "do*"を入力します                |

### キー値インデックス

CLSは、収集の構成に設定されたkeyに従ってキー値インデックス構成を実行することができ、キー値インデックス構成では、インデックス要件に従って対応するkeyが入力され、データタイプが指定されます。text、long、doubleのデータータイプがサポートされています。そのうち、textのデータタイプはカスタムの区切り文字をサポートしており、ユーザーはkeyごとに異なる区切り文字を設定できます。
![](https://main.qcloudimg.com/raw/c65aa983cedb1bf2439cba5a8d85a2de.png)

## データタイプ

CLSは、次の3つのフィールドタイプをサポートしています。

| 名前   | タイプ説明                 |
| ------ | :----------------------- |
| text   | テキストタイプ                 |
| long   | 整数型（Int 64）   |
| double | 浮動小数点数（64ビット） |

## 注意事項

1.インデックスが無効になっている間に収集されたログデータが検索されません。
2.インデックスが有効になった後、ログは収集された直後に検索されます。
3.データ保存時間はログセットと同じです。
4.ログトピックが複数回有効化および無効化されると、有効化期間中のログデータを検索することができます。

