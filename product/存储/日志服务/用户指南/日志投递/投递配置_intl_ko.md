## 소개
CLS는 COS에 로그를 배달하는 기능을 제공하여 사용자가 로그 데이터를 지속적으로 유지할 수 있도록 지원합니다. 콘솔에서 관련 구성을 완료하면 시간 간격, 파일 크기, 배달 경로 및 필터링 규칙에 따라 로그를 COS로 배달할 수 있습니다. 

## 프로세스
### 전제 조건

1. CLS를 활성화하고 로그 집합 및 로그 토픽을 생성하면 로그 데이터를 성공적으로 캡처할 수 있습니다.
2. Tencent Cloud COS를 활성화하고 배달 대기 로그 집합의 지역에 버킷을 이미 생성하였습니다.
3. 현재 작업 계정에 배달을 구성할 수 있는 권한이 있는지 확인하십시오. 서브 계정/협력자 배달 권한 문제는 [서브 계정 구성 배달](https://cloud.tencent.com/document/product/614/33098)을 참조하십시오.

### 설정 절차
1. [CLS 콘솔](https://console.cloud.tencent.com/cls)에 로그인합니다.
2. 왼쪽 탐색 모음에서 [로그 집합 관리]를 클릭합니다.
3. 배달 태스크를 설정할 로그 집합 ID/이름을 클릭하여 로그 집합 세부 정보 페이지로 이동합니다.
![](https://main.qcloudimg.com/raw/b4560b57c179e20441fa56bd65803971.png)
4. 배달할 로그 토픽을 찾아 [구성 관리] > [COS 구성 배달]을 클릭하여 배달 구성 페이지로 이동하십시오.
![](https://main.qcloudimg.com/raw/df645d270b696a380253435e079a8949.png)
5. [배달 구성 추가]를 클릭하고 **COS에 배달** 구성 페이지로 이동하여 구성 정보를 차례로 입력하고 [다음]을 클릭합니다. 구성 항목에 대한 자세한 내용은 [구성 항목 설명](#config)을 참조하십시오.
![](https://main.qcloudimg.com/raw/c588bcb6e91bb9849003532968edac44.png)
6. 고급 구성으로 이동하여 배달 형식, 압축 배달 여부, 압축 형식 및 배달 필터링을 선택하십시오.
json 배달 형식을 선택하면 다음 그림의 정보가 구성됩니다.
![](https://main.qcloudimg.com/raw/3711401cfd70d3f583bb82dae1970331.png)
csv 배달 형식을 선택한 경우 key 내용, 구분 기호, 이스케이프 문자, 잘못된 필드 내용, key 첫 행을 쓸지 여부 등을 지정해야 합니다.
![](https://main.qcloudimg.com/raw/a83f64cd3434e7fd894249e4dea0eb10.png)
 - key: csv 파일에 쓸 key 필드.
 - 구분 기호: csv 파일의 필드 사이에 쓰는 구분 기호.
 - 이스케이프 문자: 구분 기호가 있는 문자가 일반적인 필드에 나타나면 이스케이프 문자로 해당 필드를 포장합니다.
 - 잘못된 필드 내용: 구성된 csv 키 값 필드가 잘못된 key인 경우 잘못된 필드로 채워집니다.
 - key 첫 행 쓰기: 키 값 이름(key)의 첫 행을 csv 파일에 입력합니다. 이 행은 기본적으로 입력하지 않습니다.
7. 마지막으로 배달 상태가 사용 가능한지 확인하십시오.
![](https://main.qcloudimg.com/raw/14e70eec382e5dab3803a71752ffd62c.png)

<a id="config"></a>
### 구성 항목 설명
#### 디렉터리 접두사(선택 가능)
CLS는 사용자 지정 디렉터리 접두사를 지원합니다. 로그 파일은 COS 버킷의 해당 디렉터리로 배달됩니다. 현재는 기본적으로 버킷에 배달합니다. 파일 경로는 `{COS 버킷}{디렉터리 접두사}{파티션 형식}_{random}_{index}.{type}`이고 그 중 `{random}_{index}`은 하나의 난수입니다.

#### 파티션 형식(필수)
배달 작업 작성 시간은 strftime 구문에 따라 디렉터리를 자동으로 생성합니다. 여기서 `/`는 첫 번째 레벨 COS 디렉토리를 나타냅니다. bucket_test 버킷으로, 디렉터리 접두사는`logset /`이고, 배달 시간은 2018/7/31 17:14의 배달을 예시로 합니다.

| 버킷 이름  | 디렉터리 접두사 | 파티션 형식    | cos 파일 경로                                       |
| ----------- | -------- | ----------- | ------------------------------------------------- |
| bucket_test | logset/ | %Y/%m/%d    | bucket\_test:logset/2018/7/31\_{random}\_{index}    |
| bucket_test | logset/ | %Y%m%d/%H  | bucket\_test:logset/20180731/14\_{random}\_{index} |
| bucket_test | logset/ | %Y%m%d/log | bucket\_test:logset/20180731/log\_{random}\_{index} |

#### 압축 배달(옵션)
사용자는 배달 전에 로그 파일을 압축할 수 있습니다. 압축되지 않은 파일의 크기는 10GB로 제한됩니다. gzip 및 lzop 압축 방식을 지원합니다.

#### 배달 파일 크기(필수)
해당 배달 시간 간격의 **압축되지 않은 배달 파일**의 최대 크기, 해당 시간 간격에서 로그 파일의 최대 크기를 지정합니다. 이 크기보다 큰 파일은 여러 로그 파일로 분할됩니다. 지원되는 최대 크기는 **100MB ~ 10GB**입니다. 

#### 배달 간격 시간(필수)
배달 시간 간격을 지정하십시오. **1분 ~ 1시간**을 지원합니다. 5분으로 설정하면 로그 데이터에서 5분마다 로그 파일이 생성되고 여러 로그 파일은 정기적(30분 이내)으로 버킷에 함께 배달됩니다. 


#### 고급 옵션(옵션)
또한 로그 배달을 사용하면 로그 내용을 기반으로 필터링 배달할 수 있습니다. 고급 옵션 탭에서 구성할 수 있습니다. key를 지정하고 이 키 값에 해당하는 값을 정규식으로 추출한 다음 추출된 값과 일치하도록 값을 설정할 수 있습니다. 로그 데이터가 사용자의 구성과 일치할 때만 로그를 배달할 수 있습니다. 일치하지 않는 로그는 배달되지 않습니다. 아래 그림과 같이 action 필드를 지정합니다. 해당 필드가 write일 경우 로그가 배달됩니다. 최대 5개의 배달 필터링 규칙을 지원합니다. 
![](https://main.qcloudimg.com/raw/fa774d5a865c2129f707465c55e416c7.png)

>!단일 행의 전체 텍스트 및 다중 행의 전체 텍스트에서 로그 검색의 경우 기본 key값은 **\_CONTENT_**입니다.

