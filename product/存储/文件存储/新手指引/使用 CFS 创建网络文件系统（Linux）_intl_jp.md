

## 一、CVMインスタンスの作成と構成
ファイルシステムにアクセスするには、ファイルシステムをLinuxまたはWindowsをOSとするTencent Cloud CVMインスタンスにマウントする必要があります。このステップで、LinuxをOSとするTencent Cloud CVMインスタンスを作成、構成します。WindowsをOSとするCVMを利用したい場合、ドキュメント[CFSでネットワークファイルシステム（Windows）](/doc/product/582/11524)をご覧ください。CVMインスタンスを作成した場合、ステップ2[ファイルシステムとマウントポイントの作成](#1)に進んでください。

Tencent Cloud公式サイトにログインし、【クラウド製品】>【計算とネットワーク】>【CVM】を選択し、【今すぐ購入する】をクリックすると、[CVM購入画面](https://buy.cloud.tencent.com/buy/cvm)に入ります。
### 1.地域と機種の選択
![](//mc.qcloudimg.com/static/img/3ed8bab8cce3dde578a6e3fb14267ea5/image.png)
- 課金モードの選択。年額/月額または従量制課金（従量制課金CVMを購入できないユーザーはまず[実名認証](https://console.cloud.tencent.com/developer/auth)をしてください）。詳細について[課金モード説明](/doc/product/213/2180)をご覧ください。
- 地域とAvailability Zoneの選択。複数CVMが必要とされる場合、異なるAvailability Zoneを選択すると障害復旧効果を果たします。
- 機種と構成の選択。インスタンスタイプの詳細説明について、[インスタンスタイプの概要](/doc/product/213/7153)をご覧ください。


### 2.イメージの選択
![](//mc.qcloudimg.com/static/img/fd40922e47525453a58de73d0ffa266c/image.png)
- イメージ提供者の選択。Tencent Cloudは、パブリックイメージ、カスタムイメージ、共有イメージ、サービスマーケットを提供します。[イメージのタイプ](/doc/product/213/4941)を参照して選択できます。Tencent Cloudを使い始めたばかりのユーザーの場合は、パブリックイメージの選択をおすすめします。
- OSの選択。Tencent Cloudは、CentOS、CoreOS、Debian、FreeBSD、OpenSUSE、SUSE、Ubuntu等のOSを提供します。その後の動作環境はユーザーより構築します。
システムのバージョンの選択。 

### 3.ストレージとネットワークの選択
![](//mc.qcloudimg.com/static/img/e95a5bf7bf47c60f43dd0ee62946b67a/image.png)
- ディスク種類とデータディスクのサイズの選択。
Tencent Cloudは、クラウドディスクとローカルディスクの2種類（デフォルトは50 GBのシステムディスク。システムディスクのサイズは任意選択）を提供します。
  - クラウドディスク：1ディスク3バックアップの分散型ストレージ方式を採用し、データの信頼性が高い。
  - ローカルディスク：CVMの所属物理マシンにあるストレージデバイスであり、低い時間遅延を得るが、単一障害点が発生するおそれがあります。詳細について[製品分類](/doc/product/362/2353)を参照してください。
- ネットワーク種類の選択。
Tencent Cloudは、基本ネットワークまたはVPCを選択可能な項目として提供します。
 - 基本ネットワーク：初心者ユーザーに適します。同一のユーザーのCVMがプライベートネットワークで接続可能です。
 - VPC：高級ユーザーに適します。異なるVPC間には論理的に分離します。
- パブリックネットワーク帯域幅の選択。
Tencent Cloudは、帯域幅課金または従量制課金の2種類を提供します。
 - 帯域幅課金：固定帯域幅を選択する際に、この帯域幅を超えるとパケットロスが発生します。ネットワークの変動が小さいシナリオに適します。
 - 従量制課金：実際のトラフィックによって課金します。ピーク帯域幅を制限して予想外のトラフィックによる費用を回避し、瞬間的な帯域幅がこの数値を超えた場合パケットロスが発生します。ネットワークの変動が大きいシナリオに適します。
- サーバー数量の選択。
- 購入期間と更新方式の選択（年額/月額支払CVMのみ）。

### 4.情報の設定
![](//mc.qcloudimg.com/static/img/1c463db6e3b31abd6c1d3163f1c3108f/image.png)
- CVMの名前付け：作成後名前付けまたは今すぐ名前付けを選択できます。
- ログイン情報の設定：
 - パスワードの設定：CVMパスワードを入力します。
 - 暗号鍵の関連付け：SSH暗号鍵を関連付けます。暗号鍵がないか今の暗号鍵が不適切であれば、【今すぐ作成する】ボタンをクリックして作成します。[暗号鍵の作成](/doc/product/213/516#1)ガイドラインを参照してください。他のSSH暗号鍵について[SSH暗号鍵](/doc/product/213/503)を参照してください。
 - パスワードの自動生成：自動生成したパスワードはサイト内メッセージで送信されます。
- セキュリティグループの選択（**ログインポート22の開放を確保してください**、その他の情報について[セキュリティグループ](/doc/product/213/5221)をご覧ください）。

【今すぐ購入する】ボタンをクリックして、支払いを完了すると[コンソール](https://console.cloud.tencent.com/cvm/)に入り、あなたのCVMを確認します。
CVM作成後、サイト内メッセージ（インスタンス名称、パブリックネットワークIP、プライベートネットワークIP、ログイン名、初期ログインパスワード等の情報が含まれる）を受信します。それらの情報を使ってインスタンスにログインして管理します。
 

<span id="1"></span>
## 二、ファイルシステムとマウントポイントの作成

1.Tencent Cloud[コンソール](https://console.cloud.tencent.com/)に入り、【クラウド製品】>【ストレージ】>【ファイルストレージ】をクリックすると、CFSコンソールに入ることができます。
![](//mc.qcloudimg.com/static/img/4fee6ea61cfba11927f6891527237610/image.png)

2.Tencent Cloud CFSコンソールで【新規作成】をクリックすると、ファイルシステム作成ウィンドウが表示されます。ファイルシステム作成ポップアップウィンドに関連情報を入力して、確認した後、【OK】をクリックするとファイルシステムを作成することができます。
![](https://main.qcloudimg.com/raw/3797c04469bf0da994d2e2876a2a39ad.png)
 - 名称：作成したファイルシステムを名前付けることができます。
 - 地域とAvailability Zone：あなたのお客様に近い地域ではアクセス遅延を低減し、ダウンロード速度を向上します。
 -ファイルプロトコル：NFS（Linux、Unixクライアントに最適)、CIFS/SMB（Windowsクライアントに最適）。
 - ネットワーク種類：Tencent Cloudは、基本ネットワークまたはVPCを選択可能な項目として提供します。基本ネットワークは初心者ユーザーに適し、同一のユーザーのCVMがプライベートネットワークで接続可能です。VPCは高級ユーザーに適し、異なるVPC間には論理的に分離します。
  	
 > **注意：**
 > あなたのCVMインスタンスの所属ネットワークによってファイルシステムを作成してマウントしてください。
 > - VPCでCVMのファイルシステムを共有したい場合、ファイルシステムを作成する際にVPCを選択する必要があります。ファイルシステムがVPCであり、特殊ネットワークの設定を実行しない場合、同一のVPC内のCVMインスタンスはマウントできます。
 > - 基本ネットワークでCVMのファイルシステムを共有したい場合、ファイルシステムを作成する際に基本ネットワークを選択する必要があります。ファイルシステムが基本ネットワークであり、特殊ネットワークの設定を実行しない場合、同じ基本ネットワーク内のCVMインスタンスはマウントできます。
 > - 複数のネットワーク共有ファイルシステムが必要とされる場合、[Availability Zone間、ネットワーク間アクセスガイド](/doc/product/582/9764)をご覧ください。

3.マウントポイント情報の取得。ファイルシステムとマウントポイントが作成した後、インスタンスIDをクリックしてファイルシステムの詳細に入り、【マウントポイント情報】をクリックして、Linuxでのマウントコマンドを取得します。

NFSファイルシステムマウントポイント情報は以下の通りです。
![](https://mc.qcloudimg.com/static/img/f50435216defb4083874bc78d568001e/image.png)

CIFS/SMBファイルシステムマウントポイント情報は以下の通りです。 
![](https://main.qcloudimg.com/raw/939aafe4bca9907bc391d41e8798c4a6.png)



## 三、インスタンスの接続
この部分はLinux CVMの通常ログイン方法を説明します。場合によって異なるログイン方法を選択できます。ここではコンソールのログインを説明します。その他のログイン方法について[Linuxインスタンスへのログイン](/doc/product/213/5436)をご覧ください。

**前提条件**
CVMにログインする際に、管理者のアカウントとパスワードを使う必要があります。
 - 管理者アカウント：Linuxタイプのインスタンスの場合、管理者アカウントをroot（Ubuntuシステムユーザーの場合、ubuntuとする）に統一します。
 - パスワード：パスワードはCVMを購入した際に設定したパスワードです。

**コンソールでのCVMログイン**
- CVMリストの操作列で、【ログイン】ボタンをクリックするとVNCを通じてLinux CVMに接続します。
![](//mc.qcloudimg.com/static/img/73cc4f9f702f80d95717c7a35063ab41/image.png)
- アカウント（root、Ubuntuシステムユーザーの場合、ubuntuとする）とパスワードを入力するとログインします。

>**注意：**
>この端末は専有型で、同一のタイミングで1人のユーザーだけコンソールでログインできます。


**ネットワーク通信の検証**
マウント前は、クライアントとファイルシステムのネットワーク到達性を確認する必要があります。telnetコマンドを通じて検証することができ、詳細なプロトコルとクライアント指定開放ポートの情報は以下の通りです。

ファイルシステムプロトコル | クライアント開放ポート | ネットワーク接続性の確認
------- | ------- | ---------
NFS 3.0 | 111、892、2049 |  telnet 111または892または2049
NFS 4.0 | 2049 |  telnet 2049
CIFS/SMB | 445 |  telnet 445 

注：CFSはpingをサポートしません。

## 四、ファイルシステムのマウント
### NFSファイルシステムのマウント

#### 1.NFSクライアントの起動
マウント前、システムに`nfs-utils`または`nfs-common`がインストールされたか確認してください。インストール方法は以下の通りです。
- CentOS：
```
sudo yum install nfs-utils
```
- UbuntuまたはDebian：
```
sudo apt-get install nfs-common
```

#### 2.マウント対象ディレクトリの作成
次のコマンドを用いてマウント対象ディレクトリを作成します。
```
mkdir <マウント対象ディレクトリ>
```
例：
```
mkdir /local/
mkdir /local/test
```

#### 3.マウント
**NFS v4.0のマウント**
次のコマンドを用いてNFS v4.0のマウントを実行します。
```
sudo mount -t nfs -o vers=4 <マウントポイントIP>:/ <マウント対象ディレクトリ>
```
- マウントポイントIP：ファイルシステムを作成する際に、自動的に生成したマウントポイントIP。
- 現在デフォルトでマウントされるのはファイルシステムのルートディレクトリ "/"です。ファイルシステムでサブディレクトリを作成した後、このサブディレクトリをマウントすることができる。
- マウント対象ディレクトリ：現在のサーバーでマウントする対象ディレクトリは、ユーザーより事前に作成する必要があります。

> **注意：**
> `<マウントポイントIP>:/`と`<マウント対象ディレクトリ>`の間に1つのスペースを入れます。


例：
- CFSルートディレクトリのマウント：
```
sudo mount -t nfs -o vers=4 10.0.0.1:/ /local/test
```
- CFSサブディレクトリsubfolderのマウント：
```
sudo mount -t nfs -o vers=4 10.10.19.12:/subfolder /local/test
```

 ![](https://mc.qcloudimg.com/static/img/03550214c0499438e86cfd64b3c377b8/image.png)

**NFS v3.0のマウント**
次のコマンドを用いてNFS v3.0のマウントを実行します。
```
sudo mount -t nfs -o vers=3,nolock,proto=tcp <マウントポイントIP>:/<FSID> <マウント対象ディレクトリ>
```
- マウントポイントIP：ファイルシステムを作成する際に、自動的に生成したマウントポイントIP。
- NFS v3.0はサブディレクトリのマウントのみをサポートします。デフォルトのファイルシステムのサブディレクトリはFSIDです。
- マウント対象ディレクトリ：現在のサーバーでマウントする対象ディレクトリは、ユーザーより事前に作成する必要があります。
例

> **注意：**
> `<マウントポイントIP>:/`と`<マウント対象ディレクトリ>`の間に1つのスペースを入れます。


例：
- CFSサブディレクトリsubfolderのマウント：
```
mount -t nfs -o vers=3,nolock,proto=tcp 10.10.19.12:/z3r6k95r /local/test
```
![](https://mc.qcloudimg.com/static/img/03550214c0499438e86cfd64b3c377b8/image.png)

#### 4.マウントポイント情報の表示
マウント完了後、次のコマンドを用いてマウントされたファイルシステムを表示します。
```
mount -l
```
該当ファイルシステムの容量情報を表示するには、次のコマンドも使用できます。
```
df -h
```
### CIFS/SMBファイルシステムのマウント
#### 1.CIFSクライアントの起動
マウント前、システムに`cifs-utils`がインストールされたか確認してください。インストール方法は以下の通りです。
CentOS：
```
sudo yum install cifs-utils.x86_64 –y
```


#### 2.マウント対象ディレクトリの作成
次のコマンドを用いてマウント対象ディレクトリを作成します。
```
mkdir <マウント対象ディレクトリ>
```
例：
```
mkdir /local/
mkdir /local/test
```

#### 3.マウント
次のコマンドを用いてCIFSのマウントを実行します。
```
mount -t cifs -o guest //<マウントポイントIP>/<FSID> /<マウント対象ディレクトリ>
```
- マウントポイントIP：ファイルシステムを作成する際に、自動的に生成したマウントポイントIP。
- 現在デフォルトでファイルシステムのFSIDがマウントに使用されます。 
- マウント対象ディレクトリ：現在のサーバーでマウントする対象ディレクトリは、ユーザーより事前に作成する必要があります。

> **注意：**
> `<FSID>`と`/<マウント対象ディレクトリ>`の間に1つのスペースを入れます。

例：

```
mount -t cifs -o guest //10.66.168.75/vj3i1135  /local/test
```

 ![](https://main.qcloudimg.com/raw/939aafe4bca9907bc391d41e8798c4a6.png)

#### 4.マウントポイント情報の表示
マウント完了後、次のコマンドを用いてマウントされたファイルシステムを表示します。
```
mount -l
```
該当ファイルシステムの容量情報を表示するには、次のコマンドも使用できます。
```
df -h
```

### 5.共有ディレクトリのマウント解除
共有ディレクトリをマウント解除する場合、次のコマンドを使ってください。その「ディレクトリ名称」はルートディレクトリまたはファイルシステムのフルパスです。
```
umount <ディレクトリ名称>
```

例： 
```
umount /local/test
```


## 五、リソースの終了
Tencent CloudコンソールでCVMインスタンスとファイルシステムを容易に終了できます。実際的には、無駄な課金を避けるため、もう使用しようとしないリソースを終了することをおすすめします。
1.Tencent Cloudインスタンスの終了。Tencent Cloud CVM[コンソール](https://console.cloud.tencent.com/cvm/index)に進み、終了しようとするインスタンスを選択し、【その他】>【CVMステータス】をクリックし、【終了】を選択するとCVMインスタンスを終了します。
![](//mc.qcloudimg.com/static/img/76c588284e3b525702d748b5cd7b8b00/image.png)
2.ファイルシステムの終了。Tencent Cloudファイルストレージ[コンソール](https://console.cloud.tencent.com/cfs)に進み、終了しようとするファイルシステムを選択し、【削除】をクリックして【確認】をクリックするとファイルシステムを削除します。
![](//mc.qcloudimg.com/static/img/28cade4807a283ffdcb1fc2a39a7ad88/image.png)



