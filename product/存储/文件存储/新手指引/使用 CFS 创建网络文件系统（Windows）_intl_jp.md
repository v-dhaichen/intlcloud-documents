
## 一、CVMインスタンスの作成と構成
ファイルシステムにアクセスするには、ファイルシステムをLinuxまたはWindowsをOSとするTencent Cloud CVMインスタンスにマウントする必要があります。このステップで、WindowsをOSとするTencent Cloud CVMインスタンスを作成、構成します。LinuxをOSとするCVMを利用したい場合、ドキュメント[CFSでネットワークファイルシステム（Linux）](/doc/product/582/11523)をご覧ください。CVMインスタンスを作成した場合、ステップ2[ファイルシステムとマウントポイントの作成](#1)に進んでください。

Tencent Cloud公式サイトにログインし、【クラウド製品】>【計算とネットワーク】>【CVM】を選択し、【今すぐ購入する】をクリックすると、[CVM購入画面](https://buy.cloud.tencent.com/buy/cvm)に入ります。

### 1.地域と機種の選択
![](//mc.qcloudimg.com/static/img/3ed8bab8cce3dde578a6e3fb14267ea5/image.png)
- 課金モードの選択：年額/月額または従量制課金（従量制課金CVMを購入できないユーザーはまず[実名認証](https://console.cloud.tencent.com/developer/auth)をしてください）。詳細について[課金モード説明](/doc/product/213/2180)をご覧ください。
- 地域とAvailability Zoneの選択。複数CVMが必要とされる場合、異なるAvailability Zoneを選択すると障害復旧効果を果たします。
- 機種と構成の選択。インスタンスタイプの詳細説明について、[インスタンスタイプの概要](/doc/product/213/7153)をご覧ください。

### 2.イメージの選択
![](//mc.qcloudimg.com/static/img/56c4ecbdb12dd0a366ecf701153fce1d/image.png)
- イメージ提供者の選択。
Tencent Cloudは、パブリックイメージ、カスタムイメージ、共有イメージ、サービスマーケットを提供します。[イメージのタイプ](/doc/product/213/4941)ドキュメントを参照して選択できます。Tencent Cloudを使い始めたばかりのユーザーの場合は、パブリックイメージの選択をおすすめします。その中には正規品のWindows OSを搭載し、その後の動作環境はユーザーより構築します。
- OSの選択：WindowsServerを選択します。
- システムのバージョンの選択。

### 3.ストレージとネットワークの選択
![](//mc.qcloudimg.com/static/img/e95a5bf7bf47c60f43dd0ee62946b67a/image.png)
- ディスク種類とデータディスクのサイズの選択。
Tencent Cloudは、クラウドディスクとローカルディスクの2種類（デフォルトは50 GBのシステムディスク。システムディスクのサイズは任意選択）を提供します。
 - クラウドディスク：1ディスク3バックアップの分散型ストレージ方式を採用し、データの信頼性が高い。
 - ローカルディスク：CVMの所属物理マシンにあるストレージデバイスであり、低い時間遅延を得るが、単一障害点が発生するおそれがあります。詳細について[製品分類](/doc/product/362/2353)を参照してください。
- ネットワーク種類の選択。
Tencent Cloudは、基本ネットワークまたはVPCを選択可能な項目として提供します。
 - 基本ネットワーク：初心者ユーザーに適します。同一のユーザーのCVMがプライベートネットワークで接続可能です。
 - VPC：高級ユーザーに適します。異なるVPC間には論理的に分離します。
- パブリックネットワーク帯域幅の選択。
Tencent Cloudは、帯域幅課金または従量制課金の2種類を提供します。
 - 帯域幅課金：固定帯域幅を選択する際に、この帯域幅を超えるとパケットロスが発生します。ネットワークの変動が小さいシナリオに適します。
 - 従量制課金：実際のトラフィックによって課金します。ピーク帯域幅を制限して予想外のトラフィックによる費用を回避し、瞬間的な帯域幅がこの数値を超えた場合パケットロスが発生します。ネットワークの変動が大きいシナリオに適します。
- サーバー数量の選択。
- 購入期間と更新方式の選択（年額/月額支払CVMのみ）。

### 4.情報の設定
![](//mc.qcloudimg.com/static/img/fbc4230b5e6a19ef6ec60ffebfc62aaa/image.png)
- CVMの名前付け：作成後名前付けまたは今すぐ名前付けを選択できます。
- ログイン情報の設定：パスワードを設定するか、自動的に生成することもできます。設定したパスワードは作成した後に変更できます。自動的に生成したパスワードはサイト内メッセージで送信します。
- セキュリティグループの選択（**ログインポート3389の開放を確保してください**、その他の情報について[セキュリティグループ](/doc/product/213/5221)をご覧ください）。

【今すぐ購入する】ボタンをクリックして、支払いを完了すると[コンソール](https://console.cloud.tencent.com/cvm)に入り、あなたのCVMを確認します。
CVM作成後、サイト内メッセージ（インスタンス名称、パブリックネットワークIP、プライベートネットワークIP、ログイン名、初期ログインパスワード等の情報が含まれる）を受信します。それらの情報を使ってインスタンスにログインして管理します。
 

<span id="1"></span>
## 二、ファイルシステムとマウントポイントの作成

1.Tencent Cloud[コンソール](https://console.cloud.tencent.com/)に入り、【クラウド製品】>【ストレージ】>【ファイルストレージ】をクリックすると、CFSコンソールに入ることができます。
![](//mc.qcloudimg.com/static/img/4fee6ea61cfba11927f6891527237610/image.png)

2.Tencent Cloud CFSコンソールで【新規作成】をクリックすると、ファイルシステム作成ウィンドウが表示されます。ファイルシステム作成ポップアップウィンドに関連情報を入力して、確認した後、【OK】をクリックするとファイルシステムを作成することができます。 
 ![](https://main.qcloudimg.com/raw/3797c04469bf0da994d2e2876a2a39ad.png)  
 - 名称：作成したファイルシステムを名前付けることができます。  
 - 地域とAvailability Zone：あなたのお客様に近い地域ではアクセス遅延を低減し、ダウンロード速度を向上します。  
 - ファイルプロトコル：NFS（Linux、Unixクライアントに最適)、CIFS/SMB（Windowsクライアントに最適）。  
 - ネットワーク種類：Tencent Cloudは、基本ネットワークまたはVPCを選択可能な項目として提供します。基本ネットワークは初心者ユーザーに適し、同一のユーザーのCVMがプライベートネットワークで接続可能です。VPCは高級ユーザーに適し、異なるVPC間には論理的に分離します。  
  	
 > **注意：**
 > あなたのCVMインスタンスの所属ネットワークによってファイルシステムを作成してマウントしてください。
 > - VPCでCVMのファイルシステムを共有したい場合、ファイルシステムを作成する際にVPCを選択する必要があります。ファイルシステムがVPCであり、特殊ネットワークの設定を実行しない場合、同一のVPC内のCVMインスタンスはマウントできます。
 > - 基本ネットワークでCVMのファイルシステムを共有したい場合、ファイルシステムを作成する際に基本ネットワークを選択する必要があります。ファイルシステムが基本ネットワークであり、特殊ネットワークの設定を実行しない場合、同じ基本ネットワーク内のCVMインスタンスはマウントできます。
 > - 複数のネットワーク共有ファイルシステムが必要とされる場合、[Availability Zone間、ネットワーク間アクセスガイド](/doc/product/582/9764)をご覧ください。

3.マウントポイント情報の取得。ファイルシステムとマウントポイントを作成した後、インスタンスIDをクリックしてファイルシステムの詳細に入り、【マウントポイント情報】をクリックして、Windowsでのマウントコマンドを取得します。

NFSファイルシステムマウントポイント情報は以下の通りです。
![](https://mc.qcloudimg.com/static/img/f50435216defb4083874bc78d568001e/image.png)

CIFS/SMBファイルシステムマウントポイント情報は以下の通りです。 
![](https://main.qcloudimg.com/raw/939aafe4bca9907bc391d41e8798c4a6.png)



## 三、インスタンスの接続
この部分はWindows CVMの通常ログイン方法を説明します。場合によって異なるログイン方法を選択できます。ここではコンソールのログインを説明します。その他のログイン方法について[Windowsインスタンスへのログイン](/doc/product/213/5435)をご覧ください。

**前提条件**
CVMにログインする際に、管理者のアカウントとパスワードを使う必要があります。
- 管理者アカウント：Windowsタイプのインスタンスの場合、管理者アカウントをAdministratorに統一します。
- パスワード：パスワードはCVMを購入した際に設定したパスワードです。
   
**コンソールでのCVMログイン**
1.CVMリストの操作列で、【ログイン】ボタンをクリックするとVNCを通じてWindows CVMに接続します。
![](//mc.qcloudimg.com/static/img/d017c67c9f447c1441cf74ed4ac2b279/image.png)
2.左上をクリックすることで【Ctrl-Alt-Delete】コマンドを送信してシステムログイン画面に入ります。
![](//mc.qcloudimg.com/static/img/e4dbc02ca9ae2a7cb9ada5316effd31a/image.png)
3.アカウント（Administrator）とパスワードを入力するとログインできます。

>**注意：**
>この端末は専有型で、同一のタイミングで1人のユーザーだけコンソールでログインできます。


**ネットワーク通信の検証**
マウント前は、クライアントとファイルシステムのネットワーク到達性を確認する必要があります。telnetコマンドを通じて検証することができ、詳細なプロトコルとクライアント指定開放ポートの情報は以下の通りです。

ファイルシステムプロトコル | クライアント開放ポート | ネットワーク接続性の確認
------- | ------- | ---------
NFS 3.0 | 111、892、2049 |  telnet 111または892または2049
NFS 4.0 | 2049 |  telnet 2049
CIFS/SMB | 445 |  telnet 445 

注：CFSはpingをサポートしません。

## 四、ファイルシステムのマウント
### CIFS/SMBファイルシステムのマウント
#### GUIでのファイルシステムのマウント
a.「ネットワークドライブのマッピング」の選択
ファイルシステムのマウントを必要とするWindowsにログインし、「スタート」メニューから「コンピューター」を見つけ、右クリックしてメニューが表示され、メニューの「ネットワークドライブのマッピング」をクリックします。 
![](https://main.qcloudimg.com/raw/515b5b21a19e3f3518c75441326e1800.png)
![](https://main.qcloudimg.com/raw/b0396ce0f8f108f3e89a2f2bfb3d7f71.png)

b.アクセスパスの入力
表示された設定ウィンドウで「ドライブ」名とフォルダ（CIFS/SMBファイルシステムで表示されるマウントディレクトリ）を設定します。
![](https://main.qcloudimg.com/raw/8d58ee713b9e072156caf8019b4242d5.png)
![](https://main.qcloudimg.com/raw/939aafe4bca9907bc391d41e8798c4a6.png)



c.読み書きの検証
確認後、マウントしたファイルシステム画面に進みます。右クリックしてファイルを新規作成して読み書きの正確性を検証します。
![](https://mc.qcloudimg.com/static/img/60b9388885536ec7d81b1cf7f76c39d5/image.png)

#### コマンドラインでのファイルシステムのマウント
FSIDを用いてファイルシステムをマウントしてください。マウントコマンドは以下の通りです。
```
net use <共有ディレクトリ名>: \\10.10.11.12\FSID 
```
例：
```
net use X: \\10.10.11.12\fjie120
```

> **注意：**
> FSIDは【コンソール】>【ファイルシステム詳細】>【マウントポイント情報】から取得します。
![](https://main.qcloudimg.com/raw/939aafe4bca9907bc391d41e8798c4a6.png)


### NFSファイルシステムのマウント
#### 1.NFSサービスの有効化
マウント前、システムでNFSサービスが有効にされたことを確保してください。ここでWindows Server 2012 R2を例として、NFSサービスを有効にします。
1.1 【コントロールパネル】>【プログラム】>【Windows機能を有効または無効にする】>【サーバーロール】タブで【NFS server】をチェックします。
![](https://mc.qcloudimg.com/static/img/eaeed922e9d1f673e47137d80a88fa70/image.png)
1.2 【コントロールパネル】>【プログラム】>【Windows機能を有効または無効にする】>【特性】タブで【NFSクライアント】をチェックします。【NFSクライアント】をチェックするとWindows NFSクライアントサービスを有効にします。
![](https://mc.qcloudimg.com/static/img/4f9d7ac7b877ceffc5bc2b1d7c050a24/image.png)

#### 2.NFSサービスの起動検証
WindowsでのCLIを開き、パネルで次のコマンドを実行します。NFS関連情報を戻した場合、NFSクライアントが正常に動作していることを示します。
```
mount -h
```
![](https://mc.qcloudimg.com/static/img/4e4f9db217874ccec91ac1f888c8e451/image.png)

#### 3.匿名アクセスユーザーとユーザーグループの追加
3.1 レジストリの開き
コマンドラインウィンドウでregeditコマンドを入力し、Enterキーを押すとレジストリウィンドウを開きます。
![](https://mc.qcloudimg.com/static/img/c9fca9a1b123a5b2dbc69b0ce66d539f/image.png)

3.2 構成アイテムAnonymousUidとAnonymousGidの追加
開いたレジストリから次のパスを見つけて選択します。 
```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ClientForNFS\CurrentVersion\Default
```
右の空白箇所を右クリックして、【new】が表示されます。メニューから【DWORD(32-bit) Value】または【QWORD(64-bit) Value】（OSビット数によって選択する）を選択します。この場合、リストに新しいレコードが表示され、名称欄をAnonymousUidに変更すればOK。データ値はデフォルトの0にします。同様な方法で名称がAnonymousGidのレコードを追加し、データ値はデフォルトの0にします。
![](https://mc.qcloudimg.com/static/img/381cdc3b68fb35be5dcceb2a4c962e33/image.png)
![](https://mc.qcloudimg.com/static/img/80bb0cfbffbed939522459a830df3eac/image.png)

3.3 再起動による構成の発効
レジストリを閉じてWindowsを再起動し、レジストリの変更を完了します。

#### 4.ファイルシステムのマウント
ファイルシステムのマウントはGUIでのマウントとCMDコマンドラインでのマウントの2つの方法があります。
1）GUIでのマウント
a.「ネットワークドライブのマッピング」の選択
ファイルシステムのマウントを必要とするWindowsにログインし、「スタート」メニューから「コンピューター」を見つけ、右クリックしてメニューが表示され、メニューの「ネットワークドライブのマッピング」をクリックします。 
![](https://main.qcloudimg.com/raw/515b5b21a19e3f3518c75441326e1800.png)
![](https://main.qcloudimg.com/raw/b0396ce0f8f108f3e89a2f2bfb3d7f71.png)
b.アクセスパスの入力
表示された設定位ウィンドウで「ドライブ」名とフォルダ（NFSファイルシステムで表示されるマウントディレクトリ）を設定します。
![](https://main.qcloudimg.com/raw/8d58ee713b9e072156caf8019b4242d5.png)
![](https://mc.qcloudimg.com/static/img/caa18888e6da73b19de8eefc18ff3680/image.png)
c.読み書きの検証
確認後、マウントしたファイルシステム画面に進みます。右クリックしてファイルを新規作成して読み書きの正確性を検証します。
![](https://mc.qcloudimg.com/static/img/60b9388885536ec7d81b1cf7f76c39d5/image.png)

2）CMDコマンドラインでのマウント
WindowsのCLIで次のコマンドを入力して、ファイルシステムをマウントします。システムのデフォルトサブディレクトリはFSIDです。

```
mount  <マウントポイントIP>:/<FSID> <共有ディレクトリ名称>:
```

例：
```
mount 10.10.0.12:/z3r6k95r X:
```

> **注意：**
> FSIDマウントコマンドは【ファイルストレージコンソール】>【ファイルシステム詳細】>【マウントポイント情報】から取得します。

### 5.ファイルシステムのマウント解除
#### GUIでの共有ディレクトリのマウント解除
マウントされたファイルシステムを切断するには、ディスクを右クリックし、表示されたメニューの【切断】をクリックすると、ファイルシステムとの接続を切断できます。
![](https://mc.qcloudimg.com/static/img/376cd0547aa64f4d519e5444c5a58f93/image.png)

#### CMDコマンドでのNFS共有ディレクトリのマウント解除 

共有ディレクトリをマウント解除する場合、次のコマンドを使ってください。その「ディレクトリ名称」はルートディレクトリまたはファイルシステムのフルパスです。
```
umount <ディレクトリ名称>：
```
例：
```
umount X：
```


## 五、リソースの終了
Tencent CloudコンソールでCVMインスタンスとファイルシステムを容易に終了できます。実際的には、無駄な課金を避けるため、もう使用しようとしないリソースを終了することをおすすめします。
1.Tencent Cloudインスタンスの終了。Tencent Cloud CVM[コンソール](https://console.cloud.tencent.com/cvm/index)に進み、終了しようとするインスタンスを選択し、【その他】>【CVMステータス】をクリックし、【終了】を選択するとCVMインスタンスを終了します。
![](//mc.qcloudimg.com/static/img/76c588284e3b525702d748b5cd7b8b00/image.png)
2.ファイルシステムの終了。Tencent Cloudファイルストレージ[コンソール](https://console.cloud.tencent.com/cfs)に進み、終了しようとするファイルシステムを選択し、【削除】をクリックして【確認】をクリックするとファイルシステムを削除します。
![](//mc.qcloudimg.com/static/img/28cade4807a283ffdcb1fc2a39a7ad88/image.png)

