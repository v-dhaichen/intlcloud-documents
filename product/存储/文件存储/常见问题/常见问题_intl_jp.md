### CFSはどのプラットフォームをサポートしますか？
Linux、Unix、Windows等のクライアントをサポートします。

### ファイルストレージ料は？
ストレージ費用のみです。実際のストレージ量によって課金します（1時間あたりのピークストレージ量によって料金を請求します）。

### ファイルストレージはどのアクセスプロトコルをサポートしますか？
NFS v3.0/v4.0およびCIFS/SMBプロトコルです。その中、CIFS/SMBプロトコルは公開テスト中で、試用申請ができます。

WindowsおよびLinux 3.10（例えば、CentOS 6.\*）の初期バージョンカーネルのOSクライアントとNFS 4.0プロトコルの互換性の問題があるため、マウント後に正常に使用できません。このようなクライアントであれば、NFS 3.0を用いてマウントしてください。

プロトコルの互換性の問題があるため、DockerまたはKubernetes等のクライアントを用いてCFSをマウントした場合、NFS v3プロトコルをおすすめします。（NFS v4プロトコルを使うと、一部のクライアントが正常にマウントしないことがあります） 

### ファイルストレージに関するコンセプトは？
ファイルシステム：ファイルシステムはファイルストレージのインスタンスです。ファイルシステムをCVMにマウント（mount）した後、ローカルファイルシステムのようにファイルストレージを使用できます。また、ディレクトリのマウントをサポートします。

マウントポイント：マウントポイントは、計算ノードがファイルストレージにアクセスするためのエントリです。ネットワークの計算ノードのタイプに応じてファイルストレージにアクセスするための権限を定義します。

### 各ユーザーはいくつかのファイルシステムを作成できますか？
1ユーザー、1地区ごとは最大10個です。特別な要望があれば[チケット提出](https://console.cloud.tencent.com/workorder/category)にて容量拡張を申請できます。

### マウントポイントはmountできない場合、どうすればいいですか？
トラブルシューティングについて、次の方法を参照してください。
- エラー情報を表示します。
- nfs-utils、nfs-common、cifs-utils等をインストールしたか否か確認してください。
- ローカルのマウントディレクトリは存在しますか。
- マウントポイントのVPCネットワークはクライアントCVMのVPCネットワークと一致しているか、地域が同じですか。
- CFSクライアントのCVMは外部ポートへのアクセスを禁止するセキュリティグループポリシーが設定されていますか。ポートの詳細について[ファイルシステムポート問題](https://cloud.tencent.com/document/product/582/9551#.E6.96.87.E4.BB.B6.E7.B3.BB.E7.BB.9F.E7.AB.AF.E5.8F.A3.E9.97.AE.E9.A2.98)を参照してください。

### CFS書き込みができない場合、どうすればいいですか？
トラブルシューティングについて、次の方法を参照してください。
- エラー情報を表示します。
- クライアントのCVMネットワークが正常であるか、telnetマウントポイントポートが開放されているか確認してください。ポートの詳細について、[ファイルシステムポート問題](https://cloud.tencent.com/document/product/582/9551#.E6.96.87.E4.BB.B6.E7.B3.BB.E7.BB.9F.E7.AB.AF.E5.8F.A3.E9.97.AE.E9.A2.98)を参照してください。 
- マウントされたのはマウントポイントのルートディレクトリではない場合、マウントされた対応するマウントポイントディレクトリが存在しているか確認してください（ここのよくあるエラー情報は、「Stale file handle」です。ルートディレクトリをマウントしたデバイスにて対応するサブディレクトリが存在しているか確認します）。

### ファイルシステムポート問題

ファイルシステムプロトコル | 開放ポート | ネットワーク接続性の確認
------- | ------- | ---------
NFS 3.0 | 111、892、2049 |  telnetファイルシステム IP 2049
NFS 4.0 | 2049 |  telnetファイルシステム IP 2049
CIFS/SMB | 445 |  telnetファイルシステム IP 445 

> **注意：**
> CFSはpingをサポートしません。

### 権限の有効について
NFSプロトコルのファイルシステムは、複数の規則の構成をサポートし、その優先順位に従って有効になります。
- 同一の権限グループ内の単一のIPとIPアドレス範囲に含まれているIPの権限に競合があれば、優先順位が高い規則が有効になります。優先順位が同じであれば、単一のIPの権限が優先的に有効になります。

- 重複している2つのIPアドレス範囲の権限が異なるが優先順位が同じであれば、重複しているIPアドレス範囲の権限がランダムに有効になりますので、重複しているIPアドレス範囲の構成を避けるようにしてください。 

> **注意：**
CIFS/SMBファイルシステムは優先順位をサポートしません。構成後に有効になりません。

### ローカルファイルをCFSにコピーする速度をあげるにはどうすればいいですか？
Linuxで次のshellスクリプトを用いてローカルファイルをCFSにコピーする速度をあげます。次のコードの「スレッド数量」はニーズに応じて調整できます。
```
threads=<スレッド数量>; src=<ソースパス/>; dest=<ターゲットパス/>; rsync -av -f"+ */" -f"- *" $src $dest && (cd $src && find . -type f | xargs -n1 -P$threads -I% rsync -av % $dest/% )

<!--例えば、threads=24; src=/root/github/swift/; dest=/nfs/; rsync -av -f"+ */" -f"- *" $src $dest && (cd $src && find .-type f | xargs -n1 -P$threads -I% rsync -av % $dest/% )-->
```

### Windowsでファイル名/ディレクトリ名を変更するとき異常が発生しますか。
クライアントのプロトコル対応問題があるため、WindowsクライアントでNFSプロトコルを用いてファイルシステムをマウントするとき、ファイルまたはディレクトリの名前を変更できない場合があります。この場合、WindowsユーザーがCFSファイルシステムを使用するにはCIFS/SMBプロトコルを使うことをおすすめします。


### nfsを用いてマウントした後、Windowsで書き込み権限がありません。どうすればいいですか？
操作ガイドに従って、レジストリにAnonymousUidとAnonymousGidを追加して、システム再起動後にもう一度してください。
ドキュメント：[ファイルシステムのマウント-Windowsでファイルシステムを使用する](https://cloud.tencent.com/document/product/582/9133#.E5.9C.A8-windows-.E4.B8.8A.E4.BD.BF.E7.94.A8.E6.96.87.E4.BB.B6.E7.B3.BB.E7.BB.9F)

### Windows IISではmapped driverを使えません。どうすればいいですか？
[ファイルシステムのマウント-Windowsでファイルシステムを使用する](https://cloud.tencent.com/document/product/582/9133#.E5.9C.A8-windows-.E4.B8.8A.E4.BD.BF.E7.94.A8.E6.96.87.E4.BB.B6.E7.B3.BB.E7.BB.9F)の手順に従って、正しいNFSクライアントプログラムを構成してレジストリを変更してください（アクセスユーザーを追加する）。
クライアント再起動後、IIS構成画面を開き、サイトを追加して【詳細設定】をクリックします。
![](https://mc.qcloudimg.com/static/img/bdd15aa1ca694653b5595442cbc38737/IIS.png)
詳細設定の「物理パス」はCFSのマウントポイントです。
![](https://main.qcloudimg.com/raw/54375f5bab346a95785bd26575a86fea.png)

### DockerまたはKubernetesの一部だけのマウントの成功、一部の失敗についての問題

プロトコルの互換性の問題があるため、DockerまたはKubernetes等のクライアントを用いてCFSをマウントした場合、NFS v3プロトコルをおすすめします。（NFS v4プロトコルを使うと、一部のクライアントが正常にマウントしないことがあります）


### あるAvailability ZoneのCFSリソースは売り切れました。使い続けるにはどうすればいいですか？
広州は例として挙げられると、広州1区のCVMが既に存在し、この場合CFSファイルストレージを利用しようとするが、広州1区のリソースが売り切れになったためファイルシステムを作成できません。
**VPCネットワーク下**
CVMがVPCの「広州1区サブネット」内であれば、[VPC コンソール](https://console.cloud.tencent.com/vpc)にログインしてこのVPCにAvailability Zoneが「広州2区」のサブネットを作成してください。
![](https://main.qcloudimg.com/raw/d25fc9283b76f114a772bebb1b703548.png)
![](https://main.qcloudimg.com/raw/5c0bb3dc41a7759bacf0c096dee4b413.png)

サブネットを作成した後、CFSコンソールに戻り、広州2区のリソースを作成したとき、このVPCと作成したばかりのサブネットを選択します。このVPCの広州1区サブネット配下のCVMはそのままCFSファイルシステムをマウントできます。
ファイルシステムの使用ガイド：
- [Linux](https://cloud.tencent.com/document/product/582/11523)
- [Windows](https://cloud.tencent.com/document/product/582/11524)

**基本ネットワークで** 
CVMが基本ネットワーク内であれば、VPCと広州2区サブネットを作成して、このネットワークでファイルシステムを作成します。「Classiclink」方法によりCVMの基本ネットワークとこのVPCを開放するとアクセスを実現します。[Classiclinkヘルプを参照してください>>](https://cloud.tencent.com/document/product/215/5002)

### ファイル内容のアップデートは同期しません。どうすればいいですか？
#### 問題現象
2台のLinux CVMに同一のNFSファイルシステムがマウントされ、CVM Aでappendを使ってファイルを書き込み、CVM Bで`tail -f`を使ってファイル内容の変化を観察します。CVM Aの書き込み後、10~30秒の遅延後にCVM Bにアップデート後の内容が表示されますが、同じシナリオで、CVM Bでファイル（例えば、viコマンドを使う）を開くとすぐにアップデート内容が表示されます。

#### 問題発生の原因
NFSプロトコルのmountコマンドのオプションと`tail -f`の実現とは関係があります。ユーザーは次のマウントコマンドを使用します。   
```
sudo mount -t nfs -o vers=4 <マウントポイントIP>:/ <マウント対象ディレクトリ>
```
 
CVM BはNFS mountでマウントされたファイルシステムに名前を付けた場合、デフォルトでkernelにファイルとディレクトリ属性のmetadataキャッシュを維持します。ファイルとディレクトリ属性には許可権、サイズ、タイムスタンプ等が含まれます。キャッシュの目的はNFSPROC_GETATTRリモートプロシージャーコール（RPC）の回数を減らすことです。

`tail -f`の実現はsleep+fstatでファイル属性（主にファイルのサイズ）の変化を観察することで、次はファイルを読み込んで出力します。そのため、fstatの結果は`tail -f`によってリアルタイムにファイル内容を出力するかどうかを決定します。ただし、ファイルとディレクトリのmetadataキャッシュが存在し、fstatがラウンドロビンしたのはリアルタイムなファイル属性ではないので、NFSサーバー側のファイルがアップデートされたが、`tail -f`がファイルの変化を知ることができないので、出力遅延が発生します。

#### ソリューション
mountコマンドを用いてファイルシステムをマウントするとき、noacオプションを追加してファイルとディレクトリ属性のキャッシュを無効にします。マウントコマンドは次の通りです。
```
sudo mount -t nfs -o vers=4 noac <マウントポイントIP>:/ <マウント対象ディレクトリ>
sudo mount -t nfs -o vers=3 noac,nolock,proto=tcp <マウントポイントIP>:/<FSIDまたはサブディレクトリ> <マウント対象ディレクトリ>
```

### Windows 7-basedまたはWindowsServer 2008 R2-based OSはNFSプロトコルを使ってマウントするとき、エラー(0x800704C9)が発生しました

#### 問題原因
そのようなバーションの機器にはNFSの初期ポートアドレスをキャッシュし、旧いアドレスでnlockmgrと通信しています。詳細な原因について[Microsoft公式サイトの説明](https://support.microsoft.com/en-us/help/2761774/0x800704c9-error-when-you-copy-files-to-an-nfs-server-from-a-windows-7)を参照してください。

#### ソリューション
Windowsの自動アップデート機能をオンにして、システムを公式最新バーションにアップグレードした後、この問題が修復できます。

