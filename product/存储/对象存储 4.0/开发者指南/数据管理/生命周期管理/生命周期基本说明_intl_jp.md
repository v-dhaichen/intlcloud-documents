COSはオブジェクトに基づくライフサイクル構成をサポートします。バケットに指定の記述言語を送信することにより、ルールに適合するオブジェクトが指定条件で一部の操作を自動的に実行できるようになります。

>?ライフサイクルの設定は最大3650日まで対応します。

## 適用シナリオ

### ログの記録

ユーザーがCOSでログデータを保存する場合、ライフサイクル構成により、ログデータは30日後に自動的にアーカイブされ、または2年後に自動的に削除されます。

### コールド・ホットデータの分層

ホットデータがアップロードされた後、短時間内に大量のアクセスで人気が高まり、一定の時間後、人気が徐々に下がり、またはリアルタイムのアクセスが不要になることが多いのです。ライフサイクルのルールにより30日前のデータを低頻度ストレージに沈下させ、更に60日前のデータをCASに沈下させることができます。

### ストレージの管理

COSでファイルのストレージ管理を行う場合、金融や医療などのコンプライアンス要件により、ファイルのすべての過去バージョンを保存する必要があります。この時、ライフサイクル機能を使用し、過去バージョンのファイルをCASに沈下させることができます。

## サポートの説明

### サポートする操作

- ストレージタイプの変換：作成したオブジェクトを指定時間後に低頻度ストレージタイプSTANDARD_IAまたはCASタイプARCHIVEに変換します。
- 期限切れ時の削除：オブジェクトが期限切れになると自動的に削除されるように、オブジェクトの有効期限を設定します。

### サポートするリソース

- プレフィックスによる区分：プレフィックスルールにマッチングしたすべてのオブジェクトはルールにより処理されます。
- バージョンによる管理：最新バージョンでないオブジェクトはルールにより処理されます。
- 削除によるタグ：オブジェクトの過去バージョンがすべて削除される場合、削除タグの削除を指定できます。
- 未完了パートによるアップロード：未完了のパートアップロードタスクを処理します。

### サポートする時間条件

- 日数による計算：ルールに対応する操作、およびオブジェクトの最終変更日の何日後に操作が行われるかを表示します。
- 日付による計算：ルールに対応する操作が指定日付に操作されることを表示します。

## 注意事項

### ストレージタイプの変換

#### サポートする地域

ARCHIVEストレージタイプに変換する場合、CASにより提供される地域のみARCHIVEタイプへの変換をサポートします。
現時点でサポートする地域：北京ap-beijing、上海ap-shanghai、広州ap-guangzhou、成都ap-chengdu、重慶ap-chongqing。

#### 単方向原則

COSにおいてストレージタイプの変換は単方向のもので、STANDARD → STANDARD_IA → ARCHIVEの順にのみ対応し、またスキップ沈下（例えばSTANDARD → ARCHIVE）にも対応していますが、そのリバースには対応しません。[PUT Object - Copy](https://cloud.tencent.com/document/product/436/10881)（ARCHIVEタイプ以外のタイプを対象に）、または[POST Object restore ](https://cloud.tencent.com/document/product/436/12633)（ARCHIVEタイプのみに適合）を呼び出してコールドストレージタイプをホットストレージタイプに変換できます。

#### 最終的一致性

同じグループのオブジェクトに対して複数のルールを構成し、且つ不一致がある場合（期限切れ時の構成削除を含みません）、COSは時間順に実行し、また最もコールドストレージタイプへの沈下を最終的実行効果として検査します。
>!Tencent Cloud COSは、同じグループのオブジェクトに対して複数の不一致条件を含むライフサイクルのルールを構成しないようにご注意ください。不一致は費用の差異として現れるかもしれません。

### 期限切れ時の削除

#### 処理のロジック

オブジェクトに指定のライフサイクル期限切れ時の削除ルールがマッチングされる時、Tencent Cloudはオブジェクトを非同期の削除キューに追加します。また、実際の削除時間と作成時間にはある程度の遅延が発生します。GETまたはHEAD Object操作でオブジェクトの現在状態を取得できます。

#### 最終的一致性

同じグループのオブジェクトに複数のルールを構成し、且つ不一致がある場合、COSは時間順に実行し、且つ有効期限に準じて実行します。**期限切れ時の削除の実行効力はストレージタイプの変換より大きいです**。
>!Tencent Cloud COSは、同じグループのオブジェクトに対して複数の不一致条件を含むライフサイクルのルールを構成しないようにご注意ください。不一致は費用の差異として現れるかもしれません。

### コストの注意事項

#### 実行の説明

任意の時間に配布された構成に対しても、Tencent Cloud COSは北京時間（GMT+8）の翌日の0時に準じて操作の実行を開始します。非同期キューの実行なので、設定後にアップロードされるオブジェクトにルールをマッチングする場合、通常、最遅翌日の24時までに操作を完了させます。

ライフサイクルの実行効力は予想外の状況またはバケットに大量のストックオブジェクトが含まれる状況を含みません。その他の状況で完了していない場合、GETまたはHEAD Object操作でオブジェクトの現在状態を取得できます。

現時点では、Tencent Cloudはライフサイクルの実行効力に対して固定料金の約束を提供しかねます。すなわち、オブジェクトの課金はライフサイクルの実行完了時点で変化します。

#### 時間を区別しない

STANDARD_IAタイプを30日以上保存し、ARCHIVEタイプを60日以上保存する必要があります。ストレージタイプの変換または削除を実行することで、追加される保存料金は発生しません。Tencent Cloud COSは30/60日以下のライフサイクル構成を検査しませんので、正しい構成はすべて指定の要件により実行されます。

例えば、STANDARD_IAオブジェクトの保存が30日未満の場合、沈下変換が行われる場合、オブジェクトは当日にARCHIVE保存料金が発生すると同時に、STANDARD_IAタイプの課金が相変わらず30日目まで続くようになります。

例えば、ARCHIVEオブジェクトの保存が60日未満の場合、期限切れ時の削除が行われる場合、オブジェクトはARCHIVEタイプの課金が60日目まで続くようになります。

#### サイズ制限の免除

STANDARD_IA、ARCHIVEタイプはオブジェクトの最小占有容量の制限がそれぞれ定められ、例えば、STANDARD_IAにおいて64KB以下のファイルをアップロードする場合、64KBで計算されます。Tencent Cloud COSはファイルのサイズを検査せず、無条件で指定のルールにより、オブジェクトの変換操作を実行します。
