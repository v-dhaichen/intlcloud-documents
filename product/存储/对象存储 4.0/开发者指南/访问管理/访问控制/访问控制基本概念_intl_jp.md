## 基本概念
アクセス権限の付与とは、ユーザーは誰が、どのような前提で、どのリソースに、具体的な操作を行うかを決める管理能力の組み合わせを指します。それでアクセス権限は、通常以下の四つの要素を含みます：**身分、リソース、操作、条件（オプション）**。

## アクセス権限の要素

### Tencent Cloudの身分

ユーザーがTencent Cloudアカウントを申請したら、システムはTencent Cloudログイン用のルートアカウント身分を作成してくれます。Tencent Cloudルートアカウントはユーザー管理機能により、職責別にユーザーを管理できます。ユーザーのタイプは**協力者、メッセージ受信者、サブユーザーとロール**などを含みます。詳しい定義については、CAMの[身分管理](https://cloud.tencent.com/document/product/598/13665)と[用語集](https://cloud.tencent.com/document/product/598/18564)のドキュメントを参照してください。

### COSのリソース

 BucketとObjectはCOSの基本的リソースであり、その中にはこれらに関わるサブリソースがあります。

バケットのサブリソースは下記を含みます：

- aclとpolicy：バケットのアクセス制御情報
- website：バケットの静的サイトのホスティング構成
- tagging：バケットのタグ情報
- cors：バケットのクロスオリジン構成情報
- lifecycle：バケットのライフサイクル構成情報

オブジェクトのサブリソースは下記を含みます：

- acl：オブジェクトのアクセス制御情報
- restore：CASタイプのオブジェクトの復旧構成

### COSの操作

COSは一連のリソース向けのAPI操作を提供しています。詳細については、[操作リスト](https://cloud.tencent.com/document/product/436/10111)ドキュメントを参照してください。

## アクセス制御の概要

### 私的所有原則

**デフォルトでは、Tencent Cloud COSにおけるリソースは全部私的所有です。**

リソース保有者（バケット・リソースを作成するTencent Cloudルートアカウント）は当該リソースへの最高権限を有し、リソース保有者はアクセスポリシーを編集・変更し、他人または匿名ユーザーにアクセス権限を付与することができます。

Tencent Cloud CAMアカウントによりバケットを作成し、またはオブジェクトをアップロードする場合、その親ルートアカウントはリソース保有者に当たります。

バケット保有者のルートアカウントはその他Tencent Cloudルートアカウントに対してオブジェクトをアップロードする権限を付与できます（すなわち、アカウント間アップロード）。このような場合、オブジェクトの保有者は相変わらずバケット保有者のルートアカウントに当たります。

### アクセス制御ポリシー

#### リソースに基づくポリシー

Tencent Cloud COSは**バケット**と**オブジェクト**の次元でそれぞれアクセス制御を行うことに対応します。詳しくは下表を参照してください：

| 次元   | タイプ                   | 説明方式 | 対応する身分                                       | 対応するリソース粒度       | 対応する操作         | 対応する效力    |
| ------ | ---------------------- | -------- | ------------------------------------------------ | -------------------- | ------------------ | ------------- |
| Bucket | アクセスポリシー言語（Policy） | JSON     | サブアカウント、ロール、Tencent Cloudサービス、その他ルートアカウント、匿名ユーザー等 | バケット、オブジェクト、プレフィックス等 | それぞれの具体的な操作   | 許可/拒否の表示 |
| Bucket | アクセス制御リスト（ACL）    | XML      | その他ルートアカウント、匿名ユーザー                             | バケット               | 操作の読取・書込権限 | 許可のみ        |
| Object | アクセス制御リスト（ACL）    | XML      | その他ルートアカウント、匿名ユーザー                             | オブジェクト                 | 操作の読取・書込権限 | 許可のみ        |

**バケットポリシー（Bucket Policy）**

バケットポリシー（Bucket Policy）はJSON言語で説明されており、匿名身分またはTencent CloudのすべてのCAMアカウントに対して、バケット、バケット操作、オブジェクトまたはオブジェクト操作の権限を付与することに対応しています。Tencent COSにおいてバケットポリシーは当該バケット内のほぼすべての操作を管理できます。ぜひバケットポリシーによりACLでは表示できないアクセスポリシーを管理してください。

>!Tencent Cloudルートアカウントはその名義下のリソース（バケット）に対する最大権限を有します。バケットポリシーによりほぼすべての操作を制限できるが、それでもルートアカウントはPUT Bucket Policy操作の権限を有します。ルートアカウントが当該操作を呼び出す場合、バケットポリシーをチェックすることはありません。

下記は、匿名ユーザーが広州にあるバケット`examplebucket-1250000000`におけるすべてのオブジェクトにアクセスすることを許可するポリシーです。署名検証がなくともバケットにおけるすべてのオブジェクト（GetObject）をダウンロードできます。すなわち、URLを知っているすべての匿名ユーザーはオブジェクトをダウンロードできます（パブリック読み取り方式と似る）：

```json
{
  "Statement": [
    {
      "Principal": "*",
      "Effect": "Allow",
      "Action": ["cos:GetObject"],
      "Resource": ["qcs::cos:ap-guangzhou:uid/1250000000:examplebucket-1250000000/*"]
    }
  ],
  "Version": "2.0"
}
```

**アクセス制御リスト（ACL）**

アクセス制御リスト（ACL）はXML言語で説明されており、リソースに関連する、認証対象者と権限を指定するリストです。それぞれのバケットとオブジェクトにはそれに関連するACLがあります。匿名ユーザーまたはその他Tencent Cloudのルートアカウントに基本的な読み取り・書き込み権限を付与することに対応しています。

>!配布されたACLがその項目を説明しているかどうかを問わず、リソースの保有者は常にリソースに対してFULL_CONTROL権限を有します。

下記はバケットACLの例です。バケット保有者（ユーザーUIN：1250000000）の完全制御権限を示しています：

```xml
<AccessControlPolicy>
  <Owner>
    <ID>qcs::cam::uin/1250000000:uin/1250000000</ID>
  </Owner>
  <AccessControlList>
    <Grant>
      <Grantee xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="RootAccount">
        <ID>qcs::cam::uin/1250000000:uin/1250000000</ID>
      </Grantee>
      <Permission>FULL_CONTROL</Permission>
    </Grant>
  </AccessControlList>
</AccessControlPolicy>
```

下記はオブジェクトACLの例です。オブジェクト保有者（ユーザーUIN：1250000000）の完全制御権限を示しています。また、すべての者に読み取り（匿名ユーザーのパブリック読み取り）権限を付与しています：

```xml
<AccessControlPolicy>
  <Owner>
    <ID>qcs::cam::uin/1250000000:uin/1250000000</ID>
  </Owner>
  <AccessControlList>
    <Grant>
      <Grantee>
        <ID>qcs::cam::uin/1250000000:uin/1250000000</ID>
      </Grantee>
      <Permission>FULL_CONTROL</Permission>
    </Grant>
    <Grant>
      <Grantee>
        <URI>http://cam.qcloud.com/groups/global/AllUsers</URI>
      </Grantee>
      <Permission>READ</Permission>
    </Grant>
  </AccessControlList>
</AccessControlPolicy>
```

#### ユーザーに基づくポリシー

ユーザーはCAMで、ルートアカウントの各タイプのユーザーに対して、異なる権限を付与できます。

ユーザーポリシーとバケットポリシーの最大の相違点は、ユーザーポリシーは效力（Effect）、行為（Action）、リソース（Resource）と条件（Condition、オプション）のみを説明し、身分（Principal）を説明しません。それで、ユーザーポリシーは、作成完了後、サブユーザー、ユーザーグループまたはロールに対して関連付けの操作を行う必要があります。また、ユーザーポリシーは操作とリソース権限を匿名ユーザーに付与することに対応していません。

[プリセットポリシーによる関連認証](https://cloud.tencent.com/document/product/598/10602)、もしくは[ユーザーポリシーの自主作成](https://cloud.tencent.com/document/product/598/10603)をしてから、指定の身分に関連付けることで、名義下のユーザーのアクセスを管理できます。

下記は、広州にあるバケット`examplebucket-1250000000`のすべてのCOS操作権限を付与するポリシーです。ポリシーを保存してから、CAMサブユーザー、ユーザーグループまたはロールに関連付けて発効させることができます：

```json
{
  "Statement": [
    {
      "Effect": "Allow",
      "Action": ["cos:*"],
      "Resource": [
          "qcs::cos:ap-guangzhou:uid/1250000000:examplebucket-1250000000/*",
          "qcs::cos:ap-guangzhou:uid/1250000000:examplebucket-1250000000/"
      ]
    }
  ],
  "Version": "2.0"
}
```
