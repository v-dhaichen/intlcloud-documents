## 適用シナリオ
- 応答の遅延とダウンロード速度が高く要求されるシナリオ。
- 複数の地区、国または大陸間で数GBから数TBまでのデータを送信する必要のあるシナリオ。
- 高密度で同じコンテンツのダウンロードを繰り返す必要のあるシナリオ。

## 関連説明
ドメイン名の定義、CDN Origin-pull認証とCDN認証の構成につき、[CDN加速の概要](/document/product/436/18669)ドキュメントにおいて説明しました。ここで、その説明を省略します。

CDN Origin-pull認証、CDN認証の構成はCDN加速ドメイン名とCOSドメイン名のオリジンサーバーバケットへのアクセス方式に影響を与えます。詳しくは下表を参照してください：

| バケットアクセス権限      | CDN Origin-pull認証 | CDN認証の構成 | CDN加速ドメイン名    | COSドメイン名        | シナリオ         |
| ------------------- | ------------ | ------------ | --------------- | --------------- | ------------ |
| パブリック読み取り              | オフ         | オフ         | アクセス可能          | アクセス可能          | サイト全体のパブリックアクセス |
| パブリック読み取り              | オン         | オフ         | アクセス可能          | アクセス可能          | 推奨しません       |
| パブリック読み取り              | オフ         | オン         | URL認証が必要です | アクセス可能          | 推奨しません       |
| パブリック読み取り              | オン         | オン         | URL認証が必要です | アクセス可能          | 推奨しません       |
| プライベート読み取り+CDNサービス認証 | オン         | オン         | URL認証が必要です | COS認証が必要です | 完全リンクを保護します |
| プライベート読み取り+CDNサービス認証 | オフ         | オン         | アクセス不可        | COS認証が必要です | 推奨しません       |
| プライベート読み取り+CDNサービス認証 | オン         | オフ         | アクセス可能          | COS認証が必要です | オリジンサーバーを保護します     |
| プライベート読み取り+CDNサービス認証 | オフ         | オフ         | アクセス不可        | COS認証が必要です | 推奨しません       |
| プライベート読み取り              | オフ         | オンまたはオフ   | アクセス不可        | COS認証が必要です | CDNを使用できません |

## デフォルトの加速ドメイン名に対してCDN加速を構成します

デフォルトの加速ドメイン名はCOSがバケットに自動的に配分したCDN加速ドメイン名であり、そのフォーマットは` <bucketname>-<APPID>.file.mycloud.com`です。ユーザーはオンまたはオフを選択できます。

### 機能をオンに
#### 1. バケットの選択
[COSコンソール](https://console.cloud.tencent.com/cos5)にログインし、左側メニュー【バケットリスト】に進みます。加速を必要とするバケットをクリックし、バケットに進みます。
![バケット画面](https://main.qcloudimg.com/raw/688c1dc518cb417461bc9d4645e4c41c.png)

#### 2. 構成ページに進みます
バケットページの上側から【ドメイン名管理】タグページに進みます。デフォルトの加速ドメイン名の初期状態は「オフ」になっています。
![デフォルトのドメイン名をオフに](https://main.qcloudimg.com/raw/bd56dc4366b69e9fc63729135099985f.png)

> **注意：**
> Tencent Cloud CDNサービスを使用したことのないユーザーは【ドメイン名管理】に入ることができません。外部リンクをクリックしてCDNコンソールに入ってCDNサービスをオンにしておく必要があります。
> ![CDNをオンに](https://main.qcloudimg.com/raw/4c8b820c51746a91e837559d9325134a.png)

#### 3. オリジンサーバーのタイプの選択
【編集】をクリックし、現在状態をオンに設定します。

ここでオリジンサーバーのタイプを選択する必要があります。オリジンサーバーのタイプはデフォルトではXMLノードであり、オリジンサーバーとしてのバケットが静的サイトをオンにし、また静的サイトを加速する必要がある場合、オリジンサーバーのタイプを静的サイトノードに設定できます。詳しくは[CDN加速の概要](/document/product/436/18669)を参照してください。
![デフォルトのドメイン名をオンに](https://main.qcloudimg.com/raw/542a778a7177e3aae0e49580aaefe348.png)

#### 4. CDNサービス認証の追加（オプション）

CDNサービス認証の追加により、CDNエッジノードがバケットを操作するためのサービス身分を授与できます。詳しくは以下に示します：

- パブリック読み取りバケット：CDNエッジノードは認証がなくてもバケットに直接アクセスできます。CDNサービス認証を追加する必要がありません。

- プライベート読み取りバケット：CDNエッジノードに特別なサービス身分を授与してから、はじめてバケットにアクセスできます。【CDNサービス認証の追加】をクリックし、CDNエッジノードにサービス身分を授与し、次に【以上の認証に同意します】を選択し、【確認】をクリックしてください。

認証を追加した後、CDNエッジノードはバケットに対してGET Object、Head Object、Options Objectといった3つの操作ができます。

![CDNの認証](https://main.qcloudimg.com/raw/a4654ca919ad72479143a47017fba34b.png)

  認証に同意した後、システムは自動的にバケットアクセスポリシーを書き込みます。その後、CDNノードはOrigin-pullを必要とする時にその他の操作を必要しなくまります。書き込みポリシーを以下に示します：

```xml
  {
    "Statement": [
      {
        "Action": [
          "name/cos:GetObject",
          "name/cos:HeadObject",
          "name/cos:OptionsObject"
        ],
        "Effect": "allow",
        "Principal": {
          "qcs": [
            "qcs::cam::uin/************:service/cdn"
          ]
        },
        "Resource": [
          "qcs::cos:ap-chengdu:uid/**********:sdobc-**********/*"
        ]
      }
    ],
    "version": "2.0"
  }
```

#### 5. Origin-pull認証をオンに（オプション）
>**ご注意：**
> CDNサービス認証を追加した後、はじめてOrigin-pull認証をオンにできます。

Origin-pull認証はCDNエッジノードのサービス身分をチェックすることで不正アクセスを防止します。詳しくは以下に示します：
- パブリック読み取りバケット：CDNエッジノードは認証がなくてもバケットに直接アクセスできます。Origin-pull認証をオンにする必要がありません。
- プライベート読み取りバケット：CDNエッジノードはOrigin-pull認証によりサービス身分をチェックし、合格したCDNエッジノードはバケットにおけるオブジェクトにアクセスできます。クリックして【Origin-pull認証】をオンにしてください。
![Origin-pull認証をオンに](https://main.qcloudimg.com/raw/9b662fe72d91ff15e2e664ef4ffbc1c0.png)

> **注意：**
> プライベート読み取りバケットに対して、Origin-pull認証とCDNサービス認証をオンにすることによりCDNエッジノードは署名を持たなくてもオリジンサーバーにアクセスできるようになります。また、CDNキャッシュメモリのリソースはパブリックネットワークに配布されるため、データの安全性は影響を受けます。したがって、CDN認証をオンにすることを強く推奨します。

#### 6. CDN加速をオンに
【保存】をクリックして5分程度経つと、CDN加速の配置は完了できます。

### 認証の構成
デフォルトの加速ドメイン名とOrigin-pull認証をオンにした後、デフォルトの加速ドメイン名の管理画面にはCDN認証状態のメッセージが表示されます。メッセージに示す【認証の構成】により、関連ドメイン名のCDN安全構成ページに直接スキップして構成できます。
![認証の構成](https://main.qcloudimg.com/raw/f836aa8efc9b07b79d47a203c697aa49.png)

[CDNコンソール](https://console.cloud.tencent.com/cdn)よりCDN認証のページに進むパスは【ドメイン名管理】> 関連ドメイン名の【管理】>【安全構成】。

詳しい構成手順につき、[認証の構成](https://cloud.tencent.com/document/product/228/13677)を参照してください。

#### 注意事項
デフォルトのドメイン名に対してCDN加速をオンにした後、誰でもこのドメイン名を通じてオリジンサーバーに直接アクセスできるようになります。データにつき、一定の機密性がある場合、ぜひ認証の構成をオンにしてオリジンサーバーデータを保護してください。

### 機能をオフに
- デフォルトの加速ドメイン名管理画面では、【編集】をクリックし、状態を「オン」から「オフ」に変更し、次に【保存】をクリックしてください。配置には約5分間かかります。配置完了後、CDNコンソールにおいてこのドメイン名の状態は「オンにしている」から「オフにしている」となります。
![](https://main.qcloudimg.com/raw/e7dfd0da74d0d8d48f7e53425b0adde0.png)

- [CDNコンソール](https://console.cloud.tencent.com/cdn)においてドメイン名に対してオフ/削除できます。詳しくは[ドメイン名の操作](https://cloud.tencent.com/document/product/228/5736)を参照してください。
  > **注意：**
  > CDNコンソールは、CDN加速時のデフォルトの加速ドメイン名の記録のみを削除し、デフォルトの加速ドメイン名を実際に抹消することはありません。COSコンソールにおいてデフォルトの加速ドメイン名を再度オンにできます。

![CDNコンソールのオフ操作](https://main.qcloudimg.com/raw/4d3f7485a78be5f18c3e3ac3ec0a4447.png)

## カスタマイズ加速ドメイン名に対してCDN加速を構成します
ユーザーはCOSコンソールを通じてバケットにカスタマイズドメイン名をバインディングできます。バイティング後、CDN加速をオンにすれば、カスタマイズドメイン名によりバケットへのアクセスを加速できます。カスタマイズドメイン名をバインディングする時、ユーザーは自らカスタマイズドメイン名のサービス提供者の部分にCNAME解析を追加する必要があります。
> **注意：**
> バケットのカスタマイズドメイン名のバインディングにつき、中国工信部にて[登録](https://cloud.tencent.com/product/ba)する必要があります。そうでない場合、カスタマイズドメイン名にアクセスできません。

### 機能をオンに
> **注意：**
> COSコンソールとCDNコンソールはいずれもカスタマイズドメイン名の追加およびCDN加速のオンに対応できます。CDNコンソールによりカスタマイズドメイン名を追加するには、[ドメイン名の接続](https://cloud.tencent.com/document/product/228/5734)を参照してください。

#### 1. カスタマイズドメイン名のバインディングするバケットの選択
[COSコンソール](https://console.cloud.tencent.com/cos5)にログインし、左側メニュー【バケットリスト】に進みます。ドメイン名の構成を必要とするバケットをクリックし、バケットに進みます。
![バケット画面](https://main.qcloudimg.com/raw/688c1dc518cb417461bc9d4645e4c41c.png)

#### 2. カスタマイズドメイン名の追加
【ドメイン名の管理】のタグページに進み、第2列「カスタマイズの加速ドメイン名」にて【ドメイン名の追加】をクリックし、バインディング待ちのカスタマイズドメイン名を入力してください。
![カスタマイズドメイン名](https://main.qcloudimg.com/raw/c1c93c254856864e7a9f3879ebad4820.png)

#### 3. オリジンサーバーのタイプの選択
通常、オリジンサーバーのタイプはデフォルトでXMLノードとなっています。選択したバケットが静的サイト機能をオンにし、また静的サイトを加速する必要がある場合、オリジンサーバーのタイプを静的サイトノードに設定できます。XMLノードと静的サイトノードの詳しい説明に関して、概要を参照してください。
![オリジンサーバーのタイプの選択](https://main.qcloudimg.com/raw/826d747660b2bad5f4aaeddc6e26e697.png)

#### （オプション）4. Origin-pull認証をオンに
Origin-pull認証はCDNエッジノードのサービス身分をチェックすることで不正アクセスを防止します。詳しくは以下に示します：

- パブリック読み取りバケット：CDNエッジノードは認証がなくてもバケットに直接アクセスできます。Origin-pull認証をオンにする必要がありません。
- プライベート読み取りバケット：CDNエッジノードはOrigin-pull認証によりサービス身分をチェックし、合格したCDNエッジノードはバケットにおけるオブジェクトにアクセスできます。選択して【Origin-pull認証】をオンにしてください。
![カスタマイズOrigin-pull認証をオンに](https://main.qcloudimg.com/raw/610dbfab9d3f9f20288f286b099e7fbe.png)

> **注意：**
> プライベート読み取りバケットに対して、Origin-pull認証をオンにすることによりCDNエッジノードは署名を持たなくてもオリジンサーバーにアクセスできるようになります。また、CDNキャッシュメモリのリソースはパブリックネットワークに配布されるため、データの安全性は影響を受けます。したがってCDN認証をオンにすることを強く推奨します。

#### 5. CDN加速の有効化

右側の【保存】をクリックして5分程度経つと、カスタマイズドメイン名の追加とCDN加速の配置は完了できます。

### 認証の構成
カスタマイズドメイン名を追加した後、ドメイン名の状態は「オンラインになっている」となり、CDN認証枠にはCDN認証機能の設定リンクが表示されます。【設定】をクリックしてCDNコンソールに入ってCDN認証の構成を行うことができます。詳しい操作方法につき、[認証の構成](https://cloud.tencent.com/document/product/228/13677)を参照してください。
![加速オンラインのカスタマイズ](https://main.qcloudimg.com/raw/2b6cca677934b91874657bea693cb7f5.png)

#### 注意事項
- カスタマイズドメイン名に対してCDN加速をオンにした後、誰でもこのドメイン名を通じてオリジンサーバーに直接アクセスできるようになります。データにつき、一定の機密性がある場合、ぜひ認証の構成をオンにしてオリジンサーバーデータを保護してください。

### ドメイン名の解析
カスタマイズドメイン名がCDNに接続された後、システムは自動的にCNAMEドメイン名（`.cdn.dnsv1.com`をサフィックスとします)を配分ます。DNS提供者にてCNAMEの構成を完了させる必要があります。詳しくは[CNAMEの構成](https://cloud.tencent.com/document/product/228/3121)を参照してください。

> **注意：**
> CNAMEドメイン名に直接アクセスできません。
![CNAME](https://main.qcloudimg.com/raw/ce416e52cac3a86a8c73955d208ad26e.png)

### 機能をオフに
- デフォルトの加速ドメイン名管理画面では、【編集】をクリックすれば、ドメイン名の状態を変更できます。ドメイン名の状態を「オンラインになっている」から「オフラインになっている」に変更し、【保存】をクリックした後に配置に入ります。約5分経つと、機能をオフにできます。CDNコンソールにおいて、関連カスタマイズ加速ドメイン名の状態は「オンにしている」から「オフにしている」となります。

  > **注意：**
  > カスタマイズドメイン名を削除するには、カスタマイズドメイン名の状態が「オンラインになっている」である場合、ドメイン名を直接削除できません。状態を「オフラインになっている」に変更してから、はじめてドメイン名を削除できます。
  ![COSコンソールのオフ操作](https://main.qcloudimg.com/raw/c6e92d1bfbf799cb5dfc1c94cff7ce6a.png)

- [CDNコンソール](https://console.cloud.tencent.com/cdn)においてドメイン名に対してオフまたは削除できます。詳しくは[ドメイン名の操作](https://cloud.tencent.com/document/product/228/5736)を参照してください。
  ![CDNコンソールのオフ操作](https://main.qcloudimg.com/raw/4d3f7485a78be5f18c3e3ac3ec0a4447.png)
