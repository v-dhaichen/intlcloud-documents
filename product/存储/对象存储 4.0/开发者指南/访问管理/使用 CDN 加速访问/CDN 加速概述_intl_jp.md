CDNでCOSを加速する場合、バケットにおけるコンテンツを幅広くダウンロード・デリバリーできます。特に同じコンテンツのダウンロードを繰り返す適用シナリオに対応できます。Origin-pull認証機能により、CDNによりバケットにおけるコンテンツのプライベート読み取りを加速できます。CDN認証機能により、正当なユーザーにのみコンテンツのダウンロードを認証し、オープンソースダウンロードによるデータのセキュリティとトラフィックのコスト等の問題を防止します。

## CDN

### CDNの定義

CDN（Content Delivery Network）とは、既存のInternetに新しいネットワークアーキテクチャを追加することを指し、全世界に分布する高性能の加速ノードから構成されます。これらの高性能のサービスノードは一定のキャッシュポリシーで業務内容を保存します。ユーザーが特定の業務内容にリクエストを開始する場合、そのリクエストはユーザーに最寄りのサービスノードに調達されます。サービスノードが速やかに応答され、効果的にユーザーのアクセス遅延を緩和させ、利用可能性を向上させます。

CDNはキャッシュとOrigin-pullを行います。すなわちユーザーが特定のURLにサクセスする時、解析先のエッジノードが応答必須なキャッシュコンテンツに的中しておらず、またはキャッシュメモリが期限切れになった場合、オリジンサーバーに戻って応答必須なコンテンツを取得します。

### 適用シナリオ

- 応答の遅延とダウンロード速度が高く要求されるシナリオ。
- 複数の地区、国または大陸間で数GBから数TBまでのデータを送信する必要のあるシナリオ。
- 高密度で同じコンテンツのダウンロードを繰り返す必要のあるシナリオ。

### セキュリティタイプ

- Origin-pull認証：ユーザーのリクエストするデータがエッジノードにおいてキャッシュメモリに的中していない場合、CDNはOrigin-pullでデータのコンテンツを取得する必要があります。COSをオリジンサーバーとし、またOrigin-pull認証をオンにした後、CDNエッジノードは特別なサービスアイデンティティでCOSオリジンサーバーにアクセスすることで、プライベートのバケットにおけるデータの取得およびキャッシュを実現します。
  - CDNサービス認証：CDNエッジノードにCDNサービス認証を追加することで特別なサービスアイデンティティでCOSオリジンサーバーにアクセスできます。CDNサービス認証を追加した後、はじめてOrigin-pull認証をオンにできます。
- CDN認証構成：ユーザーがエッジノードにアクセスすることでキャッシュデータを取得する際、エッジノードは認証構成ルールにより、アクセスするURLにおける身分認証フォールドをチェックすることで、未認証のアクセスを未然に防止し、ホットリンク保護を実現し、エッジノードのキャッシュデータの安全性と信頼性を向上させます。

## COSのアクセスノード

### アクセスノードの定義

アクセスノードとは、バケットを作成する時、バケットの地域と名称により、バケットに配分されるアクセスドメイン名を指します。このドメイン名によりバケットにおけるデータにアクセスできます。

静的サイト機能をオンにした後、静的サイトのアクセスノードを別途取得できます。これはデフォルトノードと異なり、特別に構成された応答コンテンツを示すことに用いられます。

### アクセスノード

- XMLノード：バケットを作成した後、COSはXMLアクセスノードをバケットに直接配分します。アクセスノードの一般的なフォーマットは`<bucketname>-<APPID>.cos.<region>.myqcloud.com`です。RESTful APIアクセスに適用します。ユーザーはXMLアクセスノードを使用し、[APIドキュメント](https://cloud.tencent.com/document/product/436/7751)の実行規則に従い、バケットを構成し、またはオブジェクトのアップロード・ダウンロードを行うことができます。
- 静的サイトノード：コンソールのバケット基本構成画面において、静的サイトのホスティング機能をオンにできます。オンにした後、アクセスノードが表示されます。アクセスノードの一般的なフォーマットは` <bucketname>-<APPID>.cos-website.<region>.myqcloud.com`です。静的サイトは特別なインデックスページ（IndexPage）、エラーページ（ErrorPage）とスキップ等をサポートし、またオブジェクトに対するダウンロードなどの操作のみをサポートします。ユーザーは静的サイトノードによりそのコンテンツを取得できます。

### アクセス権限

- パブリック読み取り：バケットをパブリック読み取りに設定する場合、誰でもバケットのアクセスドメイン名を通じてバケットにアクセスできます。ユーザーがパブリック読み取りのバケットをオリジンサーバーとしてOrigin-pullする場合、CDN加速を直接オンにできます。CDN認証とOrigin-pull認証が不要です。
- プライベート読み取り：バケットをプライベート読み取りに設定する場合、ユーザーはアクセスポリシーの作成によりアクセス者を管理できます。それはCDNサービス認証の管理等を含みます。ユーザーがプライベート読み取りのバケットをオリジンサーバーとしてOrigin-pullし、Origin-pull認証をオンにするが、CDN認証をオンにしていない場合、権限保有者以外の者はCDNを通じてバケットに直接アクセスできるようになります。しがたって、プライベート読み取りのバケットに関して、同時にCDN認証とOrigin-pull認証をオンにすることでデータの安全性を確保することを強く推奨します。

## CDNによりCOSへのアクセスを加速します

ユーザーは下記2種類のドメイン名の管理によりCOSへの加速アクセスを実現できます：

- デフォルトの加速ドメイン名：COSはユーザーにデフォルトのCDN加速ドメイン名を提供しており、そのフォーマットは` <bucketname>-<APPID>.file.mycloud.com`です。ユーザーはオンまたはオフを選択できます。
- カスタマイズドメイン名：ユーザーは自分で登録済みのカスタマイズドメイン名を用意し、またオリジンサーバーがCOSバケットにディレクトすることで、カスタマイズドメイン名でバケットにおけるオブジェクトへの加速アクセスを実現できます。

> **注意：**
> デフォルトの加速ドメイン名とカスタマイズドメイン名はCDN加速ドメイン名と総称できます。

### パブリック読み取りバケット

バケットへのパブリックアクセスを許可するように設定し、CDNがCOSアクセスノードにOrigin-pullされるように構成する時、Origin-pull認証をオンにする必要がありません。CDNエッジノードのみによりバケットにおけるオブジェクトデータを取得・キャッシュできます。

CDNコンソールにより[認証構成](https://cloud.tencent.com/document/product/228/13677)をオンにすることで**限度を持って**バケットにおけるデータを保護できます。それは、CDNにおけるこの機能をオンにするかどうかを問わず、バケットのアクセスドメイン名を知っているユーザーは相変わらずバケットにおけるすべてのオブジェクトにアクセスできるからです。さまざまなCDN認証構成につき、ドメイン名のパブリック読み取りバケットへのアクセス能力を下表に示します：

| CDN認証構成 | CDN加速ドメイン名へのアクセス | COSドメイン名へのアクセス | よくあるシナリオ                                        |
| ------------ | ---------------- | ------------ | ----------------------------------------------- |
| オフ（デフォルト） | アクセス可能           | アクセス可能       | サイト全体へのパブリックアクセスを許可します。CDNまたはオリジンサーバーによりアクセスできます       |
| オン         | URL認証が必要です  | アクセス可能       | CDNアクセスに対してホットリンク保護をオンにしましたが、オリジンサーバーへのアクセスを保護しないため、推奨しません |

### プライベート読み取りバケット

バケットがデフォルトでプライベート読み取りである場合、CDNがCOSアクセスノードにOrigin-pullされるように構成し、CDNエッジノードは**いかなるデータの取得・キャッシュもできません**。したがって、CDNサービス身分をバケットのアクセスポリシー（Bucket Policy）に追加し、またこの身分が下記操作を実行できるように許可する必要があります：

- GET Object - オブジェクトの取得
- HEAD Object - オブジェクトのメタデータの取得
- OPTIONS Object - プリフライトリクエストの開始

CDNコンソールとCOSコンソールにはいずれもワンクリックで認証可能な機能を提供し、【CDNサービス認証の追加】をクリックして完了できます。この操作を完了させた後、「Origin-pull認証」オプションをオンにする必要があります。この時、CDNエッジはそのサービス身分でCOSにおけるデータにアクセスします。

> **注意：**
> 1. バケットがプライベート読み取りに設定されている場合、認証を追加し、またOrigin-pull認証をオンにする必要があります。そうでない場合、COSはアクセスを拒否します。
> 2. CDNエッジはそれぞれのルートアカウントに応じて唯一のサービスアカウントを生成するため、アカウント認証は加速ドメイン名の属するルートアカウントにのみ発効しています。アカウント間で加速ドメイン名をバインディングする場合、アクセスは拒否されます。

CDNサービス認証を追加し、またOrigin-pull認証をオンにした後、CDNエッジノードはデータを直接取得・キャッシュできるようになるため、プライベートデータを保護する場合、[認証構成](https://cloud.tencent.com/document/product/228/13677)をオンにしてバケットにおけるデータを保護することを推奨します。さまざまなCDN認証構成につき、ドメイン名のプライベート読み取りバケットへのアクセス能力を下表に示します：

| CDN認証構成 | CDN加速ドメイン名へのアクセス | COSドメイン名へのアクセス    | よくあるシナリオ                            |
| ------------ | ---------------- | --------------- | ----------------------------------- |
| オフ（デフォルト） | アクセス可能           | COS認証が必要です | CDNドメイン名に直接アクセスし、オリジンサーバーのデータを保護することができます   |
| オン         | URL認証が必要です  | COS認証が必要です | リンク全体へのアクセスを保護し、CDN認証のホットリンク保護をサポートします |
