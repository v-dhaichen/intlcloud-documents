### FTP機能をオンにするにはどうすればいい？

COSは、Webリクエストをサポートする永続的なストレージです。ネイティブFTPアクセスを提供しません。FTPプロトコルを使用するには、中継経由でなければなりません。**Tencent Cloud公式の[FTP Server ツール](https://www.qcloud.com/document/product/436/7214 )によって、自らサービスを構築することをおすすめします。**
FTPプロトコルが旧く、データ完全性の検証と伝送セキュリティの保障、CAM権限システムへの連携ができませんので、FTPプロトコルによるアクセスを使用しないことを強くおすすめします。今後Tencent CloudもFTPプロトコルと中継ソフトウェアにサポートを提供しません。 
データ同期が必要の場合、[COS Migration ツール  ](https://www.qcloud.com/document/product/436/7133)または[COSCMD ツール](https://www.qcloud.com/document/product/436/10976)を直接使用することをおすすめします。

### 構成ファイル内のmasquerade_addressオプションの役割は何ですか？いつmasquerade_address構成が必要ですか？

FTP Serverが複数ENIを搭載するServerで動作し、FTP ServerがPASSIVEモードを使用する時（通常、FTPクライアントが1つのNATゲートウェイの後にある時、PASSIVEモードをオンにする必要がある）、masquerade_addressオプションでpassiveモードでのreplyに使用される唯一のIPをバインディングする必要があります。 

例えば、FTP Serverが複数のIPアドレスがあります。例えば、プライベートネットワークIP：10.XXX.XXX.XXX、パブリックネットワークIP：123.XXX.XXX.XXX。クライアントは、パブリックネットワークIPを介してFTP Serverに接続され、同時にクライアントがPASSIVEモード伝送を使用します。この場合、FTP Serverが具体的にパブリックネットワークIPアドレスにバインディングするmasquerade_addressを指定しない場合、ServerがPASSIVEモードでreply時、プライベートネットワークアドレスを経由する可能性があります。この場合、クライアントがFtp serverに接続できますが、Server側からのデータ返信が取得できないという問題となる可能性があります。

masquerade_address構成を必要とする場合、クライアントがServerに接続するために使用されるIPアドレスを指定することをおすすめします。

### masquerade_addressオプションを正しく設定した後、ftp serverは正常にログインできますが、FTPコマンド（listまたはget）などのデータ取得コマンドを実行する場合、「サーバーからルーティング不能なアドレスを返しました」または「ftp: connect: No route to host」などのエラーが表示される場合、どうすればいい？

このcaseはほとんど、ftp serverマシンiptablesまたはファイアウォールポリシー構成がすべてのICMPプロトコルパケットをrejectまたはdropしましたが、FTPクライアントがFTP Serverのパッシブモードで返されたデータ接続IPを受信した後、IPの接続性を検出するためのICMPパケットを送信しますので、クライアントが「サーバからルーティング不能なアドレスを返しました」などのエラーが表示されます。

推奨ソリューション：必要に応じてiptablesポリシーは、制限するICMPパケットのタイプのみをrejectまたはdropするように構成されます。外部ping型のICMPパケットのみを無効にするには、ポリシーを「iptables -A INPUT -p icmp --icmp-type 8 -s 0/0 -j [REJECT/DROP]」に変更するか、
またはftp serverにアクセスするクライアントのIPを単独で開放します。

### 大容量ファイルをアップロードする時、途中で取り消す場合、なぜアップロードしたファイルがCOSに残されますか？

COS最新バージョンに対応のFTP Serverが完全なストリーミングアップロード特性を提供し、ユーザーファイルのアップロードの取り消しや切断によって、大容量ファイルのアップロード完了操作をトリガーしますので、COSはユーザーデータストリームのアップロードがすでに完了することを判断し、アップロードしたデータを1つの完全ファイルに作成します。ユーザーが再アップロードする場合、元のファイル名で直接アップロードして上書きするか、手動で不完全なファイルを削除し、再アップロードすることもできます。

### なぜFTP Server構成で最大アップロードファイルの制限を設定しますか？

COSの最大分割アップロード数は、10000パートで、かつ各パートの大きさ制限は1 MB ~ 5 Gです。ここで、最大アップロードファイルの制限を設定することは1つのアップロードパートの大きさを合理的に計算するためです。
FTP Serverは、デフォルトで200 GB以内の単一ファイルのアップロードをサポートしますが、ユーザー設定を大きくすることをおすすめしません。単一ファイルの大きさを大きく設定すると、アップロード時のパートバッファも増加し、ユーザーのメモリリソースが消費されるおそれがあります。したがって、ユーザーが実際の状況に応じて単一ファイルの大きさ制限を合理的に設定することをおすすめします。

### アップロードしたファイルが最大制限を超えた場合、どうなりますか？

実際にアップロードした単一ファイルの大きさが構成ファイルの制限を超える場合、システムがIOError異常を返し、ログにエラー情報を記録します。

ご不明の点がありましたら、[チケット提出](https://console.cloud.tencent.com/workorder/category)を行い、チケットに完全な`cos_v5.log`ログを添付してください。

