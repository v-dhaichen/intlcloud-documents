## 기능 소개
Tencent Cloud COS는 핫 링크 보호 구성을 지원합니다. 콘솔의 핫 링크 보호를 통해 블랙/화이트리스트를 설정하여 안전을 보호합니다.
<span id="링크 도난 사례"></span>
## 링크 도난 사례
사용자 A가 COS에 이미지 리소스 `1.jpg`를 업로드하였고 접근 가능 링크 `http://test-1250000000.cosgz.myqcloud.com/1.jpg`를 획득하였으며 자신의 웹페이지 `http://a.com/a.html`에 해당 이미지를 삽입하였고 정상적으로 접근할 수 있습니다.
사용자 B가 `a.com`에서 이미지를 보고 역시 자신의 웹페이지 `http://b.com/b.html`에 `1.jpg`의 링크를 삽입하여 B의 웹페이지도 이미지를 정상적으로 표시합니다.
위의 사례에서 A의 이미지 리소스 `1.jpg`가 B에 의해 링크를 도난 당했습니다. 이 때 A는 사실을 모르는 상황에서 COS의 리소스가 계속하여 B의 웹페이지에 의해 정상적으로 사용되므로 A는 추가 트래픽 비용을 부담하여 비용 손해가 발생하였습니다.

## 핫 링크 보호 판단 원리
핫 링크 보호는 요청 Header의 Referer로 판단합니다.
-  Referer는 Header의 한 부분으로서 브라우저가 Web 서버에 요청을 보낼 때 일반적으로 Referer를 가집니다. 해당 요청이 어느 페이지의 링크로부터 온 것인지를 알리고 서버는 일부 웹사이트 접근 리소스를 금지하거나 허용할 수 있습니다.
-  만약 브라우저에서 파일 링크 `http://test-1250000000.cosgz.myqcloud.com/1.jpg`를 직접적으로 열 경우 요청 Header에는 Referer를 가지지 않습니다.

예를 들어, 다음 그림은 `http://127.0.0.1/test/test.html`에 `1.jpg`를 삽입한 것으로 `test.html`에 접근할 경우 Referer가 지향하는 접근 소스를 가지게 됩니다.
![referer_1](//mc.qcloudimg.com/static/img/f000c8ee64ae569f08680c495ddb1b7b/image.png)
## 콘솔 설정 설명
### 설정 절차
1. [COS 콘솔](https://console.cloud.tencent.com/cos5/index)에 로그인한 후 왼쪽 메뉴의 [Bucket 리스트]에 액세스하고 핫 링크 보호를 설정할 버킷을 선택한 다음 버킷에 들어갑니다.
2. 버킷 세부 정보 페이지에서 [기본 구성]을 클릭하여 핫 링크 보호 설정을 찾은 후 [편집] 버튼을 클릭하여 편집 가능한 상태에 들어갑니다.
![핫 링크 보호 설정 1](//mc.qcloudimg.com/static/img/3d76b7e130d8917a41c4b2b7e8b1a730/image.png)
3. 현재 상태가 시작임을 확인한 다음 리스트 유형(블랙리스트 또는 화이트리스트)을 선택하고 해당되는 도메인 이름을 설정하고 [저장]을 클릭하면 됩니다. 사용자는 핫 링크 보호 상태를 시작으로 설정한 다음 반드시 해당되는 도메인 이름을 입력해야 합니다.
![referer_3](//mc.qcloudimg.com/static/img/14919513b487b1bac4a6617618e6de78/image.png)

### 규칙 설정 설명
-  리스트 유형은 블랙/화이트리스트에서 하나를 선택합니다.
    * 블랙리스트: 리스트 내의 도메인 이름이 버킷에 접근하는 기본 접근 주소를 제한하며 리스트 내의 도메인 이름이 버킷의 기본 접근 주소에 접근할 경우 403을 반환합니다.
    * 화이트리스트: 리스트 외의 도메인 이름이 버킷에 접근하는 기본 접근 주소를 제한하며 리스트 외의 도메인 이름이 버킷의 기본 접근 주소에 접근할 경우 403을 반환합니다.
- 규칙 구성 예시:
    * 포트를 가지는 도메인 이름과 IP, 예를 들어 `test.com:8080`, `10.10.10.10:8080` 등 주소를 지원합니다.
    * `test.com`을 구성하면 `test.com/123`, `test.com.cn` 등과 같은 `test.com`을 접두사로 하는 주소를 적중할 수 있습니다.
    * `test.com`을 구성하면 `https://test.com`과 `http://test.com`을 접두사로 하는 주소를 적중할 수 있습니다.
    * `test.com`을 구성하면 포트 `test.com:8080`을 가지는 도메인 이름을 적중할 수 있습니다.
    * `test.com:8080`을 구성하면 도메인 이름 `test.com`을 적중하지 않습니다.
    * `*.test.com`을 구성하면 두 번째 수준/세 번째 수준 도메인 이름 `test.com`, `b.test.com`, `a.b.test.com`을 제한할 수 있습니다.
- 도메인 이름이 최대 10개의 도메인 이름을 지원할 수 있고 접두사와 매칭될 수 있도록 설정합니다. 도메인 이름, IP와 와일드 카드 `*` 등 형식의 주소를 지원합니다. 한 개 주소가 1행을 차지하고 여러 개 주소는 줄을 바꿔야 합니다.

## 설정 예시
당사는 윗 글 중의 [링크 도난 사례](#링크 도난 사례)로 예를 들었고 사용자 A가 핫 링크 보호의 설정을 통해 사용자 B가 이미지를 도난하는 것을 막는 방법을 소개해 드립니다.
1. 사용자 A가 버킷 test에 핫 링크 보호 규칙을 설정하였고 두 가지 방식으로 `b.com`의 링크 도난을 막을 수 있습니다. 자신의 실제 상황에 따라 선택할 수 있습니다.
 - 시작 방식 1: 블랙리스트 모드를 구성하여 도메인 이름 설정에 `*.b.com`을 입력하여 저장합니다.

 - 시작 방식 2: 화이트리스트 모드를 구성하여 도메인 이름 설정에 `*.a.com`을 입력하여 저장합니다.
2. 핫 링크 보호를 시작한 후:
 - `http://a.com/a.html`에 접근할 때 이미지가 정상으로 표시됩니다.

 - `http://b.com/b.html`에 접근할 때 이미지가 표시되지 않으며 다음 그림과 같이 표시됩니다.
![referer_4](//mc.qcloudimg.com/static/img/e58fab402a31ccc903ee3941dbb08eee/image.png)

## FAQ
버킷이 CDN 가속을 시작하였고 CDN 도메인 이름을 사용하여 리소스에 접근할 경우 핫 링크 보호는 적용되지 않으면 어떻게 해야 할까요?
> 도메인 이름이 CDN 도메인 이름이고 CDN은 캐시를 가지므로 불안정한 효과를 초래할 수 있습니다. [CDN 콘솔](https://console.cloud.tencent.com/cdn)에서 핫 링크 보호를 구성해야 합니다.

브라우저에서 링크를 열 때 액세스 및 액세스 리소스를 허용하는 화이트리스트를 설정할 수 있나요?
> 브라우저에서 링크를 단독으로 열었을 때 Referer은 비어있습니다. 현재 추가적으로 Referer의 구성을 지원하지 않습니다.

버킷 test의 핫 링크 보호 화이트리스트를 설정하여 `a.com`의 접근을 허용하였지만, `a.com`하의 웹페이지 플레이어는 버킷 test하의 영상 파일을 재생할 수 없으면 어떻게 해야 하나요?
> 웹페이지에서 Windows Media Player, Flash Player 등 플레이어를 사용하여 영상 링크를 재생할 때 요청 속의 Referer가 비어 있어 화이트리스트를 적중하지 못하게 됩니다. Referer가 비어 있을 때에도 정상 접근할 수 있도록 블랙리스트로 바꾸는 것을 권장합니다.
