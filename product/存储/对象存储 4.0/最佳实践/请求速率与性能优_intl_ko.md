본 문서에서는 요청 속도 성능의 최적화가 COS의 우수 사례를 소개하겠습니다.

COS가 제공하는 대표적인 작업 부하 능력은 매초 1000개 PUT 요청이거나 매초 2000개 GET 요청입니다. 작업 부하가 상기 능력을 초과했을 경우 본 안내에 따라 요청 속도의 성능 확장과 최적화를 구현하기를 권장합니다.

>! 요청 부하는 초당 발생하는 요청 수를 가리키며 동시 연결 수가 아닙니다. 즉 귀하가 수천 개의 연결 수를 유지하는 동시에 여전히 1초의 시간에 수백 개의 새로운 연결 요청을 발송할 수 있습니다.


COS는 성능 확장을 지원하여 더 높은 요청 속도를 지원합니다. 요청이 GET 요청 부하보다 높을 경우 Tencent Cloud CDN 제품을 매칭하여 사용하시기를 권장합니다. [COS와 CDN의 매칭 우수 사례](https://cloud.tencent.com/document/product/436/8467)를 참조해 주십시오. 버킷의 충합 요청 속도가 매초 2000개 PUT/LIST/DELETE 요청을 초과할 것으로 예상된다면 [문의하기](https://cloud.tencent.com/document/product/282/1558)를 진행하기를 권장하며 작업 부하에 준비하여 요청의 제한을 피해야 합니다.

>! 귀하의 하이브리드 요청 부하가 단지 가끔 매초 1200개에 도달하며 예상치 못한 상황에서 매초 2000개를 초과하지 않는다면 본 가이드를 따를 필요가 없습니다.

## 하이브리드 요청 부하

대량의 객체를 업로드해야 할 경우 선택한 객체 키는 성능 문제를 일으킬 수 있으므로 아래에서 Tencent Cloud COS 중 Object 키 값의 저장 방법을 간단하게 소개합니다.

Tencent Cloud는 COS의 각 서비스 지역에서 모두 버킷(Bucket)과 객체(Object)의 키 값을 인덱스로 유지 보수합니다. 객체 키는 UTF-8 이진 순서로 인덱스의 여러 개 파티션에 저장합니다. 대량의 키 값에 대해, 예를 들어 타임스탬프 또는 알파벳 순서를 사용하면 키 값이 존재하는 파티션의 읽기/쓰기 성능을 전부 써버릴 수 있습니다. 버킷 경로 `testbucket-123454321.cos.ap-beijing.myqcloud.com`을 예로 들어 아래에 인덱스 성능을 전부 써버릴 수 있는 일부 인스턴스를 나열하였습니다.

```
20170701/log120000.tar.gz
20170701/log120500.tar.gz
20170701/log121000.tar.gz
20170701/log121500.tar.gz
...
image001/indexpage1.jpg
image002/indexpage2.jpg
image003/indexpage3.jpg
...
```

비즈니스 대표적 부하가 매초당 500개 요청을 초과할 경우 상기 인스턴스 중의 순서 키 값의 사용을 피해야 합니다. 비즈니스가 반드시 순서 번호 또는 날짜 시간 등 문자 부호를 객체 키로 해야 할 경우 사용자는 일부 방법을 사용하여 객체 키 이름에 랜덤으로 접두사를 추가하여 여러 개 인덱스 파티션의 키 값 관리를 구현할 수 있고 집중 부하의 성능을 향상시킬 수 있습니다. 아래에는 키 값에서 랜덤성을 증가시키는 일부 방법을 제공합니다.

**아래 제공하는 모든 방법은 모두 단일 버킷 접근 성능을 향상시킬 수 있는 방법입니다. 귀하의 비즈니스 대표적 부하가 매초당 500개 요청을 초과할 경우 아래의 방법을 수행하는 동시에 [문의하기](https://cloud.tencent.com/document/product/282/1558)를 진행하여 비즈니스 부하에 미리 준비를 해야 합니다.**

### 16진수 해시 접두사 추가

객체 키의 랜덤성을 가장 직접적으로 증가시키는 방식은 바로 객체 키 이름의 가장 앞에 해시 문자열을 추가하여 접두사로 하는 것입니다. 예를 들어 객체를 업로드할 때 경로 키 값에 SHA1 또는 MD5 해시 계산을 진행하고 몇 자리 문자를 접두사로 선택하여 키 값 이름에 추가하며 일반적으로 2 ~ 4자리의 문자 해시 접두사가 요구를 만족시킬 수 있습니다.
<pre>
<font color="red">faf1</font>-20170701/log120000.tar.gz
<font color="red">e073</font>-20170701/log120500.tar.gz
<font color="red">333c</font>-20170701/log121000.tar.gz
<font color="red">2c32</font>-20170701/log121500.tar.gz
</pre>

>! Tencent Cloud COS의 키 값 인덱스가 UTF-8 이진 순서를 인덱스로 하였기에 객체 나열(GET Bucket) 조작을 수행할 때 65536차의 객체 나열 조작을 시행해야만 원래의 완전한 20170701 접두사 구조를 얻을 수 있습니다.

### 열거값 접두사 추가

사용자가 여전히 객체 키의 인덱스 사용 편의성을 보류하고자 할 경우 사용자 파일 유형에 따라 일부 접두사를 나열하고 객체 패킷을 구현할 수 있으며 같은 열거값의 접두사는 소재 인덱스 파티션의 성능을 공유합니다.

```
logs/20170701/log120000.tar.gz
logs/20170701/log120500.tar.gz
logs/20170701/log121000.tar.gz
...
images/image001/indexpage1.jpg
images/image002/indexpage2.jpg
images/image003/indexpage3.jpg
...
```

같은 열거 접두사에서도 여전히 높은 접근 부하가 있으며 매초 500개 요청을 계속하여 초과할 경우 귀하는 상기 16진수 해시 접두사를 추가하는 방식을 참조하여 열거값 뒤에 계속하여 해시 접두사를 추가함으로서 여러 개의 인덱스 파티션을 수행하여 더 높은 성능의 읽기/쓰기를 구현할 수 있습니다.
<pre>
logs/<font color="red">faf1</font>-20170701/log120000.tar.gz
logs/<font color="red">e073</font>-20170701/log120500.tar.gz
logs/<font color="red">333c</font>-20170701/log121000.tar.gz
...
images/<font color="red">0165</font>-image001/indexpage1.jpg
images/<font color="red">a349</font>-image002/indexpage2.jpg
images/<font color="red">ac00</font>-image003/indexpage3.jpg
...
</pre>

### 리버스 키 값 이름 문자열

사용자의 비즈니스가 연속적으로 증가하는 ID 또는 날짜를 반드시 사용해야 하는 경우 또는 대량의 연속 접두사 객체를 한 번에 업로드해야 할 경우 아래 대표적 사용 방법을 참조하십시오.

```
20170701/log0701A.tar.gz
20170701/log0701B.tar.gz
20170702/log0702A.tar.gz
20170702/log0702B.tar.gz
...
id16777216/album/hongkong/img20170701121314.jpg
id16777216/music/artist/tony/anythinggoes.mp3
id16777217/video/record20170701121314.mov
id16777218/live/show/date/20170701121314.mp4
...
```

앞의 키 값 명명 방식은 `2017`과 `id`를 접두사로 한 키 값 소재의 인덱스 파티션을 아주 쉽게 써버리므로 이 때 키 값 접두사의 일부분을 리버스하여 일정한 랜덤성을 구현합니다.

```
10707102/log0701A.tar.gz
10707102/log0701B.tar.gz
20707102/log0702A.tar.gz
20707102/log0702B.tar.gz
...
61277761di/album/hongkong/img20170701121314.jpg
61277761di/music/artist/tony/anythinggoes.mp3
71277761di/video/record20170701121314.mov
81277761di/live/show/date/20170701121314.mp4
...
```

## 높은 GET 요청 부하

주요한 비즈니스 부하가 GET 요청(즉 다운로드 요청)이 위주일 경우 상기 준칙에 따라야 하는 것 외에 또한 Tencent Cloud CDN 서비스 사용과 매칭하여 사용할 것을 권장합니다.

Tencent Cloud CDN은 전국적 및 세계적으로 분포된 엣지 가속 서버를 사용하여 사용자들에게 콘텐츠를 배포할 때 시간 지연을 낮추고 속도를 증가시킵니다. 인기 파일에 대해 프리페치의 방식으로 캐시하는 것을 지원하며 이로부터 COS에 오리진 요청하는 GET 요청수를 줄입니다. [COS와 CDN의 매칭 우수 사례](https://cloud.tencent.com/document/product/436/8467)를 참조하십시오.

