## 概要

この実践では、ユーザーはTencent Cloud Object Storage（以下、COSと略称する）上で静的サイトをホスティングでき、ゲストはカスタムドメイン名（例えば、`www.example.com`）を通して、ホスティングされている静的サイトにアクセスできます。既存の静的サイトをCOSでホスティングする場合でも、ゼロからステーションを構築する場合でも、この実践はCOSで静的サイトをホスティングするのに役立ちます。手順は次のとおりです。
![](https://main.qcloudimg.com/raw/d70261f2d960e9da84a08db561af9b30.png)

## 事前準備

以下は、実践に使用される関連サービスです。

- [ドメイン名の登録](https://dnspod.cloud.tencent.com/?from=qcloudProductDns)：静的サイトをホスティングする前に、`www.example.com`のようなドメイン名を登録する必要があります。Tencent Cloudの[ドメイン名の登録](https://dnspod.cloud.tencent.com/?from=qcloud)でドメイン名を申請できます。
- [COS](https://cloud.tencent.com/product/cos)：COSを使用してバケットを作成し、アップロードしたWebページのコンテンツをバケットに格納し、バケットに対して**パブリック読み取り・プライベート書き込み**とのアクセス権限を設定します（すべての人がWebページのコンテンツを表示できるようにします）。
- [コンテンツ配信ネットワークCDN](https://cloud.tencent.com/product/cdn-scd)：CDNとクラウド解析サービスを組み合わせることで、ドメイン名とサイトコンテンツをバインディングすると同時に、静的サイトの高速化、アクセス遅延の削減、可用性の向上を実現できます。
- [クラウド解析](https://cloud.tencent.com/product/cns?from=qcloudProductCns)：クラウド解析を通して、カスタムドメイン名で静的サイトにアクセスできます。

> ？このガイドのすべての手順では、`www.example.com`がサンプルドメイン名として使用されます。実際処理には、このドメイン名を独自のドメイン名に置き換えてください。

## 操作手順

### 1. ドメイン名の登録と届出

ドメイン名の登録はインターネット上でサービスを確立するための基盤となります。ドメイン名を登録し、届出を行ってからサイトにアクセスできます。個人の状況に応じて、次のいずれかの処理を行います。

- ドメイン名が登録かつ届出された場合は、この手順を省略して[手順2](#バケットの作成)に進みます。
- ドメイン名は登録されたが登録されない場合は、[ドメイン名届出](https://cloud.tencent.com/product/ba)に進んでください。
- ドメイン名が登録されない場合、まずは[ドメイン名登録](https://dnspod.cloud.tencent.com/?from=qcloud)を行い、[ドメイン名届出](https://cloud.tencent.com/product/ba)を行ってください。

<span id="バケットの作成"></span>

### 2. バケットの作成とコンテンツのアップロード

ドメイン名の登録と届出を完了したら、Webサイトのコンテンツを作成および構成するには、COSコンソールで次のタスクを実行する必要があります。

- [バケットの作成](#create)
- [バケットの構成とコンテンツのアップロード](#upload)

<span id="create"></span>

#### 2.1　バケットの作成

[COSコンソール](https://console.cloud.tencent.com/cos)にTencent Cloudのアカウントでログインし、Webサイト用にデータを格納するための適切なバケットを作成してください。Webサイトのコンテンツをバケットに格納できます。初めてCOSを使用する場合は、コンソールの概要画面で直接にバケットを作成できます。または、【バケットリスト】のナビゲーションバーでバケットを作成できます。具体的な処理については、[バケットの作成](https://cloud.tencent.com/document/product/436/13309)ドキュメントを参照してください。

<span id="upload"></span>

#### 2.2 バケットの構成とコンテンツのアップロード

1）バケットへのアクセス権限を**パブリック読み取り・プライベート書き込み**に設定し、Webサイトのコンテンツへの公開アクセスを許可します。処理の詳細については、[アクセス権限の設定](https://cloud.tencent.com/document/product/436/13315)のドキュメントを参照してください。

2）Webサイトのコンテンツを作成したバケットにアップロードします。処理の詳細については、[オブジェクトのアップロード](https://cloud.tencent.com/document/product/436/13321)のドキュメントを参照してください。

テキストファイル、写真、ビデオなどホスティングしたいすべてのコンテンツをバケットに保存できます。まだWebサイトを構築していない場合は、この手順に従ってファイルを作成します。

例えば、次のHTMLでファイルを作成し、バケットにアップロードできます。Webサイトのホームページのファイル名は一般的にindex.htmlと命名されます。次の手順では、当該ファイルをWebサイトのインデックスドキュメントとして提供します。

```shell
<!DOCTYPE html>
<html>
    <head>
        <title>Hello COS!</title>
        <meta charset="utf-8">
    </head>
    <body>
        <p>&nbspCOS&nbspの静的サイト機能へようこそ。</p>
        <p>これはホームページです！</p>
    </body>
</html>
```

> !静的サイト機能をオンにした後、ユーザーがファイル指定なしの1レベルのディレクトリにアクセスする際に、COSはデフォルトで対応するバケットディレクトリのindex.html、index.htmの順に一致し、ファイルが存在しない場合は404を返します。

<span id="手順3"></span>

### 3. カスタムドメイン名のバインディング

> !
> - ユーザーは、カスタムドメイン名をバインディングして静的サイト機能をオンにしてから、ブラウザでコンテンツを直接プレビューできます。デフォルトのドメイン名（CDN加速メイン名とCOSデフォルトドメイン名など）を使用してリソースにアクセスする際に、常にダウンロードボックスがポップアップします。
> - 現在、COSでは、CDNをオンにしないカスタムドメイン名の追加はサポートされていません。カスタムドメイン名を使用するには、CDN加速をオンにする必要があります。CDNをオンにする場合、ユーザーがカスタムドメイン名を使用してページを直接に表示するには、**静的サイトソースサイト**というソースサイトを選択する必要があります。

カスタムドメイン名を設定して、バケットに直接に接続し、静的サイト機能を有効にし、Webサイト（バケット内のコンテンツ）にブラウザから直接アクセスすることができます。また、Webサイトへのアクセス遅延を低減させ、可用性を向上させます。この実践では、カスタムドメイン名をバインディングすると同時に、カスタムドメイン名のCDN加速をオンにして、Webサイトのユーザーがより快適に閲覧できるようにします。

#### 3.1　ドメイン名の追加

カスタムドメイン名を追加するには、次の2つの方法があります。

- [CDNコンソールからの追加](#CDNコンソールから):カスタムドメインを追加しながらCDNの高度な管理と構成を行う場合は、CDNコンソールを選択してドメイン名を追加することをお勧めします。その他の構成については、[CDN構成管理](https://cloud.tencent.com/document/product/228/6288)を参照してください。
- [COSコンソールからの追加](#COSコンソールから)：最初にカスタムドメインを追加するだけで、それ以上の構成を行う必要がない場合は、COSコンソールから迅速に追加できます。

<span id="CDNコンソールから"></span>

- **CDNコンソールからの追加**
  1）[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、**ドメイン名管理**の左側のナビゲーションバーをクリックしてから、【ドメイン名の追加】をクリックして、**ドメイン名の追加**画面に移動します。
  ![](https://main.qcloudimg.com/raw/d6b5ea180a5bfe57ff0d1acf5861206f.png)
  2）加速が必要なドメイン名を入力してください。ソースステーションのタイプは**COS**を選択してください。バケットの設定については、ホスティングWebサイトのコンテンツに対応するバケットとそのデフォルトドメイン名を選択してください。ビジネスタイプは**静的加速**を選択し、その他はデフォルト構成のまま送信します。
  ![](https://main.qcloudimg.com/raw/15d1d5ed26b84b2dab8046ee7977469f.png)
3）ドメイン名の追加が完了しました。
  a. ポップアップウィンドウを閉じ、ドメイン名の構成が完全なネットワークノードに送信されるまでお待ちください（約5~10分）。
  ![](https://main.qcloudimg.com/raw/e352f9626cd1314615f8c8dd55b70211.png)
  b. ドメイン名がCDNに接続した後、システムは`.cdn.dnsv1.com`という接尾辞付きのCNAMEドメイン名を自動的に割り当てます。CNAMEドメイン名に直接アクセスすることはできません。CNAMEの構成はDNSプロバイダで行う必要があります。構成が有効になると、CDN加速サービスを利用できるようになります。CNAME記録はCDNコンソールの[ドメイン名管理ページ](https://console.cloud.tencent.com/cdn/access)で表示できます。CNAME記録を取得したら、[手順3.2](#手順3.2)に進みます。
  ![CDNの追加4](http://mc.qcloudimg.com/static/img/3922bf529760e262316381936e40e26c/image.png)

<span id="COSコンソールから"></span>

- **COSコンソールからの追加**
  1）[COSコンソール](https://console.cloud.tencent.com/cos5)にログインし、左側のメニューバー【バケットリスト】に移動し、Webサイトのコンテンツを格納するバケットをクリックして、バケットに入ります。
  ![](https://main.qcloudimg.com/raw/e3fbbecd2816bb893bfbd5e739868a20.png)
  2）【ドメイン名管理】をクリックしてドメイン名管理画面に入り、カスタムドメイン名の下の【ドメイン名の追加】ボタンをクリックして構成可能な状態になります。
  **ドメイン名**：購入したカスタムドメイン名を入力します（例えば、`www.example.com`）。
  **ソースステーションタイプ**：**静的サイトソースステーション**を選択します。
  【保存】をクリックし、追加を完了します。
  ![](https://main.qcloudimg.com/raw/7e642e83065c98fe80636432107abc4c.png)
  3）ドメイン名の展開が完了するまで何分かお待ちください。次に、対応するCNAME記録をコピーして[手順3.2](#手順3.2)に進みます。
  ![](https://main.qcloudimg.com/raw/fbab10f4b29381a0c0af4838f9bfc3cf.png)

<span id="手順3.2"></span>

#### 3.2 ドメイン名の解析

1.　カスタムドメイン名を追加した後で、ドメイン名解析を行う必要があります。[クラウド解析コンソール](https://console.cloud.tencent.com/cns)にログインし、左側のメニューバーの【ドメイン名解析リスト】をクリックして、ドメイン名解析リストに移動します。【解析の追加】をクリックして、**ドメイン名の追加**ダイアログボックスがポップアップされます。
   ![](https://main.qcloudimg.com/raw/f0603d93d1417277f79562aa98dbc0c4.png)
2.　カスタムドメイン名を入力し、【OK】をクリックして保存します。
   ![](https://main.qcloudimg.com/raw/878946d926cae79f7451afcbb129c1dd.png)
3. ドメイン名の追加に成功したら、ドメイン名をクリックして、解析記録管理画面に移動します。【記録の追加】をクリックして、記録の追加ダイアログボックスがポップアップされます。
   ![](https://main.qcloudimg.com/raw/deaec39dc4903ca72475a14d7373e034.png)
4. 記録タイプについてはCNAMEを選択し、CVM記録は空白のままにして、回線タイプはデフォルトにします。[手順3](#手順3) で取得したCNAME記録を入力し、TTLはデフォルトのままにして、【OK】をクリックして保存します。解析の追加が完了したら、約15分で有効になるため、しばらくお待ちください。
   ![](https://main.qcloudimg.com/raw/1fb0076d1cebb05c4f58c9b61dd05044.png)

### 4. 静的サイト機能をオンにする

サイトのコンテンツをカスタムドメイン名にバインディングしたら、ブラウザでWebサイトのコンテンツを直接にアクセスするには、COSの静的サイト機能をオンにする必要があります。具体的な手順については、[静的サイトの設定](https://cloud.tencent.com/document/product/436/14984)ドキュメントを参照してください。

### 5. テスト検証

上記の手順を完了したら、ブラウザのアドレスバーにWebサイトのドメイン名を入力してアクセスすることで、実践の結果を検証できます（例えば、`www.example.com`）。

- `http://www.example.com`――exampleという名前のバケット内のインデックスページ(index.html)を返します。
- `http://www.example.com/test.html`（存在しないファイル）――exampleという名前のバケット内の404ドキュメント(error.html)を返します。

> ？場合によっては、ブラウザのキャッシュをクリアしないと予想結果が得られないことがあります。
