## 機能説明
HDFS TO COSツールは、HDFSのデータをCOSにコピーするために使用されます。
## 使用環境
### システム環境
LinuxまたはWindowsシステム
### ソフトウェア依存
JDK 1.7または1.8 
#### インストールと構成
具体的な環境のインストールと構成については、[Javaのインストールと構成](https://cloud.tencent.com/document/product/436/10865)を参照してください。
## 構成と使用方法
### 構成方法
1. Hadoop-2.7.2以降のバージョンをインストールします。具体的なインストールステップについては、[Hadoopのインストールとテスト](/doc/product/436/10867)を参照してください。
2. [GitHub アドレス](https://github.com/tencentyun/hdfs_to_cos_tools)でHDFS TO COSツールをダウンロードし、解凍します。
3. 同期するHDFSクラスタのcore-site.xmlをconfフォルダにコピーします。そのうち、core-site.xmlにNameNodeの構成情報が含まれます。
4. 構成ファイル`cos_info.conf`、バケット（Bucket）、地域（Region）およびAPI暗号鍵情報を編集します。そのうち、バケット名は、ユーザーがカスタマイズした文字列とシステムで生成されるappid数値列をハイフンで結合したものです。例えば、mybucket-1250000000。
5. コマンドラインパラメータに構成ファイル位置を指定します。デフォルト位置は`conf/cos_info.conf`。
> <font color="#0000cc">**注意：** </font>
コマンドラインパラメータのパラメータと構成ファイルが重ねる場合、コマンドラインを参照します。

### 使用方法
（Linuxの場合）
#### ヘルプ表示
```
./hdfs_to_cos_cmd -h
```
実行結果を下図のように示します。
![WeChat画像_20170807163035](//mc.qcloudimg.com/static/img/dcff34d37928c0d8b9c4b45c25ac116e/image.png)

#### ファイルコピー
- HDFSからCOSにコピーします。COSに同名ファイルが存在する場合、元のファイルを上書きします。
```
./hdfs_to_cos_cmd --hdfs_path=/tmp/hive --cos_path=/hdfs/20170224/
```
-  HDFSからCOSにコピーします。COSに同名且つ長さが同じのファイルが存在する場合、アップロード（1回コピー後の再コピーに適する）を無視します。
```
./hdfs_to_cos_cmd --hdfs_path=/tmp/hive --cos_path=/hdfs/20170224/ -skip_if_len_match
```
ここで、長さだけを判断します。Hadoopのファイル概要を計算すると、オーバーヘッドが大きい。

#### ディレクトリ情報
```
conf : 構成ファイル。core-site.xmlとcos_info.confを格納します
log  : ログディレクトリ
src  : Javaソースプログラム
dep  : コンパイルで生成される実行可能なjarパッケージ
```
## 問題とヘルプ
#### 構成情報について
バケット（Bucket）、地域（Region）および API 暗号鍵情報を含む、入力した構成情報の正確性を確保してください。そのうち、バケット名は、ユーザーがカスタマイズした文字列とシステムで生成されるappid数値列をハイフンで結合したものです。例えば、mybucket-1250000000。また、マシンの時間と北京時間が一致する（正常差は1分程度）ことを確保してください。差が大きい場合、マシンの時間を再設定してください。
#### DateNodeについて
DateNodeについて、コピープログラム所在のマシンも接続できるように確保してください。NameNodeはパブリックネットワークIPで接続できますが、取得したblock所在のDateNodeマシンはプライベートネットワークIPであり、直接的に接続することができません。故に、同期プログラムをHadoopのあるノードにて実行し、NameNodeとDateNode両方にアクセスすることを確保します。
#### 権限について
Hadoopコマンドを使って、ファイルをダウンロードしてください。正常かどうかを確認してから、同期ツールを使って、Hadoopのデータサポートを同期します。
#### ファイルの上書きについて
COSに存在しているファイルは、デフォルトで再伝送し上書きします。ユーザーが`-skip_if_len_match`を指定しない限り、ファイルの長さが一致する場合、アップロードをスキップします。
#### cos pathについて
 cos pathはデフォルトでディレクトリであり、最終的にHDFSからコピーされるファイルは、このディレクトリに格納されます。

